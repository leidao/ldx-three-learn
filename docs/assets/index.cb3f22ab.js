var h=Object.defineProperty;var l=(n,t,e)=>t in n?h(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var i=(n,t,e)=>(l(n,typeof t!="symbol"?t+"":t,e),e);import{A as u,c as g,d as m,R as L,L as p,e as f,f as w,P as v,W as C,g as A,O as R,D as E,h as O,i as B}from"./LoadingBar.98c96aab.js";function b(n){return{all:n=n||new Map,on:function(t,e){var s=n.get(t);s?s.push(e):n.set(t,[e])},off:function(t,e){var s=n.get(t);s&&(e?s.splice(s.indexOf(e)>>>0,1):n.set(t,[]))},emit:function(t,e){var s=n.get(t);s&&s.slice().map(function(o){o(e)}),(s=n.get("*"))&&s.slice().map(function(o){o(t,e)})}}}class P{constructor(){i(this,"eventBus",b())}on(t,e){this.eventBus.on(t,e)}off(t,e){this.eventBus.off(t,e)}emit(t,...e){this.eventBus.emit(t,...e)}}class y{constructor(t,e){i(this,"camera");i(this,"audioLoader");i(this,"loadmanager");i(this,"sounds",{});this.camera=t,this.loadmanager=e,this.useAudioLoader()}useAudioLoader(){this.audioLoader=new u(this.loadmanager)}loadMusic(t,e,s=!1,o=.5){const a=new g;this.camera.add(a);const r=new m(a);this.audioLoader.setPath(e),this.audioLoader.load(t,d=>{r.setBuffer(d),r.setLoop(s),r.setVolume(o)}),this.sounds[t]=r}setVolume(t,e){const s=this.sounds[t];!s||s.setVolume(e)}setLoop(t,e){const s=this.sounds[t];!s||s.setLoop(e)}setPlay(t){const e=this.sounds[t];!e||e.isPlaying||e.play()}setStop(t){const e=this.sounds[t];!e||!e.isPlaying||e.stop()}setStopAll(){Object.keys(this.sounds).forEach(t=>{this.setStop(t)})}pause(t){const e=this.sounds[t];!e||!e.isPlaying||e.pause()}}const c={AMBIENT_LIGHT_COLOR:16777215,DIRECTIONAL_LIGHT_COLOR:16777215,SCALE:130};class S extends P{constructor(e){super();i(this,"scene");i(this,"camera");i(this,"renderer");i(this,"controls");i(this,"raycaster");i(this,"container");i(this,"directionalLight");i(this,"loadmanager");i(this,"music");i(this,"loadingBar");i(this,"onProgress");i(this,"useOrbitControls",()=>{this.controls=new O(this.camera,this.renderer.domElement),this.controls.addEventListener("change",()=>{this.render()})});i(this,"render",()=>{this.renderer.render(this.scene,this.camera)});i(this,"onResize",()=>{const{width:e,height:s}=this.container.getBoundingClientRect(),o=e/s;this.renderer.setSize(e,s),this.camera.aspect=o,this.camera.updateProjectionMatrix(),this.render()});i(this,"listen",()=>{window.addEventListener("resize",this.onResize)});i(this,"destroy",()=>{window.removeEventListener("resize",this.onResize)});this.container=e,this.initScene(),this.raycaster=new L,this.loadingBar=new p,this.music=new y(this.camera,this.loadmanager)}initScene(){const{width:e,height:s}=this.container.getBoundingClientRect();this.scene=new f,this.scene.background=new w(11184810);const o=e/s;this.camera=new v(45,o,1,1e3),this.camera.up.y=1;const a=this.scene.position;this.camera.lookAt(a),this.camera.position.set(0,0,180),this.renderer=new C({antialias:!0,alpha:!0}),this.renderer.setClearColor(0,0),this.renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.renderer.setSize(e,s),this.renderer.shadowMap.enabled=!1,this.container.appendChild(this.renderer.domElement);const r=new A(c.AMBIENT_LIGHT_COLOR,1);this.scene.add(r);const d=new R;d.position.set(0,0,0),this.directionalLight=new E(c.DIRECTIONAL_LIGHT_COLOR,1),this.directionalLight.position.set(0,0,500),this.directionalLight.target=d,this.scene.add(d),this.scene.add(this.directionalLight),this.restoreContext()}restoreContext(){this.renderer.domElement.addEventListener("webglcontextlost",s=>{s.preventDefault(),setTimeout(()=>{this.renderer.forceContextRestore()},1)})}useLoadingManager(){const e=new Map;this.loadmanager=new B,this.loadmanager.onStart=()=>{this.loadingBar.visible=!0},this.loadmanager.onLoad=()=>{this.emit("load_complete"),this.loadingBar.visible=!1},this.loadmanager.onError=s=>{console.log("\u8D44\u6E90\u52A0\u8F7D\u51FA\u9519\uFF1A",s)},this.onProgress=(s,o)=>{const a=e.get(s);a?(a.loaded=o.loaded,a.total=o.total):e.set(s,{loaded:o.loaded,total:o.total}),this.loadingBar.update(e)}}}export{S as V};
