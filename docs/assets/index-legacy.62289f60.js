!function(){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,o,a=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(l){s=!0,o=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return n(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function i(e,t){return i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},i(e,t)}function s(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=u(e);if(t){var o=u(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return l(this,n)}}function l(t,n){if(n&&("object"===e(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t)}function u(e){return u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},u(e)}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){d(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var f=document.createElement("style");f.innerHTML='#--unocss-hash--{content:"0c597641"}\n',document.head.appendChild(f),System.register(["./index-legacy.ea392efe.js","./index-legacy.71b87d9d.js","./CSS3DRenderer-legacy.a498894e.js"],(function(e){"use strict";var n,o,l,u,c,f,h,v,y,m,g,b,w,x,C,O,P,S,k,E,L,D,j,T,R,M,z,F,A,_,I,N,q,B,U,K,H,G,V,Q,Y,X,J,W,$,Z,ee,te,ne,re,oe;return{setters:[function(e){n=e.k,o=e.l,l=e.m,u=e.d,c=e.n,f=e.o,h=e.c,v=e._,y=e.b,m=e.j,g=e.r,b=e.C,w=e.p,x=e.f,C=e.a,O=e.S,P=e.q,S=e.s},function(e){k=e.V,E=e.Q,L=e.L,D=e.F,j=e.af,T=e.G,R=e.T,M=e.C,z=e.ag,F=e.ah,A=e.ai,_=e.b,I=e.H,N=e.M,q=e.O,B=e.B,U=e._,K=e.i,H=e.aj,G=e.ak,V=e.E,Q=e.al,Y=e.Z,X=e.am,J=e.an,W=e.e,$=e.ao,Z=e.$,ee=e.g,te=e.ap,ne=e.c},function(e){re=e.C,oe=e.a}],execute:function(){var ae=function(e){n(r,e);var t=o(r);function r(e){var n;l(this,r),(n=t.call(this,e)).handleChange=function(e){var t=n.props,r=t.disabled,o=t.onChange;r||("checked"in n.props||n.setState({checked:e.target.checked}),o&&o({target:u(u({},n.props),{},{checked:e.target.checked}),stopPropagation:function(){e.stopPropagation()},preventDefault:function(){e.preventDefault()},nativeEvent:e.nativeEvent}))},n.saveInput=function(e){n.input=e};var o="checked"in e?e.checked:e.defaultChecked;return n.state={checked:o},n}return c(r,[{key:"focus",value:function(){this.input.focus()}},{key:"blur",value:function(){this.input.blur()}},{key:"render",value:function(){var e,t=this.props,n=t.prefixCls,r=t.className,o=t.style,a=t.name,i=t.id,s=t.type,l=t.disabled,u=t.readOnly,c=t.tabIndex,d=t.onClick,g=t.onFocus,b=t.onBlur,w=t.onKeyDown,x=t.onKeyPress,C=t.onKeyUp,O=t.autoFocus,P=t.value,S=t.required,k=f(t,["prefixCls","className","style","name","id","type","disabled","readOnly","tabIndex","onClick","onFocus","onBlur","onKeyDown","onKeyPress","onKeyUp","autoFocus","value","required"]),E=Object.keys(k).reduce((function(e,t){return"aria-"!==t.substr(0,5)&&"data-"!==t.substr(0,5)&&"role"!==t||(e[t]=k[t]),e}),{}),L=this.state.checked,D=h(n,r,(v(e={},"".concat(n,"-checked"),L),v(e,"".concat(n,"-disabled"),l),e));return y("span",{className:D,style:o,children:[m("input",p({name:a,id:i,type:s,required:S,readOnly:u,disabled:l,tabIndex:c,className:"".concat(n,"-input"),checked:!!L,onClick:d,onFocus:g,onBlur:b,onKeyUp:C,onKeyDown:w,onKeyPress:x,onChange:this.handleChange,autoFocus:O,ref:this.saveInput,value:P},E)),m("span",{className:"".concat(n,"-inner")})]})}}],[{key:"getDerivedStateFromProps",value:function(e,t){return"checked"in e?u(u({},t),{},{checked:e.checked}):null}}]),r}(g.exports.Component);ae.defaultProps={prefixCls:"rc-checkbox",className:"",style:{},type:"checkbox",defaultChecked:!1,onFocus:function(){},onBlur:function(){},onChange:function(){},onKeyDown:function(){},onKeyPress:function(){},onKeyUp:function(){}};var ie=g.exports.createContext(null),se=ie.Provider,le=ie,ue=globalThis&&globalThis.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n},ce=function(e,t){var n,r=g.exports.useContext(le),o=g.exports.useContext(b),a=o.getPrefixCls,i=o.direction,s=g.exports.useRef(),l=w(t,s);g.exports.useEffect((function(){x(!("optionType"in e),"Radio","`optionType` is only support in Radio.Group.")}),[]);var u=e.prefixCls,c=e.className,p=e.children,d=e.style,f=ue(e,["prefixCls","className","children","style"]),y=a("radio",u),m=C({},f);r&&(m.name=r.name,m.onChange=function(t){var n,o;null===(n=e.onChange)||void 0===n||n.call(e,t),null===(o=null==r?void 0:r.onChange)||void 0===o||o.call(r,t)},m.checked=e.value===r.value,m.disabled=e.disabled||r.disabled);var O=h("".concat(y,"-wrapper"),(v(n={},"".concat(y,"-wrapper-checked"),m.checked),v(n,"".concat(y,"-wrapper-disabled"),m.disabled),v(n,"".concat(y,"-wrapper-rtl"),"rtl"===i),n),c);return g.exports.createElement("label",{className:O,style:d,onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave},g.exports.createElement(ae,C({},m,{type:"radio",prefixCls:y,ref:l})),void 0!==p?g.exports.createElement("span",null,p):null)},pe=g.exports.forwardRef(ce);pe.displayName="Radio";var de=pe,fe=g.exports.forwardRef((function(e,t){var n=g.exports.useContext(b),r=n.getPrefixCls,o=n.direction,a=g.exports.useContext(O),i=P(e.defaultValue,{value:e.value}),s=S(i,2),l=s[0],u=s[1];return g.exports.createElement(se,{value:{onChange:function(t){var n=l,r=t.target.value;"value"in e||u(r);var o=e.onChange;o&&r!==n&&o(t)},value:l,disabled:e.disabled,name:e.name}},function(){var n,i=e.prefixCls,s=e.className,u=void 0===s?"":s,c=e.options,p=e.optionType,d=e.buttonStyle,f=void 0===d?"outline":d,y=e.disabled,m=e.children,b=e.size,w=e.style,x=e.id,O=e.onMouseEnter,P=e.onMouseLeave,S=r("radio",i),k="".concat(S,"-group"),E=m;if(c&&c.length>0){var L="button"===p?"".concat(S,"-button"):S;E=c.map((function(e){return"string"==typeof e||"number"==typeof e?g.exports.createElement(de,{key:e.toString(),prefixCls:L,disabled:y,value:e,checked:l===e},e):g.exports.createElement(de,{key:"radio-group-value-options-".concat(e.value),prefixCls:L,disabled:e.disabled||y,value:e.value,checked:l===e.value,style:e.style},e.label)}))}var D=b||a,j=h(k,"".concat(k,"-").concat(f),(v(n={},"".concat(k,"-").concat(D),D),v(n,"".concat(k,"-rtl"),"rtl"===o),n),u);return g.exports.createElement("div",C({},function(e){return Object.keys(e).reduce((function(t,n){return"data-"!==n.substr(0,5)&&"aria-"!==n.substr(0,5)&&"role"!==n||"data-__"===n.substr(0,7)||(t[n]=e[n]),t}),{})}(e),{className:j,style:w,onMouseEnter:O,onMouseLeave:P,id:x,ref:t}),E)}())})),he=g.exports.memo(fe),ve=globalThis&&globalThis.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n},ye=function(e,t){var n=g.exports.useContext(le),r=g.exports.useContext(b).getPrefixCls,o=e.prefixCls,a=ve(e,["prefixCls"]),i=r("radio-button",o);return n&&(a.checked=e.value===n.value,a.disabled=e.disabled||n.disabled),g.exports.createElement(de,C({prefixCls:i},a,{type:"radio",ref:t}))},me=g.exports.forwardRef(ye),ge=de;ge.Button=me,ge.Group=he;var be=ge,we=function(e,t){return{phi:(90-t)*(Math.PI/180),theta:(e+90)*(Math.PI/180)}},xe=function(e,t,n){var r=(180+t)*(Math.PI/180),o=(90-n)*(Math.PI/180);return{x:-e*Math.sin(o)*Math.cos(r),y:e*Math.cos(o),z:e*Math.sin(o)*Math.sin(r)}},Ce=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&i(e,t)}(n,e);var t=s(n);function n(e){return r(this,n),t.call(this,e)}return a(n,[{key:"load",value:function(e,t,n,r){var o=this,a=new D(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(o.withCredentials),a.load(e,(function(e){var n;try{n=JSON.parse(e)}catch(a){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(e.substring(65,e.length-2))}var r=o.parse(n);t&&t(r)}),n,r)}},{key:"parse",value:function(e){return new Oe(e)}}]),n}(L),Oe=function(){function e(t){r(this,e),this.type="Font",this.data=t}return a(e,[{key:"generateShapes",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=[],r=Pe(e,t,this.data),o=0,a=r.length;o<a;o++)Array.prototype.push.apply(n,r[o].toShapes());return n}}]),e}();function Pe(e,t,n){for(var r=Array.from(e),o=t/n.resolution,a=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*o,i=[],s=0,l=0,u=0;u<r.length;u++){var c=r[u];if("\n"===c)s=0,l-=a;else{var p=Se(c,o,s,l,n);s+=p.offsetX,i.push(p.path)}}return i}function Se(e,t,n,r,o){var a=o.glyphs[e]||o.glyphs["?"];if(a){var i,s,l,u,c,p,d,f,h=new j;if(a.o)for(var v=a._cachedOutline||(a._cachedOutline=a.o.split(" ")),y=0,m=v.length;y<m;){switch(v[y++]){case"m":i=v[y++]*t+n,s=v[y++]*t+r,h.moveTo(i,s);break;case"l":i=v[y++]*t+n,s=v[y++]*t+r,h.lineTo(i,s);break;case"q":l=v[y++]*t+n,u=v[y++]*t+r,c=v[y++]*t+n,p=v[y++]*t+r,h.quadraticCurveTo(c,p,l,u);break;case"b":l=v[y++]*t+n,u=v[y++]*t+r,c=v[y++]*t+n,p=v[y++]*t+r,d=v[y++]*t+n,f=v[y++]*t+r,h.bezierCurveTo(c,p,d,f,l,u)}}return{offsetX:a.ha*t,path:h}}console.error('THREE.Font: character "'+e+'" does not exists in font family '+o.familyName+".")}Oe.prototype.isFont=!0;var ke=function(){function e(t){var n=this;r(this,e),d(this,"clock",void 0),d(this,"textLoader",void 0),d(this,"fileLoader",void 0),d(this,"fontLoad",void 0),d(this,"viewer",void 0),d(this,"uniforms",{}),d(this,"labelRenderer",void 0),d(this,"controls",void 0),d(this,"R",100),d(this,"customUniforms",{baseTexture:{type:"t",value:{}},mixAmount:{type:"f",value:0}}),d(this,"group3D",new T),d(this,"group2D",new T),d(this,"sphere",void 0),d(this,"onResize",(function(){var e=n.viewer.container.getBoundingClientRect(),t=e.width,r=e.height,o=t/r;n.viewer.renderer.setSize(t,r),n.labelRenderer.setSize(t,r),n.viewer.camera.aspect=o,n.viewer.camera.updateProjectionMatrix(),n.render()})),d(this,"listen",(function(){window.addEventListener("resize",n.onResize)})),d(this,"destroy",(function(){window.removeEventListener("resize",n.onResize)})),d(this,"createEarth",(function(e){n.textLoader.load("propagate/img/earth.png",(function(t){n.customUniforms.baseTexture.value=t;var r=new A(e,100,100),o=new _({uniforms:n.customUniforms,vertexShader:"uniform float mixAmount;\n                        varying vec2 vUv;\n                        void main()\n                        {\n                            vUv = uv;\n                          vec3 goalPosition = 200.0 * vec3( uv.x,uv.y/2.0, 0 ) + vec3(-100.0,-50.0, 0.0);\n                          vec3 newPosition = mix( position, goalPosition, mixAmount );\n                          gl_Position = projectionMatrix * modelViewMatrix * vec4( newPosition, 1.0 );\n                        }\n                      ",fragmentShader:"uniform sampler2D baseTexture;\n                          varying vec2 vUv;\n\n                          void main()\n                          {\n                              gl_FragColor = texture2D( baseTexture, vUv );\n                          }\n                        ",side:I,transparent:!0,opacity:1});n.sphere=new N(r,o),n.viewer.scene.add(n.sphere),n.render()}))})),d(this,"drawOutline",(function(){var e=n.R,t=new T,r=new _({uniforms:n.customUniforms,vertexShader:"uniform float mixAmount;\n                     attribute vec3 current;\n                        void main()\n                        {\n                          vec3 newPosition = mix( position, current, mixAmount );\n                          gl_Position = projectionMatrix * modelViewMatrix * vec4( newPosition, 1.0 );\n                        }\n                      ",fragmentShader:"void main()\n                        {\n                            gl_FragColor = vec4(1.0,1.0,1.0,0.2);\n                        }\n                      ",side:I,transparent:!0});n.fileLoader.load("propagate/data/world.json",(function(o){o.features.forEach((function(o){if("Polygon"===o.geometry.type){var a=[],i=[],s=o.geometry.coordinates[0]||[];if(0===s.length)return;s.forEach((function(t){a.push(t[0],t[1],0);var n=xe(1.001*e,t[0],t[1]);i.push(n.x,n.y,n.z)})),t.add(n.drawLineLoop(a,i,r))}else"MultiPolygon"===o.geometry.type&&o.geometry.coordinates.forEach((function(o){var a=[],i=[],s=o[0]||[];0!==s.length&&(s.forEach((function(t){a.push(t[0],t[1],0);var n=xe(1.001*e,t[0],t[1]);i.push(n.x,n.y,n.z)})),t.add(n.drawLineLoop(a,i,r)))}))})),n.viewer.scene.add(t),n.render()}),(function(e){n.viewer.onProgress("propagate/data/world.json",e)}))})),d(this,"drawLineLoop",(function(e,t,n){var r=new q,o=new Float32Array(t);return r.setAttribute("position",new B(o,3)),r.setAttribute("current",new B(new Float32Array(e),3)),new U(r,n)})),d(this,"drawShpae",(function(e,t){var n=[];e.forEach((function(e){n.push(new K(e[0],e[1]))}));var r=new H(n),o=new G(r);return new N(o,t)})),d(this,"drawLines",(function(e,t){var r=new V({color:14737632});t.forEach((function(e){var t=e.to,o=e.name,a=e.isLine;if(t&&a&&"曲阜"!==o){var i=n.draw2DLine(e,r),s=i.fly,l=i.point;n.group2D.add(s,l);var u=n.draw3DLine(e,r),c=u.fly,p=u.point;n.group3D.add(c,p),n.render()}}))})),d(this,"drawFlyLine",(function(e,t,r){var o=[],a=[],i=[],s=[];e.forEach((function(e,n){var r=n/(t-1);o.push({x:e.x,y:e.y,z:e.z}),i.push(r),s.push(n)})),o.forEach((function(e){a.push(e.x,e.y,e.z)}));var l=new q;l.setFromPoints(e),l.setAttribute("position",new J(a,3)),l.setAttribute("index",new J(i,1)),l.setAttribute("current",new J(s,1)),n.uniforms[r]={uColor:{value:new W(710128)},uRange:{value:20},uSize:{value:6},uTotal:{value:t},uTime:{value:0},uSpeed:{value:(4*Math.random()+4)/10}};var u=new _({transparent:!0,depthWrite:!1,depthTest:!1,blending:$,uniforms:n.uniforms[r],vertexShader:"\n        attribute float index;\n        attribute float current;\n        uniform float uTime;\n        uniform float uSize;\n        uniform float uSpeed;\n        uniform float uRange; // 展示区间\n        uniform float uTotal; // 粒子总数\n        uniform vec3 uColor;\n        varying vec3 vColor;\n        varying float vOpacity;\n        void main() {\n            // 需要当前显示的索引\n            float size = uSize;\n            float showNumber = uTotal * mod(uTime * uSpeed, 1.1);\n            if (showNumber > current && showNumber < current + uRange) {\n                float uIndex = ((current + uRange) - showNumber) / uRange;\n                size *= uIndex;\n                vOpacity = 1.0;\n            } else {\n                vOpacity = 0.0;\n            }\n            // 顶点着色器计算后的Position\n            vColor = uColor;\n            vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n            gl_Position = projectionMatrix * mvPosition;\n            // 大小\n            gl_PointSize = size * 300.0 / (-mvPosition.z);\n        }",fragmentShader:"\n        varying vec3 vColor;\n        varying float vOpacity;\n        void main() {\n            float distanceToCenter = distance(gl_PointCoord,vec2(0.5));\n            float strength = 1.0 - (distanceToCenter * 2.0);\n            if(vOpacity <= 0.0){\n              gl_FragColor = vec4(vColor, 0.0);\n            }else{\n              gl_FragColor = vec4(vColor, strength);\n            }\n        }"});return new Z(l,u)})),d(this,"drawLocation",(function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=new ee({transparent:!0,side:I});n.textLoader.load("propagate/img/136.png",(function(o){e.forEach((function(e){var a=e.to,i=e.size,s=Number(i)+2,l=t?i:s>16?16:s;if(a){var u=new k(a[0],a[1],0),c=u.x,p=u.y,d=u.z,f=new te(l,l);r.map=o;var h=new N(f,r);h.position.set(c,p,d+.02),n.group2D.add(h);var v=h.clone(),y=we(a[0],a[1]),m=y.phi,g=y.theta;v.position.setFromSphericalCoords(100,m,g);var b=new k;b.copy(v.position).multiplyScalar(2),v.lookAt(b),n.group3D.add(v)}})),n.render()}))})),d(this,"update",(function(){var e=n.clock.getElapsedTime();Object.keys(n.uniforms).forEach((function(t){n.uniforms[t].uTime.value=e})),n.render()})),t.useLoadingManager(),t.scene.add(this.group3D),this.viewer=t,this.textLoader=new R,this.textLoader.setCrossOrigin(""),this.fileLoader=new D(t.loadmanager),this.fileLoader.setResponseType("json"),this.fontLoad=new Ce(t.loadmanager),this.clock=new M,this.uniforms={},this.listen()}return a(e,[{key:"useCss3Render",value:function(){var e=this,t=this.viewer.container.getBoundingClientRect(),n=t.width,r=t.height;this.labelRenderer=new re,this.labelRenderer.setSize(n,r),this.labelRenderer.domElement.style.position="absolute",this.labelRenderer.domElement.style.top="0px";var o=this.labelRenderer.domElement;o.id="tempId",this.viewer.container.appendChild(o),this.controls=new z(this.viewer.camera,o),this.controls.addEventListener("change",(function(){e.render()})),this.controls.enablePan=!1,this.controls.minDistance=50,this.controls.maxDistance=250,this.controls.mouseButtons={LEFT:F.ROTATE,MIDDLE:F.DOLLY,RIGHT:F.PAN}}},{key:"startGame",value:function(){var e=this;this.viewer.scene.translateX(-10),this.viewer.scene.translateY(-15),this.loadSky(),this.drawLocation([{to:[117.045982,35.794391],size:35}],!0),this.fileLoader.load("propagate/data/map.json",(function(t){e.useCss3Render();var n=e.R;e.createEarth(n),e.drawOutline(),e.drawLines(n,t),e.createText(t),e.drawLocation(t)}),(function(t){e.viewer.onProgress("propagate/data/map.json",t)}))}},{key:"render",value:function(){var e;this.viewer.render(),null===(e=this.labelRenderer)||void 0===e||e.render(this.viewer.scene,this.viewer.camera)}},{key:"loadSky",value:function(){var e=this;this.textLoader.load("propagate/img/bg.png",(function(t){e.viewer.scene.background=t,e.render()}))}},{key:"draw2DLine",value:function(e,t){var n=e.from,r=e.to,o=e.name,a=new k(n[0],n[1],0),i=new k(r[0],r[1],0),s=a.clone().lerp(i,.5),l=a.clone().distanceTo(i);s.z+=l/3;var u=new Q(a,s,i),c=4*u.getLength(),p=u.getPoints(c),d=(new q).setFromPoints(p);return{fly:new Y(d,t),point:this.drawFlyLine(p,c,"".concat(o,"2d"))}}},{key:"draw3DLine",value:function(e,t){var n,r,o,a,i,s,l,u,c,p,d,f,h,v,y,m,g,b,w,x,C,O,P,S,L,D,j=this.R,T=e.from,R=e.to,M=e.name,z=we(T[0],T[1]),F=z.phi,A=z.theta,_=(new k).setFromSphericalCoords(100,F,A),I=we(R[0],R[1]),N=I.phi,B=I.theta,U=(new k).setFromSphericalCoords(100,N,B),K=(n=_,r=U,o=new k(0,0,0),a=n.clone().sub(o),i=r.clone().sub(o),s=a.clone().cross(i).normalize(),l=new k(0,0,1),u=(new E).setFromUnitVectors(s,l),c=n.clone().applyQuaternion(u),p=r.clone().applyQuaternion(u),d=c.clone().add(p).multiplyScalar(.5).clone().sub(o).normalize(),f=new k(0,1,0),h=(new E).setFromUnitVectors(d,f),{startSphere:c.clone().applyQuaternion(h.clone()),endSphere:p.clone().applyQuaternion(h.clone()),quaternion:u.clone().invert().multiply(h.clone().invert())}),H=K.startSphere,G=K.endSphere,V=H.clone().lerp(G,.5).normalize(),Q=Ee(H,G,new k(0,0,0)),J=V.multiplyScalar(j+j*Q*.1),W=(y=G,m=J,g=(v=H).lengthSq(),b=y.lengthSq(),w=m.lengthSq(),x=v.x,C=v.y,O=y.x,P=y.y,S=m.x,L=m.y,new k((b*L+g*P+w*C-b*C-w*P-g*L)/(D=x*P+O*L+S*C-C*O-P*S-L*x)/2,(w*O+b*x+g*S-g*O-b*S-w*x)/D/2,0)),$=Math.abs(W.y-J.y),Z=Ee(H,new k(0,-1,0),W),ee=-Math.PI/2+Z,te=Math.PI-ee,ne=new X(W.x,W.y,$,ee,te,!1),re=4*ne.getLength(),oe=ne.getPoints(re),ae=(new q).setFromPoints(oe),ie=new Y(ae,t);return ie.quaternion.multiply(K.quaternion),{fly:ie,point:this.drawFlyLine(oe.map((function(e){return new k(e.x,e.y,0).applyQuaternion(K.quaternion)})),re,"".concat(M,"3d"))}}},{key:"createText",value:function(e){var t=this;e.forEach((function(e){var n=e.to,r=e.name,o=e.size,a=e.isLine;if(r&&a&&n){var i=document.createElement("div");i.style.fontSize="曲阜"===r?"20px":"12px",i.style.color="#ffffff",i.style.position="absolute",i.style.fontFamily="HanaA",i.style.whiteSpace="nowrap";var s="<span>".concat(r,"</span> ");o>1&&(s+='<span style="font-size:28px;vertical-align: sub;">'.concat(o,"</span> <span>所</span>")),i.innerHTML=s;var l=new oe(i);l.name="2d",l.position.set(n[0],n[1]-1,0),l.scale.set(.15,.15,.15),"曲阜"==r&&(l.scale.set(.2,.2,.2),l.position.set(n[0],n[1]-4,0)),t.group2D.add(l);var u=l.clone();u.name="3d";var c=we(n[0],n[1]),p=c.phi,d=c.theta;u.position.setFromSphericalCoords(100,p,d);var f=new k;f.copy(u.position).multiplyScalar(2),u.lookAt(f),u.scale.set(.15,.15,.15),"曲阜"==r&&u.scale.set(.2,.2,.2),t.group3D.add(u),t.render()}}))}}]),e}(),Ee=function(e,t,n){var r=e.clone().sub(n).normalize(),o=t.clone().sub(n).normalize(),a=r.clone().dot(o);return Math.acos(a)};e("default",(function(){var e=g.exports.useRef(null),n=t(g.exports.useState("3D"),2),r=n[0],o=n[1],a=t(g.exports.useState(),2),i=a[0],s=a[1],l=t(g.exports.useState(),2),u=l[0],c=l[1];return g.exports.useEffect((function(){if(e.current){var t=new ne(e.current);c(t),t.useOrbitControls();var n,r=new ke(t);s(r),r.startGame();return function e(){r.update(),n=requestAnimationFrame(e)}(),function(){cancelIdleCallback(n)}}}),[]),m("div",{className:"w-100% h-100% relative",children:m("div",{className:"gunplay w-100% h-100% ",ref:e,children:y(be.Group,{className:"absolute top-20px right-20px z-999",buttonStyle:"solid",value:r,onChange:function(e){var t=e.target.value;if(i){var n="2D"===t?0:1;"2D"===t?(null==u||u.scene.remove(i.group3D),i.group3D.traverse((function(e){"3d"===e.name&&(e.element.style.display="none")})),i.controls.enablePan=!0,i.controls.enableRotate=!1,i.controls.mouseButtons={LEFT:F.PAN,MIDDLE:F.DOLLY,RIGHT:F.ROTATE}):(null==u||u.scene.remove(i.group2D),i.group2D.traverse((function(e){"2d"===e.name&&(e.element.style.display="none")})),i.controls.enablePan=!1,i.controls.enableRotate=!0,i.controls.mouseButtons={LEFT:F.ROTATE,MIDDLE:F.DOLLY,RIGHT:F.PAN}),i.controls.reset();!function e(){"2D"===t?n+=.01:n-=.01,n<1.01&&n>-.01?(i.sphere.scale.set(1+.8*n,1+.8*n,1+.8*n),i.customUniforms.mixAmount.value=n,requestAnimationFrame(e)):"2D"===t?(null==u||u.scene.add(i.group2D),i.group2D.traverse((function(e){"2d"===e.name&&(console.log("yyy"),e.element.style.display="block")}))):(null==u||u.scene.add(i.group3D),i.group3D.traverse((function(e){"3d"===e.name&&(e.element.style.display="block")})))}(),o(t)}},children:[m(be.Button,{value:"2D",children:"2D"}),m(be.Button,{value:"3D",children:"3D"})]})})})}))}}}))}();
