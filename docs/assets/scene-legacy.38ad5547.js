!function(){function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=l(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function n(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var i,r,a=[],o=!0,s=!1;try{for(n=n.call(t);!(o=(i=n.next()).done)&&(a.push(i.value),!e||a.length!==e);o=!0);}catch(h){s=!0,r=h}finally{try{o||null==n.return||n.return()}finally{if(s)throw r}}return a}(t,e)||l(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&r(t,e)}function r(t,e){return r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},r(t,e)}function a(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=h(t);if(e){var r=h(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return o(this,n)}}function o(e,n){if(n&&("object"===t(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return s(e)}function s(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function h(t){return h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},h(t)}function u(t){return function(t){if(Array.isArray(t))return c(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||l(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,e){if(t){if("string"==typeof t)return c(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(t,e):void 0}}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function f(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function y(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function v(t,e,n){return e&&y(t.prototype,e),n&&y(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function d(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}System.register([],(function(t){"use strict";return{execute:function(){var r;t("c",k),r=Symbol.iterator;var o=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;f(this,t),d(this,"x",0),d(this,"y",0),d(this,"isVector2",!0),this.x=e,this.y=n}return v(t,[{key:"width",get:function(){return this.x},set:function(t){this.x=t}},{key:"height",get:function(){return this.y},set:function(t){this.y=t}},{key:"set",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;return this.x=t,this.y=e,this}},{key:"setScalar",value:function(t){return this.x=t,this.y=t,this}},{key:"setX",value:function(t){return this.x=t,this}},{key:"setY",value:function(t){return this.y=t,this}},{key:"setComponent",value:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}},{key:"getComponent",value:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}},{key:"clone",value:function(){return new t(this.x,this.y)}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this}},{key:"addVectors",value:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}},{key:"addScaledVector",value:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this}},{key:"subVectors",value:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this}},{key:"divideScalar",value:function(t){return this.multiplyScalar(1/t)}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}},{key:"clamp",value:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}},{key:"clampScalar",value:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}},{key:"clampLength",value:function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y}},{key:"cross",value:function(t){return this.x*t.y-this.y*t.x}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"angle",value:function(){var t=Math.atan2(-this.y,-this.x)+Math.PI;return t}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceToSquared(t))}},{key:"distanceToSquared",value:function(t){var e=this.x-t.x,n=this.y-t.y;return e*e+n*n}},{key:"manhattanDistanceTo",value:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}},{key:"setLength",value:function(t){return this.normalize().multiplyScalar(t)}},{key:"lerp",value:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}},{key:"lerpVectors",value:function(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t}},{key:"rotate",value:function(t){var e=this.x,n=this.y,i=Math.cos(t),r=Math.sin(t);return this.x=e*i-n*r,this.y=e*r+n*i,this}},{key:"rotateAround",value:function(t,e){var n=Math.cos(e),i=Math.sin(e),r=this.x-t.x,a=this.y-t.y;return this.x=r*n-a*i+t.x,this.y=r*i+a*n+t.y,this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this}},{key:"lookAt",value:function(e){var n=(new t).subVectors(e,this),i=Math.atan2(n.y,n.x);return i<0?i+2*Math.PI:i}},{key:"isEmpty",value:function(){return this.x!==1/0&&this.y!==1/0}},{key:"applyMatrix3",value:function(t){var e=this.x,n=this.y,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6],this.y=i[1]*e+i[4]*n+i[7],this}},{key:r,value:regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.x;case 2:return t.next=4,this.y;case 4:case"end":return t.stop()}}),t,this)}))}]),t}();t("V",o);var h=function(){function t(){f(this,t),d(this,"_listeners",{})}return v(t,[{key:"addEventListener",value:function(t,e){var n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)}},{key:"hasEventListener",value:function(t,e){var n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)}},{key:"removeEventListener",value:function(t,e){var n=this._listeners[t];if(void 0!==n){var i=n.indexOf(e);-1!==i&&n.splice(i,1)}}},{key:"dispatchEvent",value:function(t){var e=this._listeners[t.type];if(void 0!==e)for(var n=u(e),i=0,r=n.length;i<r;i++)n[i].call(this,t)}}]),t}(),l=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function c(){var t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(l[255&t]+l[t>>8&255]+l[t>>16&255]+l[t>>24&255]+"-"+l[255&e]+l[e>>8&255]+"-"+l[e>>16&15|64]+l[e>>24&255]+"-"+l[63&n|128]+l[n>>8&255]+"-"+l[n>>16&255]+l[n>>24&255]+l[255&i]+l[i>>8&255]+l[i>>16&255]+l[i>>24&255]).toLowerCase()}var y=function(){function t(){f(this,t),d(this,"elements",[1,0,0,0,1,0,0,0,1])}return v(t,[{key:"set",value:function(t,e,n,i,r,a,o,s,h){var u=this.elements;return u[0]=t,u[1]=i,u[2]=o,u[3]=e,u[4]=r,u[5]=s,u[6]=n,u[7]=a,u[8]=h,this}},{key:"identity",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:"copy",value:function(t){var e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}},{key:"setFromMatrix4",value:function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}},{key:"multiply",value:function(t){return this.multiplyMatrices(this,t)}},{key:"premultiply",value:function(t){return this.multiplyMatrices(t,this)}},{key:"multiplyMatrices",value:function(t,e){var n=t.elements,i=e.elements,r=this.elements,a=n[0],o=n[3],s=n[6],h=n[1],u=n[4],l=n[7],c=n[2],f=n[5],y=n[8],v=i[0],d=i[3],m=i[6],p=i[1],x=i[4],g=i[7],k=i[2],b=i[5],w=i[8];return r[0]=a*v+o*p+s*k,r[3]=a*d+o*x+s*b,r[6]=a*m+o*g+s*w,r[1]=h*v+u*p+l*k,r[4]=h*d+u*x+l*b,r[7]=h*m+u*g+l*w,r[2]=c*v+f*p+y*k,r[5]=c*d+f*x+y*b,r[8]=c*m+f*g+y*w,this}},{key:"multiplyScalar",value:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}},{key:"determinant",value:function(){var t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],a=t[4],o=t[5],s=t[6],h=t[7],u=t[8];return e*a*u-e*o*h-n*r*u+n*o*s+i*r*h-i*a*s}},{key:"invert",value:function(){var t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],a=t[4],o=t[5],s=t[6],h=t[7],u=t[8],l=u*a-o*h,c=o*s-u*r,f=h*r-a*s,y=e*l+n*c+i*f;if(0===y)return this.set(0,0,0,0,0,0,0,0,0);var v=1/y;return t[0]=l*v,t[1]=(i*h-u*n)*v,t[2]=(o*n-i*a)*v,t[3]=c*v,t[4]=(u*e-i*s)*v,t[5]=(i*r-o*e)*v,t[6]=f*v,t[7]=(n*s-h*e)*v,t[8]=(a*e-n*r)*v,this}},{key:"transpose",value:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}},{key:"transposeIntoArray",value:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}},{key:"setUvTransform",value:function(t,e,n,i,r,a,o){var s=Math.cos(r),h=Math.sin(r);return this.set(n*s,n*h,-n*(s*a+h*o)+a+t,-i*h,i*s,-i*(-h*a+s*o)+o+e,0,0,1),this}},{key:"scale",value:function(t,e){return this.premultiply(m.makeScale(t,e)),this}},{key:"rotate",value:function(t){return this.premultiply(m.makeRotation(t)),this}},{key:"translate",value:function(t,e){return this.premultiply(m.makeTranslation(t,e)),this}},{key:"makeTranslation",value:function(t,e){return this.set(1,0,t,0,1,e,0,0,1),this}},{key:"makeRotation",value:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,n,e,0,0,0,1),this}},{key:"makeScale",value:function(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}},{key:"equals",value:function(t){for(var e=this.elements,n=t.elements,i=0;i<9;i++)if(e[i]!==n[i])return!1;return!0}},{key:"fromArray",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<9;n++)this.elements[n]=t[n+e];return this}},{key:"clone",value:function(){return(new t).fromArray(this.elements)}}]),t}();t("M",y);var m=new y,p=function(t){i(n,t);var e=a(n);function n(){var t;f(this,n);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return d(s(t=e.call.apply(e,[this].concat(r))),"position",new o),d(s(t),"rotate",0),d(s(t),"scale",new o(1,1)),d(s(t),"visible",!0),d(s(t),"index",0),d(s(t),"name",""),d(s(t),"parent",void 0),d(s(t),"enableCamera",!0),d(s(t),"uuid",c()),d(s(t),"isObject2D",!0),t}return v(n,[{key:"matrix",get:function(){var t=this.position,e=this.rotate,n=this.scale;return(new y).scale(n.x,n.y).rotate(e).translate(t.x,t.y)}},{key:"worldMatrix",get:function(){var t=this.parent,e=this.matrix;return t?t.worldMatrix.multiply(e):e}},{key:"pvmMatrix",get:function(){var t=this.getScene();if(t){var e=t.camera;return(new y).multiplyMatrices(e.pvMatrix,this.worldMatrix)}return this.worldMatrix}},{key:"worldScale",get:function(){var t=this.scale,e=this.parent;return e?t.clone().multiply(e.worldScale):t}},{key:"transform",value:function(t){var e=this.position,n=this.rotate,i=this.scale;t.translate(e.x,e.y),t.rotate(n),t.scale(i.x,i.y)}},{key:"remove",value:function(){var t=this.parent;t&&t.remove(this)}},{key:"show",value:function(){this.visible=!0}},{key:"hidden",value:function(){this.visible=!1}},{key:"getScene",value:function(){return"isScene"in this?this:this.parent?this.parent.getScene():null}},{key:"draw",value:function(t){this.visible&&(t.save(),this.transform(t),this.drawShape(t),t.restore())}},{key:"drawShape",value:function(t){}},{key:"crtPath",value:function(t,e){}}]),n}(h);t("O",p);var x=function(){function t(){f(this,t),d(this,"shadowColor",void 0),d(this,"shadowBlur",0),d(this,"shadowOffsetX",0),d(this,"shadowOffsetY",0),d(this,"globalAlpha",void 0),d(this,"globalCompositeOperation",void 0),d(this,"clip",!1)}return v(t,[{key:"setOption",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.assign(this,t)}},{key:"apply",value:function(t){var e=this.globalAlpha,n=this.globalCompositeOperation,i=this.shadowColor,r=this.shadowBlur,a=this.shadowOffsetX,o=this.shadowOffsetY,s=this.clip;i&&(t.shadowColor=i,t.shadowBlur=r,t.shadowOffsetX=a,t.shadowOffsetY=o),n&&(t.globalCompositeOperation=n),void 0!==e&&(t.globalAlpha=e),s&&t.clip()}}]),t}();function g(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=new o(e[0],e[1]).applyMatrix3(n);t.moveTo(r.x,r.y);for(var a=2,s=e.length;a<s;a+=2){var h=new o(e[a],e[a+1]).applyMatrix3(n);t.lineTo(h.x,h.y)}i&&t.closePath()}function k(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=new o(e[0],e[1]);t.moveTo(i.x,i.y);for(var r=2,a=e.length;r<a;r+=2){var s=new o(e[r],e[r+1]);t.lineTo(s.x,s.y)}n&&t.closePath()}t("B",x);t("g",(function(t,e){var n=Math.floor(t/e),i=e*n,r=e*(n+1);return t-i<=r-t?i:r})),t("n",(function(t){var e=Math.floor(t),n=Math.ceil(t);return(t-e<n-t?e:n)+.5}));var b=function(t){i(r,t);var e=a(r);function r(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return f(this,r),d(s(t=e.call(this)),"image",new Image),d(s(t),"offset",new o),d(s(t),"size",new o(300,150)),d(s(t),"view",void 0),d(s(t),"style",new x),d(s(t),"isImg",!0),t.setOption(n),t}return v(r,[{key:"setOption",value:function(t){for(var e=0,i=Object.entries(t);e<i.length;e++){var r=n(i[e],2),a=r[0],o=r[1];switch(a){case"src":this.image instanceof Image&&(this.image.src=o);break;case"style":this.style.setOption(o);break;default:this[a]=o}}}},{key:"moMatrix",get:function(){var t=this.offset,e=t.x,n=t.y;return this.worldMatrix.multiply((new y).makeTranslation(e,n))}},{key:"pvmoMatrix",get:function(){var t=this.offset,e=t.x,n=t.y;return this.pvmMatrix.multiply((new y).makeTranslation(e,n))}},{key:"drawShape",value:function(t){var e=this.image,n=this.offset,i=this.size,r=this.view;this.style.apply(t),r?t.drawImage(e,r.x,r.y,r.width,r.height,n.x,n.y,i.x,i.y):t.drawImage(e,n.x,n.y,i.x,i.y)}},{key:"crtPath",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.pvmoMatrix,n=this.size,i=n.x,r=n.y;g(t,[0,0,i,0,i,r,0,r],e,!0)}}]),r}(p);t("I",b);var w=2*Math.PI,M=!1,S=document.createElement("canvas").getContext("2d"),P=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};f(this,t),d(this,"_img",new b),d(this,"vertives",[]),d(this,"center",new o),d(this,"matrix",new y),d(this,"level","pvmoMatrix"),d(this,"strokeStyle","#558ef0"),d(this,"fillStyle","#fff");for(var i=0,r=Object.entries(e);i<r.length;i++){var a=n(r[i],2),s=a[0],h=a[1];this[s]=h}}return v(t,[{key:"img",get:function(){return this._img},set:function(t){this._img=t,this.updateShape()}},{key:"updateShape",value:function(){var t=this.vertives,e=this.center,n=this.img,i=this.level,r=this.img.size,a=r.x,s=r.y,h=[0,0,a/2,0,a,0,a,s/2,a,s,a/2,s,0,s,0,s/2];this.matrix=n[i];for(var u=0,l=h.length;u<l;u+=2){var c=new o(h[u],h[u+1]).applyMatrix3(this.matrix),f=c.x,y=c.y;t[u]=f,t[u+1]=y}e.copy(new o(t[0],t[1]).lerp(new o(t[8],t[9]),.5))}},{key:"draw",value:function(t){this.updateShape();var e=this.img.size,n=this.vertives,i=this.center,r=this.matrix,a=this.strokeStyle,s=this.fillStyle,h=e.width/2,u=e.height/2;t.save(),t.strokeStyle=a,t.fillStyle=s,t.beginPath(),k(t,[n[0],n[1],n[4],n[5],n[8],n[9],n[12],n[13]],!0),t.stroke();var l=r.elements,c=new o(l[0],l[1]).length(),f=new o(l[3],l[4]).length(),y=new o(8/c,8/f),v=y.x/2,d=y.y/2;t.beginPath();for(var m=0;m<3;m++)for(var p=0;p<3;p++)if(1!==m||1!==p){var x=h*p,b=u*m;g(t,[x-v,b-d,x+v,b-d,x+v,b+d,x-v,b+d],r,!0)}t.fill(),t.stroke(),t.beginPath(),t.arc(i.x,i.y,5,0,w),t.fill(),t.stroke(),t.restore()}},{key:"getMouseState",value:function(t){for(var e=this.vertives,n=new o(e[0]-e[8],e[1]-e[9]).length(),i=Math.min(12,n/3),r=0,a=e.length;r<a;r+=4)if(new o(e[r],e[r+1]).sub(t).length()<i)return"scale";return S.save(),S.lineWidth=i,S.beginPath(),k(S,[e[0],e[1],e[4],e[5]]),M=S.isPointInStroke(t.x,t.y),S.restore(),M?"scaleY":(S.save(),S.lineWidth=i,S.beginPath(),k(S,[e[8],e[9],e[12],e[13]]),M=S.isPointInStroke(t.x,t.y),S.restore(),M?"scaleY":(S.save(),S.lineWidth=i,S.beginPath(),k(S,[e[12],e[13],e[0],e[1]]),M=S.isPointInStroke(t.x,t.y),S.restore(),M?"scaleX":(S.save(),S.lineWidth=i,S.beginPath(),k(S,[e[4],e[5],e[8],e[9]]),M=S.isPointInStroke(t.x,t.y),S.restore(),M?"scaleX":(S.beginPath(),k(S,e),S.isPointInPath(t.x,t.y)?"move":(S.save(),S.lineWidth=40,S.beginPath(),k(S,e),S.closePath(),M=S.isPointInStroke(t.x,t.y),S.restore(),M?"rotate":null)))))}}]),t}();t("F",P);var O=function(t){i(n,t);var e=a(n);function n(t){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return f(this,n),d(s(i=e.call(this)),"camera",void 0),d(s(i),"scene",void 0),d(s(i),"enableZoom",!0),d(s(i),"zoomSpeed",3),d(s(i),"enablePan",!0),d(s(i),"panSpeed",1),d(s(i),"panning",!1),d(s(i),"minZoom",1/0),d(s(i),"maxZoom",1/0),d(s(i),"scaleForMouse",!1),d(s(i),"stage",{cameraZoom:1,cameraPosition:new o,panStart:new o}),d(s(i),"wheel",(function(t){var e=t.deltaY,n=t.clientX,r=t.clientY,a=s(i),h=a.enableZoom,u=a.camera,l=a.zoomSpeed;if(h){var c=Math.pow(.95,l);if(e>0){if(u.zoom<i.minZoom)return;u.zoom*=c}else{if(u.zoom>i.maxZoom)return;u.zoom/=c}i.setZoom(new o(n,r));var f={type:"change",target:t};i.dispatchEvent(f)}})),d(s(i),"pointerdown",(function(t){var e=t.clientX,n=t.clientY,r=s(i),a=r.enablePan,o=r.stage,h=o.cameraPosition,u=o.panStart,l=r.camera.position;a&&(i.panning=!0,h.copy(l.clone()),u.set(e,n))})),d(s(i),"pointerup",(function(){var t=s(i),e=t.camera.position,n=t.stage.cameraPosition;i.panning=!1,n.copy(e.clone())})),d(s(i),"pointermove",(function(t){var e=t.clientX,n=t.clientY,r=s(i),a=r.enablePan,h=r.camera.position,u=r.stage,l=u.panStart,c=l.x,f=l.y,y=u.cameraPosition,v=r.panning;if(a&&v){h.copy(y.clone().add(new o(e-c,n-f)));var d={type:"change",target:t};i.dispatchEvent(d)}})),i.camera=t.camera,i.scene=t,i.setOption(r),i}return v(n,[{key:"setOption",value:function(t){Object.assign(this,t)}},{key:"setZoom",value:function(t){var e=this.camera,n=this.stage,i=new o;if(t)i=this.scene.clientToCanvas(t.x,t.y);else{var r=this.scene.getViewPort(),a=r.viewportWidth,s=r.viewportHeight;i.set(a/2,s/2)}var h=i.sub(i.clone().sub(e.position).multiplyScalar(e.zoom).divideScalar(n.cameraZoom));e.position.copy(h.clone()),n.cameraPosition.copy(h.clone()),n.cameraZoom=e.zoom}}]),n}(h);t("a",O);var E=t("d",window.devicePixelRatio||1),j=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;f(this,t),d(this,"position",void 0),d(this,"zoom",void 0),this.position=new o(e,n),this.zoom=i}return v(t,[{key:"pvMatrix",get:function(){var t=this.position,e=t.x,n=t.y,i=this.zoom;return(new y).translate(e*E,n*E).scale(i*E,i*E)}},{key:"transformInvert",value:function(t){var e=this.position,n=e.x,i=e.y,r=this.zoom;t.translate(n*E,i*E),t.scale(r*E,r*E)}}]),t}(),C=function(t){i(r,t);var n=a(r);function r(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return f(this,r),d(s(t=n.call(this)),"children",[]),d(s(t),"isGroup",!0),t.setOption(e),t}return v(r,[{key:"setOption",value:function(t){Object.assign(this,t)}},{key:"add",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var i=0,r=e;i<r.length;i++){var a=r[i];if(a===this)return this;a.parent&&a.remove(),a.parent=this,this.children.push(a),this.dispatchEvent({type:"add",obj:a})}return this.sort(),this}},{key:"remove",value:function(){for(var t=this.children,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];for(var o=0,s=i;o<s.length;o++){var h=s[o],u=t.indexOf(h);if(-1!==u)h.parent=void 0,this.children.splice(u,1),this.dispatchEvent({type:"remove",obj:h});else{var l,c=e(t);try{for(c.s();!(l=c.n()).done;){var f=l.value;f instanceof r&&f.remove(h)}}catch(y){c.e(y)}finally{c.f()}}}return this}},{key:"clear",value:function(){var t,n=e(this.children);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.parent=void 0,this.dispatchEvent({type:"removed",obj:i})}}catch(r){n.e(r)}finally{n.f()}return this.children=[],this}},{key:"sort",value:function(){var t=this.children;t.sort((function(t,e){return t.index-e.index}));var n,i=e(t);try{for(i.s();!(n=i.n()).done;){var a=n.value;a instanceof r&&a.sort()}}catch(o){i.e(o)}finally{i.f()}}},{key:"getObjectByName",value:function(t){return this.getObjectByProperty("name",t)}},{key:"getObjectByProperty",value:function(t,e){for(var n=this.children,i=0,a=n.length;i<a;i++){var o=n[i];if(o[t]===e)return o;if(o instanceof r){var s=o.getObjectByProperty(t,e);if(s)return s}}}},{key:"traverse",value:function(t){t(this);var n,i=e(this.children);try{for(i.s();!(n=i.n()).done;){var a=n.value;a instanceof r?a.traverse(t):t(a)}}catch(o){i.e(o)}finally{i.f()}}},{key:"traverseVisible",value:function(t){if(this.visible){t(this);var n,i=e(this.children);try{for(i.s();!(n=i.n()).done;){var a=n.value;a.visible&&(a instanceof r?a.traverse(t):t(a))}}catch(o){i.e(o)}finally{i.f()}}}},{key:"drawShape",value:function(t){var n,i=e(this.children);try{for(i.s();!(n=i.n()).done;){n.value.draw(t)}}catch(r){i.e(r)}finally{i.f()}}}]),r}(p),I=function(t){i(h,t);var r=a(h);function h(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return f(this,h),d(s(t=r.call(this)),"width",void 0),d(s(t),"height",void 0),d(s(t),"_domElement",document.createElement("canvas")),d(s(t),"ctx",t._domElement.getContext("2d")),d(s(t),"camera",new j),d(s(t),"autoClear",!0),d(s(t),"isCenter",!0),d(s(t),"isScene",!0),t.setOption(e),t}return v(h,[{key:"domElement",get:function(){return this._domElement},set:function(t){if(this._domElement!==t){this._domElement=t;var e=this._domElement.parentElement;if(e){var n=e.clientWidth,i=e.clientHeight;this.setViewPort(n,i),this.isCenter&&this.camera.position.set(n/2,i/2)}}}},{key:"setViewPort",value:function(t,e){this.domElement.style.width=t+"px",this.domElement.style.height=e+"px",this.domElement.width=t*E,this.domElement.height=e*E,this.ctx=this.domElement.getContext("2d")}},{key:"getViewPort",value:function(){return{width:this.domElement.width,height:this.domElement.height,viewportWidth:this.domElement.clientWidth,viewportHeight:this.domElement.clientHeight}}},{key:"setOption",value:function(t){for(var e=0,i=Object.entries(t);e<i.length;e++){var r=n(i[e],2),a=r[0],o=r[1];this[a]=o}}},{key:"render",value:function(){var t=this.domElement,n=t.width,i=t.height,r=this.ctx,a=this.camera,o=this.children,s=this.autoClear;r.save(),r.setTransform(1,0,0,1,0,0),s&&r.clearRect(0,0,n,i),r.fillStyle="#f4f4f4",r.fillRect(0,0,n,i);var h,u=e(o);try{for(u.s();!(h=u.n()).done;){var l=h.value;r.save(),l.enableCamera&&a.transformInvert(r),l.draw(r),r.restore()}}catch(c){u.e(c)}finally{u.f()}r.restore()}},{key:"clientToCanvas",value:function(t,e){var n=this.domElement.getBoundingClientRect(),i=n.left,r=n.top;return new o(t-i,e-r)}},{key:"canvasToClient",value:function(t,e){var n=this.domElement.getBoundingClientRect(),i=n.left,r=n.top;return new o(t+i,e+r)}},{key:"canvastoClip",value:function(t){var e=t.x,n=t.y,i=this.position;return new o(e-i.x,n-i.y)}},{key:"clientToClip",value:function(t,e){return this.canvastoClip(this.clientToCanvas(t,e))}},{key:"clientToCoord",value:function(t,e){var n=this.camera,i=n.zoom,r=n.position;return this.canvastoClip(this.clientToCanvas(t,e)).sub(r).divideScalar(i)}},{key:"isPointInObj",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new y,i=this.ctx;return i.save(),i.beginPath(),t.crtPath(i,n),i.restore(),i.isPointInPath(e.x,e.y)}},{key:"selectObj",value:function(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.children,r=e(u(i).reverse());try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a instanceof b&&this.isPointInObj(a,t,a.pvmoMatrix))return a}}catch(o){r.e(o)}finally{r.f()}return null}}]),h}(C);t("S",I)}}}))}();
