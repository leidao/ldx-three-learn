var u=Object.defineProperty;var w=(a,e,t)=>e in a?u(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var s=(a,e,t)=>(w(a,typeof e!="symbol"?e+"":e,t),t);import{r as h,j as g}from"./index.5ab62cdf.js";import{R as p,L as f,e as v,f as C,P as R,W as E,O as b,g as O,D as m,aE as A,h as I,i as M,aI as L}from"./LoadingBar.98c96aab.js";import{G as P}from"./GLTFLoader.fdb0f41a.js";const c={AMBIENT_LIGHT_COLOR:13552587,DIRECTIONAL_LIGHT_COLOR:16777215,SCALE:130};class T{constructor(e){s(this,"scene");s(this,"camera");s(this,"renderer");s(this,"controls");s(this,"raycaster");s(this,"gltfLoader");s(this,"container");s(this,"directionalLight");s(this,"loadmanager");s(this,"loadingBar");s(this,"onProgress");s(this,"useOrbitControls",()=>{this.controls=new I(this.camera,this.renderer.domElement),this.controls.maxPolarAngle=Math.PI*.4,this.controls.minDistance=15,this.controls.maxDistance=100,this.controls.enablePan=!1,this.controls.addEventListener("change",()=>{this.render()})});s(this,"render",()=>{this.renderer.render(this.scene,this.camera)});s(this,"onResize",()=>{const{width:e,height:t}=this.container.getBoundingClientRect(),r=e/t;this.renderer.setSize(e,t),this.camera.aspect=r,this.camera.updateProjectionMatrix(),this.render()});s(this,"listen",()=>{window.addEventListener("resize",this.onResize)});s(this,"destroy",()=>{window.removeEventListener("resize",this.onResize)});this.container=e,this.initScene(),this.raycaster=new p,this.loadingBar=new f}initScene(){const{width:e,height:t}=this.container.getBoundingClientRect();this.scene=new v,this.scene.background=new C(11184810);const r=e/t;this.camera=new R(45,r,1,1e3),this.camera.up.y=1;const n=this.scene.position;this.camera.lookAt(n),this.camera.position.set(80,30,-30),this.renderer=new E({antialias:!0,alpha:!0}),this.renderer.setClearColor(0,0),this.renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.renderer.setSize(e,t),this.renderer.shadowMap.enabled=!1,this.container.appendChild(this.renderer.domElement);const i=new b;i.position.set(0,0,0);const d=new O(c.AMBIENT_LIGHT_COLOR,1);d.position.set(0,20,0),this.scene.add(d);const o=new m(c.DIRECTIONAL_LIGHT_COLOR,2);o.position.set(30,100,50),o.target=i,this.scene.add(o);const l=new m(c.DIRECTIONAL_LIGHT_COLOR,1);l.position.set(0,20,-50),l.target=i,this.scene.fog=new A(11184810,110,160),this.restoreContext()}restoreContext(){this.renderer.domElement.addEventListener("webglcontextlost",t=>{t.preventDefault(),setTimeout(()=>{this.renderer.forceContextRestore()},1)})}useLoadingManager(){const e=new Map;this.loadmanager=new M,this.loadmanager.onStart=()=>{this.loadingBar.visible=!0},this.loadmanager.onLoad=()=>{this.loadingBar.visible=!1},this.loadmanager.onError=t=>{console.log("\u8D44\u6E90\u52A0\u8F7D\u51FA\u9519\uFF1A",t)},this.onProgress=(t,r)=>{const n=e.get(t);n?(n.loaded=r.loaded,n.total=r.total):e.set(t,{loaded:r.loaded,total:r.total}),this.loadingBar.update(e)}}loadServiceArea(){this.gltfLoader=new P(this.loadmanager),this.gltfLoader.setPath("serviceArea/glb/"),this.gltfLoader.load("serviceArea.glb",e=>{this.scene.add(e.scene),e.scene.traverse(t=>{if(t.isMesh){if(t.name==="\u5E73\u9762001"){const r=new L({map:t.material.map});t.material=r}t.name==="\u5E73\u9762003"&&(t.material=new L({color:"#545454"}))}}),this.render()},e=>{this.onProgress("serviceArea.glb",e)})}}const S=()=>{const a=h.exports.useRef(null);return h.exports.useEffect(()=>{if(!a.current)return;const e=new T(a.current);e.useOrbitControls(),e.listen(),e.useLoadingManager(),e.loadServiceArea()},[]),g("div",{className:"w-100% h-100% relative",children:g("div",{className:"gunplay w-100% h-100%",ref:a})})};export{S as default};
