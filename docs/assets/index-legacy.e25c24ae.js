!function(){function e(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,o,a=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(l){s=!0,o=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw o}}return a}(e,n)||function(e,n){if(!e)return;if("string"==typeof e)return t(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return t(e,n)}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function i(e,t){return i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},i(e,t)}function s(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=u(e);if(t){var o=u(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return l(this,n)}}function l(e,t){if(t&&("object"===c(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function u(e){return u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},u(e)}function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}var p=document.createElement("style");p.innerHTML='#--unocss-hash--{content:"0c597641"}\n',document.head.appendChild(p),System.register(["./index-legacy.06a2154f.js","./index-legacy.0d138179.js","./CSS3DRenderer-legacy.e55a0216.js","./context-legacy.bfc14647.js"],(function(t){"use strict";var o,l,u,p,d,f,v,h,m,y,g,w,b,x,C,S,E,P,L,O,T,R,k,D,j,M,z,A,F,_,I,N,B,U,q,H,G,V,Q,W,Y,X,J,$,Z,K,ee,te,ne,re,oe;return{setters:[function(e){o=e.r,l=e.L,u=e.v,p=e.P,d=e.H,f=e.I,v=e.d,h=e.C,m=e.U,y=e.a,g=e.W,w=e.c,b=e._,x=e.V,C=e.m,S=e.j,E=e.b},function(e){P=e.V,L=e.Q,O=e.L,T=e.F,R=e.af,k=e.G,D=e.T,j=e.C,M=e.ag,z=e.ah,A=e.ai,F=e.b,_=e.H,I=e.M,N=e.O,B=e.B,U=e._,q=e.i,H=e.aj,G=e.ak,V=e.E,Q=e.al,W=e.Z,Y=e.am,X=e.an,J=e.e,$=e.ao,Z=e.$,K=e.g,ee=e.ap,te=e.c},function(e){ne=e.C,re=e.a},function(e){oe=e.F}],execute:function(){var ae,ie=o.exports.createContext(null),se=ie.Provider,le=o.exports.createContext(null),ue=le.Provider,ce={exports:{}};
/*!
      	Copyright (c) 2018 Jed Watson.
      	Licensed under the MIT License (MIT), see
      	http://jedwatson.github.io/classnames
      */
ae=ce,function(){var e={}.hasOwnProperty;function t(){for(var n=[],r=0;r<arguments.length;r++){var o=arguments[r];if(o){var a=c(o);if("string"===a||"number"===a)n.push(o);else if(Array.isArray(o)){if(o.length){var i=t.apply(null,o);i&&n.push(i)}}else if("object"===a){if(o.toString!==Object.prototype.toString&&!o.toString.toString().includes("[native code]")){n.push(o.toString());continue}for(var s in o)e.call(o,s)&&o[s]&&n.push(s)}}}return n.join(" ")}ae.exports?(t.default=t,ae.exports=t):window.classNames=t}();var pe=ce.exports,de=["prefixCls","className","style","checked","disabled","defaultChecked","type","onChange"],fe=o.exports.forwardRef((function(e,t){var n,r=e.prefixCls,a=void 0===r?"rc-checkbox":r,i=e.className,s=e.style,c=e.checked,h=e.disabled,m=e.defaultChecked,y=void 0!==m&&m,g=e.type,w=void 0===g?"checkbox":g,b=e.onChange,x=l(e,de),C=o.exports.useRef(null),S=u(y,{value:c}),E=p(S,2),P=E[0],L=E[1];o.exports.useImperativeHandle(t,(function(){return{focus:function(){var e;null===(e=C.current)||void 0===e||e.focus()},blur:function(){var e;null===(e=C.current)||void 0===e||e.blur()},input:C.current}}));var O=pe(a,i,(d(n={},"".concat(a,"-checked"),P),d(n,"".concat(a,"-disabled"),h),n));return o.exports.createElement("span",{className:O,style:s},o.exports.createElement("input",f({},x,{className:"".concat(a,"-input"),ref:C,onChange:function(t){h||("checked"in e||L(t.target.checked),null==b||b({target:v(v({},e),{},{type:w,checked:t.target.checked}),stopPropagation:function(){t.stopPropagation()},preventDefault:function(){t.preventDefault()},nativeEvent:t.nativeEvent}))},disabled:h,checked:!!P,type:w})),o.exports.createElement("span",{className:"".concat(a,"-inner")}))})),ve=globalThis&&globalThis.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n},he=function(e,t){var n,r,a=o.exports.useContext(ie),i=o.exports.useContext(le),s=o.exports.useContext(h),l=s.getPrefixCls,u=s.direction,c=o.exports.useRef(),p=m(t,c),d=o.exports.useContext(oe).isFormItemInput,f=e.prefixCls,v=e.className,x=e.children,C=e.style,S=ve(e,["prefixCls","className","children","style"]),E=l("radio",f),P="button"===((null==a?void 0:a.optionType)||i)?"".concat(E,"-button"):E,L=y({},S),O=o.exports.useContext(g);a&&(L.name=a.name,L.onChange=function(t){var n,r;null===(n=e.onChange)||void 0===n||n.call(e,t),null===(r=null==a?void 0:a.onChange)||void 0===r||r.call(a,t)},L.checked=e.value===a.value,L.disabled=null!==(n=L.disabled)&&void 0!==n?n:a.disabled),L.disabled=null!==(r=L.disabled)&&void 0!==r?r:O;var T=w("".concat(P,"-wrapper"),b(b(b(b({},"".concat(P,"-wrapper-checked"),L.checked),"".concat(P,"-wrapper-disabled"),L.disabled),"".concat(P,"-wrapper-rtl"),"rtl"===u),"".concat(P,"-wrapper-in-form-item"),d),v);return o.exports.createElement("label",{className:T,style:C,onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave},o.exports.createElement(fe,y({},L,{type:"radio",prefixCls:P,ref:p})),void 0!==x?o.exports.createElement("span",null,x):null)},me=o.exports.forwardRef(he),ye=o.exports.forwardRef((function(e,t){var n=o.exports.useContext(h),r=n.getPrefixCls,a=n.direction,i=o.exports.useContext(x),s=u(e.defaultValue,{value:e.value}),l=C(s,2),c=l[0],p=l[1],d=e.prefixCls,f=e.className,v=void 0===f?"":f,m=e.options,g=e.buttonStyle,S=void 0===g?"outline":g,E=e.disabled,P=e.children,L=e.size,O=e.style,T=e.id,R=e.onMouseEnter,k=e.onMouseLeave,D=e.onFocus,j=e.onBlur,M=r("radio",d),z="".concat(M,"-group"),A=P;m&&m.length>0&&(A=m.map((function(e){return"string"==typeof e||"number"==typeof e?o.exports.createElement(me,{key:e.toString(),prefixCls:M,disabled:E,value:e,checked:c===e},e):o.exports.createElement(me,{key:"radio-group-value-options-".concat(e.value),prefixCls:M,disabled:e.disabled||E,value:e.value,checked:c===e.value,style:e.style},e.label)})));var F=L||i,_=w(z,"".concat(z,"-").concat(S),b(b({},"".concat(z,"-").concat(F),F),"".concat(z,"-rtl"),"rtl"===a),v);return o.exports.createElement("div",y({},function(e){return Object.keys(e).reduce((function(t,n){return!n.startsWith("data-")&&!n.startsWith("aria-")&&"role"!==n||n.startsWith("data-__")||(t[n]=e[n]),t}),{})}(e),{className:_,style:O,onMouseEnter:R,onMouseLeave:k,onFocus:D,onBlur:j,id:T,ref:t}),o.exports.createElement(se,{value:{onChange:function(t){var n=c,r=t.target.value;"value"in e||p(r);var o=e.onChange;o&&r!==n&&o(t)},value:c,disabled:e.disabled,name:e.name,optionType:e.optionType}},A))})),ge=o.exports.memo(ye),we=globalThis&&globalThis.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n},be=function(e,t){var n=o.exports.useContext(h).getPrefixCls,r=e.prefixCls,a=we(e,["prefixCls"]),i=n("radio",r);return o.exports.createElement(ue,{value:"button"},o.exports.createElement(me,y({prefixCls:i},a,{type:"radio",ref:t})))},xe=o.exports.forwardRef(be),Ce=me;Ce.Button=xe,Ce.Group=ge,Ce.__ANT_RADIO=!0;var Se=Ce,Ee=function(e,t){return{phi:(90-t)*(Math.PI/180),theta:(e+90)*(Math.PI/180)}},Pe=function(e,t,n){var r=(180+t)*(Math.PI/180),o=(90-n)*(Math.PI/180);return{x:-e*Math.sin(o)*Math.cos(r),y:e*Math.cos(o),z:e*Math.sin(o)*Math.sin(r)}},Le=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&i(e,t)}(n,e);var t=s(n);function n(e){return r(this,n),t.call(this,e)}return a(n,[{key:"load",value:function(e,t,n,r){var o=this,a=new T(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(o.withCredentials),a.load(e,(function(e){var n;try{n=JSON.parse(e)}catch(a){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(e.substring(65,e.length-2))}var r=o.parse(n);t&&t(r)}),n,r)}},{key:"parse",value:function(e){return new Oe(e)}}]),n}(O),Oe=function(){function e(t){r(this,e),this.type="Font",this.data=t}return a(e,[{key:"generateShapes",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=[],r=Te(e,t,this.data),o=0,a=r.length;o<a;o++)Array.prototype.push.apply(n,r[o].toShapes());return n}}]),e}();function Te(e,t,n){for(var r=Array.from(e),o=t/n.resolution,a=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*o,i=[],s=0,l=0,u=0;u<r.length;u++){var c=r[u];if("\n"===c)s=0,l-=a;else{var p=Re(c,o,s,l,n);s+=p.offsetX,i.push(p.path)}}return i}function Re(e,t,n,r,o){var a=o.glyphs[e]||o.glyphs["?"];if(a){var i,s,l,u,c,p,d,f,v=new R;if(a.o)for(var h=a._cachedOutline||(a._cachedOutline=a.o.split(" ")),m=0,y=h.length;m<y;){switch(h[m++]){case"m":i=h[m++]*t+n,s=h[m++]*t+r,v.moveTo(i,s);break;case"l":i=h[m++]*t+n,s=h[m++]*t+r,v.lineTo(i,s);break;case"q":l=h[m++]*t+n,u=h[m++]*t+r,c=h[m++]*t+n,p=h[m++]*t+r,v.quadraticCurveTo(c,p,l,u);break;case"b":l=h[m++]*t+n,u=h[m++]*t+r,c=h[m++]*t+n,p=h[m++]*t+r,d=h[m++]*t+n,f=h[m++]*t+r,v.bezierCurveTo(c,p,d,f,l,u)}}return{offsetX:a.ha*t,path:v}}console.error('THREE.Font: character "'+e+'" does not exists in font family '+o.familyName+".")}Oe.prototype.isFont=!0;var ke=function(){function e(t){var o=this;r(this,e),n(this,"clock",void 0),n(this,"textLoader",void 0),n(this,"fileLoader",void 0),n(this,"fontLoad",void 0),n(this,"viewer",void 0),n(this,"uniforms",{}),n(this,"labelRenderer",void 0),n(this,"controls",void 0),n(this,"R",100),n(this,"customUniforms",{baseTexture:{type:"t",value:{}},mixAmount:{type:"f",value:0}}),n(this,"group3D",new k),n(this,"group2D",new k),n(this,"sphere",void 0),n(this,"onResize",(function(){var e=o.viewer.container.getBoundingClientRect(),t=e.width,n=e.height,r=t/n;o.viewer.renderer.setSize(t,n),o.labelRenderer.setSize(t,n),o.viewer.camera.aspect=r,o.viewer.camera.updateProjectionMatrix(),o.render()})),n(this,"listen",(function(){window.addEventListener("resize",o.onResize)})),n(this,"destroy",(function(){window.removeEventListener("resize",o.onResize)})),n(this,"createEarth",(function(e){o.textLoader.load("propagate/img/earth.png",(function(t){o.customUniforms.baseTexture.value=t;var n=new A(e,100,100),r=new F({uniforms:o.customUniforms,vertexShader:"uniform float mixAmount;\n                        varying vec2 vUv;\n                        void main()\n                        {\n                            vUv = uv;\n                          vec3 goalPosition = 200.0 * vec3( uv.x,uv.y/2.0, 0 ) + vec3(-100.0,-50.0, 0.0);\n                          vec3 newPosition = mix( position, goalPosition, mixAmount );\n                          gl_Position = projectionMatrix * modelViewMatrix * vec4( newPosition, 1.0 );\n                        }\n                      ",fragmentShader:"uniform sampler2D baseTexture;\n                          varying vec2 vUv;\n\n                          void main()\n                          {\n                              gl_FragColor = texture2D( baseTexture, vUv );\n                          }\n                        ",side:_,transparent:!0,opacity:1});o.sphere=new I(n,r),o.viewer.scene.add(o.sphere),o.render()}))})),n(this,"drawOutline",(function(){var e=o.R,t=new k,n=new F({uniforms:o.customUniforms,vertexShader:"uniform float mixAmount;\n                     attribute vec3 current;\n                        void main()\n                        {\n                          vec3 newPosition = mix( position, current, mixAmount );\n                          gl_Position = projectionMatrix * modelViewMatrix * vec4( newPosition, 1.0 );\n                        }\n                      ",fragmentShader:"void main()\n                        {\n                            gl_FragColor = vec4(1.0,1.0,1.0,0.2);\n                        }\n                      ",side:_,transparent:!0});o.fileLoader.load("propagate/data/world.json",(function(r){r.features.forEach((function(r){if("Polygon"===r.geometry.type){var a=[],i=[],s=r.geometry.coordinates[0]||[];if(0===s.length)return;s.forEach((function(t){a.push(t[0],t[1],0);var n=Pe(1.001*e,t[0],t[1]);i.push(n.x,n.y,n.z)})),t.add(o.drawLineLoop(a,i,n))}else"MultiPolygon"===r.geometry.type&&r.geometry.coordinates.forEach((function(r){var a=[],i=[],s=r[0]||[];0!==s.length&&(s.forEach((function(t){a.push(t[0],t[1],0);var n=Pe(1.001*e,t[0],t[1]);i.push(n.x,n.y,n.z)})),t.add(o.drawLineLoop(a,i,n)))}))})),o.viewer.scene.add(t),o.render()}),(function(e){o.viewer.onProgress("propagate/data/world.json",e)}))})),n(this,"drawLineLoop",(function(e,t,n){var r=new N,o=new Float32Array(t);return r.setAttribute("position",new B(o,3)),r.setAttribute("current",new B(new Float32Array(e),3)),new U(r,n)})),n(this,"drawShpae",(function(e,t){var n=[];e.forEach((function(e){n.push(new q(e[0],e[1]))}));var r=new H(n),o=new G(r);return new I(o,t)})),n(this,"drawLines",(function(e,t){var n=new V({color:14737632});t.forEach((function(e){var t=e.to,r=e.name,a=e.isLine;if(t&&a&&"曲阜"!==r){var i=o.draw2DLine(e,n),s=i.fly,l=i.point;o.group2D.add(s,l);var u=o.draw3DLine(e,n),c=u.fly,p=u.point;o.group3D.add(c,p),o.render()}}))})),n(this,"drawFlyLine",(function(e,t,n){var r=[],a=[],i=[],s=[];e.forEach((function(e,n){var o=n/(t-1);r.push({x:e.x,y:e.y,z:e.z}),i.push(o),s.push(n)})),r.forEach((function(e){a.push(e.x,e.y,e.z)}));var l=new N;l.setFromPoints(e),l.setAttribute("position",new X(a,3)),l.setAttribute("index",new X(i,1)),l.setAttribute("current",new X(s,1)),o.uniforms[n]={uColor:{value:new J(710128)},uRange:{value:20},uSize:{value:6},uTotal:{value:t},uTime:{value:0},uSpeed:{value:(4*Math.random()+4)/10}};var u=new F({transparent:!0,depthWrite:!1,depthTest:!1,blending:$,uniforms:o.uniforms[n],vertexShader:"\n        attribute float index;\n        attribute float current;\n        uniform float uTime;\n        uniform float uSize;\n        uniform float uSpeed;\n        uniform float uRange; // 展示区间\n        uniform float uTotal; // 粒子总数\n        uniform vec3 uColor;\n        varying vec3 vColor;\n        varying float vOpacity;\n        void main() {\n            // 需要当前显示的索引\n            float size = uSize;\n            float showNumber = uTotal * mod(uTime * uSpeed, 1.1);\n            if (showNumber > current && showNumber < current + uRange) {\n                float uIndex = ((current + uRange) - showNumber) / uRange;\n                size *= uIndex;\n                vOpacity = 1.0;\n            } else {\n                vOpacity = 0.0;\n            }\n            // 顶点着色器计算后的Position\n            vColor = uColor;\n            vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n            gl_Position = projectionMatrix * mvPosition;\n            // 大小\n            gl_PointSize = size * 300.0 / (-mvPosition.z);\n        }",fragmentShader:"\n        varying vec3 vColor;\n        varying float vOpacity;\n        void main() {\n            float distanceToCenter = distance(gl_PointCoord,vec2(0.5));\n            float strength = 1.0 - (distanceToCenter * 2.0);\n            if(vOpacity <= 0.0){\n              gl_FragColor = vec4(vColor, 0.0);\n            }else{\n              gl_FragColor = vec4(vColor, strength);\n            }\n        }"});return new Z(l,u)})),n(this,"drawLocation",(function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=new K({transparent:!0,side:_});o.textLoader.load("propagate/img/136.png",(function(r){e.forEach((function(e){var a=e.to,i=e.size,s=Number(i)+2,l=t?i:s>16?16:s;if(a){var u=new P(a[0],a[1],0),c=u.x,p=u.y,d=u.z,f=new ee(l,l);n.map=r;var v=new I(f,n);v.position.set(c,p,d+.02),o.group2D.add(v);var h=v.clone(),m=Ee(a[0],a[1]),y=m.phi,g=m.theta;h.position.setFromSphericalCoords(100,y,g);var w=new P;w.copy(h.position).multiplyScalar(2),h.lookAt(w),o.group3D.add(h)}})),o.render()}))})),n(this,"update",(function(){var e=o.clock.getElapsedTime();Object.keys(o.uniforms).forEach((function(t){o.uniforms[t].uTime.value=e})),o.render()})),t.useLoadingManager(),t.scene.add(this.group3D),this.viewer=t,this.textLoader=new D,this.textLoader.setCrossOrigin(""),this.fileLoader=new T(t.loadmanager),this.fileLoader.setResponseType("json"),this.fontLoad=new Le(t.loadmanager),this.clock=new j,this.uniforms={},this.listen()}return a(e,[{key:"useCss3Render",value:function(){var e=this,t=this.viewer.container.getBoundingClientRect(),n=t.width,r=t.height;this.labelRenderer=new ne,this.labelRenderer.setSize(n,r),this.labelRenderer.domElement.style.position="absolute",this.labelRenderer.domElement.style.top="0px";var o=this.labelRenderer.domElement;o.id="tempId",this.viewer.container.appendChild(o),this.controls=new M(this.viewer.camera,o),this.controls.addEventListener("change",(function(){e.render()})),this.controls.enablePan=!1,this.controls.minDistance=50,this.controls.maxDistance=250,this.controls.mouseButtons={LEFT:z.ROTATE,MIDDLE:z.DOLLY,RIGHT:z.PAN}}},{key:"startGame",value:function(){var e=this;this.viewer.scene.translateX(-10),this.viewer.scene.translateY(-15),this.loadSky(),this.drawLocation([{to:[117.045982,35.794391],size:35}],!0),this.fileLoader.load("propagate/data/map.json",(function(t){e.useCss3Render();var n=e.R;e.createEarth(n),e.drawOutline(),e.drawLines(n,t),e.createText(t),e.drawLocation(t)}),(function(t){e.viewer.onProgress("propagate/data/map.json",t)}))}},{key:"render",value:function(){var e;this.viewer.render(),null===(e=this.labelRenderer)||void 0===e||e.render(this.viewer.scene,this.viewer.camera)}},{key:"loadSky",value:function(){var e=this;this.textLoader.load("propagate/img/bg.png",(function(t){e.viewer.scene.background=t,e.render()}))}},{key:"draw2DLine",value:function(e,t){var n=e.from,r=e.to,o=e.name,a=new P(n[0],n[1],0),i=new P(r[0],r[1],0),s=a.clone().lerp(i,.5),l=a.clone().distanceTo(i);s.z+=l/3;var u=new Q(a,s,i),c=4*u.getLength(),p=u.getPoints(c),d=(new N).setFromPoints(p);return{fly:new W(d,t),point:this.drawFlyLine(p,c,"".concat(o,"2d"))}}},{key:"draw3DLine",value:function(e,t){var n,r,o,a,i,s,l,u,c,p,d,f,v,h,m,y,g,w,b,x,C,S,E,O,T,R,k=this.R,D=e.from,j=e.to,M=e.name,z=Ee(D[0],D[1]),A=z.phi,F=z.theta,_=(new P).setFromSphericalCoords(100,A,F),I=Ee(j[0],j[1]),B=I.phi,U=I.theta,q=(new P).setFromSphericalCoords(100,B,U),H=(n=_,r=q,o=new P(0,0,0),a=n.clone().sub(o),i=r.clone().sub(o),s=a.clone().cross(i).normalize(),l=new P(0,0,1),u=(new L).setFromUnitVectors(s,l),c=n.clone().applyQuaternion(u),p=r.clone().applyQuaternion(u),d=c.clone().add(p).multiplyScalar(.5).clone().sub(o).normalize(),f=new P(0,1,0),v=(new L).setFromUnitVectors(d,f),{startSphere:c.clone().applyQuaternion(v.clone()),endSphere:p.clone().applyQuaternion(v.clone()),quaternion:u.clone().invert().multiply(v.clone().invert())}),G=H.startSphere,V=H.endSphere,Q=G.clone().lerp(V,.5).normalize(),X=De(G,V,new P(0,0,0)),J=Q.multiplyScalar(k+k*X*.1),$=(m=V,y=J,g=(h=G).lengthSq(),w=m.lengthSq(),b=y.lengthSq(),x=h.x,C=h.y,S=m.x,E=m.y,O=y.x,T=y.y,new P((w*T+g*E+b*C-w*C-b*E-g*T)/(R=x*E+S*T+O*C-C*S-E*O-T*x)/2,(b*S+w*x+g*O-g*S-w*O-b*x)/R/2,0)),Z=Math.abs($.y-J.y),K=De(G,new P(0,-1,0),$),ee=-Math.PI/2+K,te=Math.PI-ee,ne=new Y($.x,$.y,Z,ee,te,!1),re=4*ne.getLength(),oe=ne.getPoints(re),ae=(new N).setFromPoints(oe),ie=new W(ae,t);return ie.quaternion.multiply(H.quaternion),{fly:ie,point:this.drawFlyLine(oe.map((function(e){return new P(e.x,e.y,0).applyQuaternion(H.quaternion)})),re,"".concat(M,"3d"))}}},{key:"createText",value:function(e){var t=this;e.forEach((function(e){var n=e.to,r=e.name,o=e.size,a=e.isLine;if(r&&a&&n){var i=document.createElement("div");i.style.fontSize="曲阜"===r?"20px":"12px",i.style.color="#ffffff",i.style.position="absolute",i.style.fontFamily="HanaA",i.style.whiteSpace="nowrap";var s="<span>".concat(r,"</span> ");o>1&&(s+='<span style="font-size:28px;vertical-align: sub;">'.concat(o,"</span> <span>所</span>")),i.innerHTML=s;var l=new re(i);l.name="2d",l.position.set(n[0],n[1]-1,0),l.scale.set(.15,.15,.15),"曲阜"==r&&(l.scale.set(.2,.2,.2),l.position.set(n[0],n[1]-4,0)),t.group2D.add(l);var u=l.clone();u.name="3d";var c=Ee(n[0],n[1]),p=c.phi,d=c.theta;u.position.setFromSphericalCoords(100,p,d);var f=new P;f.copy(u.position).multiplyScalar(2),u.lookAt(f),u.scale.set(.15,.15,.15),"曲阜"==r&&u.scale.set(.2,.2,.2),t.group3D.add(u),t.render()}}))}}]),e}(),De=function(e,t,n){var r=e.clone().sub(n).normalize(),o=t.clone().sub(n).normalize(),a=r.clone().dot(o);return Math.acos(a)};t("default",(function(){var t=o.exports.useRef(null),n=e(o.exports.useState("3D"),2),r=n[0],a=n[1],i=e(o.exports.useState(),2),s=i[0],l=i[1],u=e(o.exports.useState(),2),c=u[0],p=u[1];return o.exports.useEffect((function(){if(t.current){var e=new te(t.current);p(e),e.useOrbitControls();var n,r=new ke(e);l(r),r.startGame();return function e(){r.update(),n=requestAnimationFrame(e)}(),function(){cancelIdleCallback(n)}}}),[]),S("div",{className:"w-100% h-100% relative",children:S("div",{className:"gunplay w-100% h-100% ",ref:t,children:E(Se.Group,{className:"absolute top-20px right-20px z-999",buttonStyle:"solid",value:r,onChange:function(e){var t=e.target.value;if(s){var n="2D"===t?0:1;"2D"===t?(null==c||c.scene.remove(s.group3D),s.group3D.traverse((function(e){"3d"===e.name&&(e.element.style.display="none")})),s.controls.enablePan=!0,s.controls.enableRotate=!1,s.controls.mouseButtons={LEFT:z.PAN,MIDDLE:z.DOLLY,RIGHT:z.ROTATE}):(null==c||c.scene.remove(s.group2D),s.group2D.traverse((function(e){"2d"===e.name&&(e.element.style.display="none")})),s.controls.enablePan=!1,s.controls.enableRotate=!0,s.controls.mouseButtons={LEFT:z.ROTATE,MIDDLE:z.DOLLY,RIGHT:z.PAN}),s.controls.reset();!function e(){"2D"===t?n+=.01:n-=.01,n<1.01&&n>-.01?(s.sphere.scale.set(1+.8*n,1+.8*n,1+.8*n),s.customUniforms.mixAmount.value=n,requestAnimationFrame(e)):"2D"===t?(null==c||c.scene.add(s.group2D),s.group2D.traverse((function(e){"2d"===e.name&&(console.log("yyy"),e.element.style.display="block")}))):(null==c||c.scene.add(s.group3D),s.group3D.traverse((function(e){"3d"===e.name&&(e.element.style.display="block")})))}(),a(t)}},children:[S(Se.Button,{value:"2D",children:"2D"}),S(Se.Button,{value:"3D",children:"3D"})]})})})}))}}}))}();
