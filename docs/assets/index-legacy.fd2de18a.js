!function(){function e(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function o(e,t){return o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},o(e,t)}function a(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=c(e);if(t){var i=c(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return s(this,r)}}function s(e,r){if(r&&("object"===t(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}var u=document.createElement("style");u.innerHTML='#--unocss-hash--{content:"aa9d1343"}\n',document.head.appendChild(u),System.register(["./index-legacy.78fb91cb.js","./index-legacy.d88f4f85.js","./GLTFLoader-legacy.c48b3aa9.js"],(function(n){"use strict";var s,c,u,d,l,f,h,y,v,w,p,m,b,g;return{setters:[function(e){s=e.r,c=e.j},function(e){u=e.L,d=e.F,l=e.O,f=e.B,h=e.C,y=e.e,v=e.aq,w=e.s,p=e.ar,m=e.as,b=e.c},function(e){g=e.G}],execute:function(){var k=new WeakMap,_=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&o(e,t)}(s,e);var n=a(s);function s(e){var t;return r(this,s),(t=n.call(this,e)).decoderPath="",t.decoderConfig={},t.decoderBinary=null,t.decoderPending=null,t.workerLimit=4,t.workerPool=[],t.workerNextTaskID=1,t.workerSourceURL="",t.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},t.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"},t}return i(s,[{key:"setDecoderPath",value:function(e){return this.decoderPath=e,this}},{key:"setDecoderConfig",value:function(e){return this.decoderConfig=e,this}},{key:"setWorkerLimit",value:function(e){return this.workerLimit=e,this}},{key:"load",value:function(e,t,r,n){var i=this,o=new d(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(e){var r={attributeIDs:i.defaultAttributeIDs,attributeTypes:i.defaultAttributeTypes,useUniqueIDs:!1};i.decodeGeometry(e,r).then(t).catch(n)}),r,n)}},{key:"decodeDracoFile",value:function(e,t,r,n){var i={attributeIDs:r||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!r};this.decodeGeometry(e,i).then(t)}},{key:"decodeGeometry",value:function(e,t){var r=this;for(var n in t.attributeTypes){var i=t.attributeTypes[n];void 0!==i.BYTES_PER_ELEMENT&&(t.attributeTypes[n]=i.name)}var o,a=JSON.stringify(t);if(k.has(e)){var s=k.get(e);if(s.key===a)return s.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var c=this.workerNextTaskID++,u=e.byteLength,d=this._getWorker(c,u).then((function(r){return o=r,new Promise((function(r,n){o._callbacks[c]={resolve:r,reject:n},o.postMessage({type:"decode",id:c,taskConfig:t,buffer:e},[e])}))})).then((function(e){return r._createGeometry(e.geometry)}));return d.catch((function(){return!0})).then((function(){o&&c&&r._releaseTask(o,c)})),k.set(e,{key:a,promise:d}),d}},{key:"_createGeometry",value:function(e){var t=new l;e.index&&t.setIndex(new f(e.index.array,1));for(var r=0;r<e.attributes.length;r++){var n=e.attributes[r],i=n.name,o=n.array,a=n.itemSize;t.setAttribute(i,new f(o,a))}return t}},{key:"_loadLibrary",value:function(e,t){var r=new d(this.manager);return r.setPath(this.decoderPath),r.setResponseType(t),r.setWithCredentials(this.withCredentials),new Promise((function(t,n){r.load(e,t,void 0,n)}))}},{key:"preload",value:function(){return this._initDecoder(),this}},{key:"_initDecoder",value:function(){var e=this;if(this.decoderPending)return this.decoderPending;var r="object"!==("undefined"==typeof WebAssembly?"undefined":t(WebAssembly))||"js"===this.decoderConfig.type,n=[];return r?n.push(this._loadLibrary("draco_decoder.js","text")):(n.push(this._loadLibrary("draco_wasm_wrapper.js","text")),n.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(n).then((function(t){var n=t[0];r||(e.decoderConfig.wasmBinary=t[1]);var i=L.toString(),o=["/* draco decoder */",n,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");e.workerSourceURL=URL.createObjectURL(new Blob([o]))})),this.decoderPending}},{key:"_getWorker",value:function(e,t){var r=this;return this._initDecoder().then((function(){if(r.workerPool.length<r.workerLimit){var n=new Worker(r.workerSourceURL);n._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",decoderConfig:r.decoderConfig}),n.onmessage=function(e){var t=e.data;switch(t.type){case"decode":n._callbacks[t.id].resolve(t);break;case"error":n._callbacks[t.id].reject(t);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+t.type+'"')}},r.workerPool.push(n)}else r.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));var i=r.workerPool[r.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i}))}},{key:"_releaseTask",value:function(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}},{key:"debug",value:function(){console.log("Task load: ",this.workerPool.map((function(e){return e._taskLoad})))}},{key:"dispose",value:function(){for(var e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}]),s}(u);function L(){var e,t;function r(e,t,r,n,i,o){var a=o.num_components(),s=r.num_points()*a,c=s*i.BYTES_PER_ELEMENT,u=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,i),d=e._malloc(c);t.GetAttributeDataArrayForAllPoints(r,o,u,c,d);var l=new i(e.HEAPF32.buffer,d,s).slice();return e._free(d),{name:n,array:l,itemSize:a}}onmessage=function(n){var i=n.data;switch(i.type){case"init":e=i.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":var o=i.buffer,a=i.taskConfig;t.then((function(e){var t=e.draco,n=new t.Decoder,s=new t.DecoderBuffer;s.Init(new Int8Array(o),o.byteLength);try{var c=function(e,t,n,i){var o,a,s=i.attributeIDs,c=i.attributeTypes,u=t.GetEncodedGeometryType(n);if(u===e.TRIANGULAR_MESH)o=new e.Mesh,a=t.DecodeBufferToMesh(n,o);else{if(u!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");o=new e.PointCloud,a=t.DecodeBufferToPointCloud(n,o)}if(!a.ok()||0===o.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+a.error_msg());var d={index:null,attributes:[]};for(var l in s){var f=self[c[l]],h=void 0,y=void 0;if(i.useUniqueIDs)y=s[l],h=t.GetAttributeByUniqueId(o,y);else{if(-1===(y=t.GetAttributeId(o,e[s[l]])))continue;h=t.GetAttribute(o,y)}d.attributes.push(r(e,t,o,l,f,h))}u===e.TRIANGULAR_MESH&&(d.index=function(e,t,r){var n=3*r.num_faces(),i=4*n,o=e._malloc(i);t.GetTrianglesUInt32Array(r,i,o);var a=new Uint32Array(e.HEAPF32.buffer,o,n).slice();return e._free(o),{array:a,itemSize:1}}(e,t,o));return e.destroy(o),d}(t,n,s,a),u=c.attributes.map((function(e){return e.array.buffer}));c.index&&u.push(c.index.array.buffer),self.postMessage({type:"decode",id:i.id,geometry:c},u)}catch(d){console.error(d),self.postMessage({type:"error",id:i.id,error:d.message})}finally{t.destroy(s),t.destroy(n)}}))}}}var T=function(){function t(n){r(this,t),e(this,"game",void 0),e(this,"viewer",void 0),this.game=n,this.viewer=n.viewer,this.load()}return i(t,[{key:"load",value:function(){var e=this;this.game.gltfLoader.setPath("factory/glb/");var t=new _(this.viewer.loadmanager);t.setDecoderPath("factory/draco/"),this.game.gltfLoader.setDRACOLoader(t),this.game.gltfLoader.load("swat-guy2.glb",(function(t){e.viewer.scene.add(t.scene),e.game.render()}),(function(t){e.viewer.onProgress("swat-guy2.glb",t)}))}},{key:"initNpcs",value:function(){}}]),t}(),P=function(){function t(n){var i=this;r(this,t),e(this,"clock",void 0),e(this,"viewer",void 0),e(this,"gltfLoader",void 0),e(this,"factory",void 0),e(this,"fans",[]),e(this,"navMesh",void 0),e(this,"npcHandler",void 0),e(this,"update",(function(){var e=i.clock.getDelta();i.fans.forEach((function(t){return t.rotateY(e)})),i.render()})),this.viewer=n,n.useLoadingManager(),this.clock=new h,this.gltfLoader=new g(n.loadmanager),this.init(),this.loadFactory(),this.npcHandler=new T(this)}return i(t,[{key:"init",value:function(){var e=2102544;this.viewer.scene.background=new y(e),this.viewer.scene.fog=new v(e,100,200),this.viewer.renderer.outputEncoding=w,this.viewer.camera.position.set(0,60,20),this.viewer.camera.lookAt(0,0,-10),this.viewer.renderer.shadowMap.enabled=!0;var t=new p(16777215,12303359,1);this.viewer.scene.add(t),this.viewer.directionalLight.position.set(0,20,20),this.viewer.directionalLight.target.position.set(-2,0,0),this.viewer.directionalLight.castShadow=!0,this.viewer.directionalLight.shadow.mapSize.set(1024,512),this.viewer.directionalLight.shadow.camera.near=.5,this.viewer.directionalLight.shadow.camera.far=50;this.viewer.directionalLight.shadow.camera.left=-30,this.viewer.directionalLight.shadow.camera.right=30,this.viewer.directionalLight.shadow.camera.top=30,this.viewer.directionalLight.shadow.camera.bottom=-7.5;var r=new m(this.viewer.directionalLight.shadow.camera);this.viewer.scene.add(r)}},{key:"render",value:function(){this.viewer.render()}},{key:"loadFactory",value:function(){var e=this;this.gltfLoader.setPath("factory/glb/"),this.gltfLoader.load("factory2.glb",(function(t){e.factory=t.scene,e.viewer.scene.add(e.factory),e.fans=[],e.factory.traverse((function(t){t.isMesh&&("NavMesh"===t.name?(e.navMesh=t,t.material.transparent=!0,t.material.opacity=.5,t.material.wireframe=!0):t.name.includes("fan")?e.fans.push(t):t.material.name.includes("elements2")||t.material.name.includes("elements5")||t.material.name.includes("terrain")?t.castShadow=!0:t.material.name.includes("sand")?t.receiveShadow=!0:t.material.name.includes("elements1")?(t.castShadow=!0,t.receiveShadow=!0):t.parent.name.includes("main")&&(t.castShadow=!0))})),e.viewer.scene.add(e.navMesh),e.render()}),(function(t){e.viewer.onProgress("factory.glb",t)}))}}]),t}();n("default",(function(){var e=s.exports.useRef(null);return s.exports.useEffect((function(){if(e.current){var t=new b(e.current);t.useOrbitControls(),t.listen();var r,n=new P(t);return function e(){n.update(),r=requestAnimationFrame(e)}(),function(){cancelIdleCallback(r)}}}),[]),c("div",{className:"w-100% h-100% relative",children:c("div",{className:"gunplay w-100% h-100%",ref:e})})}))}}}))}();
