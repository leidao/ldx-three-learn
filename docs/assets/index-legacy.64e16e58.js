!function(){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,n){return t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},t(e,n)}function n(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=i(e);if(t){var a=i(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return o(this,n)}}function o(t,n){if(n&&("object"===e(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return r(t)}function r(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function i(e){return i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},i(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function c(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}System.register(["./LoadingBar-legacy.c6dd5fb4.js"],(function(e){"use strict";var o,i,s,l,d,f,h,v,p,y,m,g,w,b;return{setters:[function(e){o=e.A,i=e.c,s=e.d,l=e.R,d=e.L,f=e.e,h=e.f,v=e.P,p=e.W,y=e.g,m=e.O,g=e.D,w=e.h,b=e.i}],execute:function(){var L=function(){function e(){var t;a(this,e),u(this,"eventBus",{all:t=t||new Map,on:function(e,n){var o=t.get(e);o?o.push(n):t.set(e,[n])},off:function(e,n){var o=t.get(e);o&&(n?o.splice(o.indexOf(n)>>>0,1):t.set(e,[]))},emit:function(e,n){var o=t.get(e);o&&o.slice().map((function(e){e(n)})),(o=t.get("*"))&&o.slice().map((function(t){t(e,n)}))}})}return c(e,[{key:"on",value:function(e,t){this.eventBus.on(e,t)}},{key:"off",value:function(e,t){this.eventBus.off(e,t)}},{key:"emit",value:function(e){for(var t,n=arguments.length,o=new Array(n>1?n-1:0),r=1;r<n;r++)o[r-1]=arguments[r];(t=this.eventBus).emit.apply(t,[e].concat(o))}}]),e}(),P=function(){function e(t,n){a(this,e),u(this,"camera",void 0),u(this,"audioLoader",void 0),u(this,"loadmanager",void 0),u(this,"sounds",{}),this.camera=t,this.loadmanager=n,this.useAudioLoader()}return c(e,[{key:"useAudioLoader",value:function(){this.audioLoader=new o(this.loadmanager)}},{key:"loadMusic",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,r=new i;this.camera.add(r);var a=new s(r);this.audioLoader.setPath(t),this.audioLoader.load(e,(function(e){a.setBuffer(e),a.setLoop(n),a.setVolume(o)})),this.sounds[e]=a}},{key:"setVolume",value:function(e,t){var n=this.sounds[e];n&&n.setVolume(t)}},{key:"setLoop",value:function(e,t){var n=this.sounds[e];n&&n.setLoop(t)}},{key:"setPlay",value:function(e){var t=this.sounds[e];t&&!t.isPlaying&&t.play()}},{key:"setStop",value:function(e){var t=this.sounds[e];t&&t.isPlaying&&t.stop()}},{key:"setStopAll",value:function(){var e=this;Object.keys(this.sounds).forEach((function(t){e.setStop(t)}))}},{key:"pause",value:function(e){var t=this.sounds[e];t&&t.isPlaying&&t.pause()}}]),e}(),k=16777215,O=16777215;e("V",function(e){!function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&t(e,n)}(i,e);var o=n(i);function i(e){var t;return a(this,i),u(r(t=o.call(this)),"scene",void 0),u(r(t),"camera",void 0),u(r(t),"renderer",void 0),u(r(t),"controls",void 0),u(r(t),"raycaster",void 0),u(r(t),"container",void 0),u(r(t),"directionalLight",void 0),u(r(t),"loadmanager",void 0),u(r(t),"music",void 0),u(r(t),"loadingBar",void 0),u(r(t),"onProgress",void 0),u(r(t),"useOrbitControls",(function(){t.controls=new w(t.camera,t.renderer.domElement),t.controls.addEventListener("change",(function(){t.render()}))})),u(r(t),"render",(function(){t.renderer.render(t.scene,t.camera)})),u(r(t),"onResize",(function(){var e=t.container.getBoundingClientRect(),n=e.width,o=e.height,r=n/o;t.renderer.setSize(n,o),t.camera.aspect=r,t.camera.updateProjectionMatrix(),t.render()})),u(r(t),"listen",(function(){window.addEventListener("resize",t.onResize)})),u(r(t),"destroy",(function(){window.removeEventListener("resize",t.onResize)})),t.container=e,t.initScene(),t.raycaster=new l,t.loadingBar=new d,t.music=new P(t.camera,t.loadmanager),t}return c(i,[{key:"initScene",value:function(){var e=this.container.getBoundingClientRect(),t=e.width,n=e.height;this.scene=new f,this.scene.background=new h(11184810);var o=t/n;this.camera=new v(45,o,1,1e3),this.camera.up.y=1;var r=this.scene.position;this.camera.lookAt(r),this.camera.position.set(0,0,180),this.renderer=new p({antialias:!0,alpha:!0}),this.renderer.setClearColor(0,0),this.renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.renderer.setSize(t,n),this.renderer.shadowMap.enabled=!1,this.container.appendChild(this.renderer.domElement);var i=new y(k,1);this.scene.add(i);var a=new m;a.position.set(0,0,0),this.directionalLight=new g(O,1),this.directionalLight.position.set(0,0,500),this.directionalLight.target=a,this.scene.add(a),this.scene.add(this.directionalLight),this.restoreContext()}},{key:"restoreContext",value:function(){var e=this;this.renderer.domElement.addEventListener("webglcontextlost",(function(t){t.preventDefault(),setTimeout((function(){e.renderer.forceContextRestore()}),1)}))}},{key:"useLoadingManager",value:function(){var e=this,t=new Map;this.loadmanager=new b,this.loadmanager.onStart=function(){e.loadingBar.visible=!0},this.loadmanager.onLoad=function(){e.emit("load_complete"),e.loadingBar.visible=!1},this.loadmanager.onError=function(e){console.log("资源加载出错：",e)},this.onProgress=function(n,o){var r=t.get(n);r?(r.loaded=o.loaded,r.total=o.total):t.set(n,{loaded:o.loaded,total:o.total}),e.loadingBar.update(t)}}}]),i}(L))}}}))}();
