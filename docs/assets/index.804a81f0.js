var E=Object.defineProperty;var L=(o,e,t)=>e in o?E(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var i=(o,e,t)=>(L(o,typeof e!="symbol"?e+"":e,t),t);import{r as p,b as w,j as h}from"./index.7b733e4f.js";import{G as v,C as P,T as F,F as k,s as S,g as u,ap as f,M as m,ay as z,H as b,am as A,c as B}from"./index.2265f9dd.js";import{C as D,b as M}from"./CSS3DRenderer.134f8d33.js";var N="/ldx-three-learn/nebularOrbit/img/\u661F\u7403.png",R="/ldx-three-learn/nebularOrbit/img/point.png",O="/ldx-three-learn/nebularOrbit/img/point_active.png";class I{constructor(e){i(this,"clock");i(this,"viewer");i(this,"css3Render");i(this,"textLoader");i(this,"fileLoader");i(this,"group",new v);i(this,"isRotate",!0);i(this,"onResize",()=>{const{width:e,height:t}=this.viewer.container.getBoundingClientRect(),s=e/t;this.viewer.renderer.setSize(e,t),this.css3Render.setSize(e,t),this.viewer.camera.aspect=s,this.viewer.camera.updateProjectionMatrix(),this.render()});i(this,"listen",()=>{window.addEventListener("resize",this.onResize)});i(this,"destroy",()=>{window.removeEventListener("resize",this.onResize)});i(this,"update",()=>{const e=this.clock.getDelta();this.isRotate&&this.group.rotateZ(e*.1),this.render()});this.viewer=e,e.useLoadingManager(),this.clock=new P,this.group=new v,this.group.rotation.set(-Math.PI/2.6,-Math.PI/8,0),this.group.position.set(10,30,0),this.group.scale.set(1.16,1.16,1.16),e.scene.add(this.group),this.textLoader=new F(e.loadmanager),this.textLoader.setCrossOrigin(""),this.fileLoader=new k(e.loadmanager),this.init()}init(){const{width:e,height:t}=this.viewer.container.getBoundingClientRect();this.css3Render=new D,this.css3Render.setSize(e,t),this.css3Render.domElement.style.position="absolute",this.css3Render.domElement.style.pointerEvents="none",this.css3Render.domElement.style.top="0px",this.css3Render.domElement.style.left="0px";const s=this.css3Render.domElement;s.id="css3Render",this.viewer.container.appendChild(s),this.loadSky(),this.createCircle(),this.createRing(),this.createLine()}render(){var e;this.viewer.render(),(e=this.css3Render)==null||e.render(this.viewer.scene,this.viewer.camera)}loadSky(){this.textLoader.setPath("nebularOrbit/img/"),this.textLoader.load("\u80CC\u666F\u661F\u7A7A\u56FE.png",e=>{this.viewer.scene.background=e,this.render()},e=>{this.viewer.onProgress("\u80CC\u666F\u661F\u7A7A\u56FE.png",e)})}createCircle(){this.textLoader.setPath("nebularOrbit/img/"),this.textLoader.load("\u751F\u5E73-\u80CC\u666F\u5708.png",e=>{e.encoding=S;const t=new u({map:e,transparent:!0,opacity:.5}),s=new f(230,240),a=new m(s,t);a.rotation.set(0,0,0),this.group.add(a),this.render()},e=>{this.viewer.onProgress("\u751F\u5E73-\u80CC\u666F\u5708.png",e)})}createRing(){const e=new z(80,80.8,200),t=new u({color:16777215,side:b,transparent:!0,opacity:.4}),s=new m(e,t);s.position.set(0,0,-1),this.group.add(s)}createLine(){this.fileLoader.setPath("nebularOrbit/data/"),this.fileLoader.load("\u5B54\u5B50\u751F\u5E73.json",e=>{const t=(JSON.parse(e)||{}).lifetime||[],a=new A(0,0,80.5,1.6,1.6+2*Math.PI,!1).getPoints(270),r=[];for(let n=0;n<27;n++){const d=n*10;r.push(a[d])}let c;for(let n=0;n<r.length;n++){const d=r[n],l=this.createPoint(t[n],n);l.element.addEventListener("click",()=>{if(c){const x=c.getElementsByClassName("circle-img")[0];x.src=R,x.style.transform="scale(1)"}const g=l.element.getElementsByClassName("circle-img")[0];g.src=O,g.style.transform="scale(2)",c=l.element;const y=+(l.element.getAttribute("_pointIndex")||0),C=t[y];this.viewer.emit("point_click",C)}),l.element.addEventListener("mouseenter",()=>{this.isRotate=!1}),l.element.addEventListener("mouseleave",()=>{this.isRotate=!0}),l.position.set(d.x,d.y,0),this.group.add(l),this.render()}},e=>{this.viewer.onProgress("\u5B54\u5B50\u751F\u5E73.json",e)})}createPoint(e,t){const s=document.createElement("div");s.setAttribute("_pointIndex",t);const a=`
  <div style="position:relative;top:10px;left:0;width:60px;height:60px;cursor: pointer;">
    <img class="circle-img" width=60 height=60 style="position:relative;top:0;left:0;transition:0.5s;" src='${R}' />
    <div class="circle-text" style="width:80px;position:relative;top:-18px;left:0;color:#fff; text-align: center;font-size:12px">${e.time}</div>
  </div>
`;s.innerHTML=a;const r=new M(s),c=.1;return r.userData.index=t,r.scale.set(c,c,c),r.userData.isCss23D=!0,r}creatPlan(){this.textLoader.setPath("nebularOrbit/img/"),this.textLoader.load("\u661F\u7403.png",e=>{const t=new u({transparent:!0,opacity:.8,side:b,map:e}),s=new f(200,200),a=new m(s,t);this.viewer.scene.add(a)},e=>{this.viewer.onProgress("\u661F\u7403.png",e)})}}const $=()=>{const o=p.exports.useRef(null),[e,t]=p.exports.useState();return p.exports.useEffect(()=>{if(!o.current)return;const s=new B(o.current);s.on("point_click",n=>{t(n)});const a=new I(s);let r;const c=()=>{a.update(),r=requestAnimationFrame(c)};return c(),()=>{cancelIdleCallback(r)}},[]),w("div",{className:"w-100% h-100% relative",children:[h("div",{className:"gunplay w-100% h-100%",ref:o}),(e==null?void 0:e.time)&&w("div",{className:"absolute left-40px top-20px z-999 text-#fff w-342px",children:[h("div",{className:"text-36px border-b-2px pb-10px",children:e==null?void 0:e.time}),h("div",{className:"text-16px pt-14px max-h-500px overflow-auto font-normal",children:e==null?void 0:e.description})]}),h("div",{className:"mask fixed top--325px right--404px w-1291px h-1293px",style:{backgroundImage:`url(${N})`,backgroundRepeat:"no-repeat",backgroundSize:"100% 100%",backgroundPosition:"-100px -100px",pointerEvents:"none"}})]})};export{$ as default};
