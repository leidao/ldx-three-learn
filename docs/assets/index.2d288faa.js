var C=Object.defineProperty;var E=(o,e,t)=>e in o?C(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var i=(o,e,t)=>(E(o,typeof e!="symbol"?e+"":e,t),t);import{r as h,a as x,j as p}from"./index.f88ef442.js";import{G as v,C as L,T as P,F,s as k,g as u,ap as f,M as m,at as S,H as b,am as z,c as A}from"./index.577fe09e.js";import{C as B,b as D}from"./CSS3DRenderer.7a988f81.js";class M{constructor(e){i(this,"clock");i(this,"viewer");i(this,"css3Render");i(this,"textLoader");i(this,"fileLoader");i(this,"group",new v);i(this,"isRotate",!0);i(this,"onResize",()=>{const{width:e,height:t}=this.viewer.container.getBoundingClientRect(),s=e/t;this.viewer.renderer.setSize(e,t),this.css3Render.setSize(e,t),this.viewer.camera.aspect=s,this.viewer.camera.updateProjectionMatrix(),this.render()});i(this,"listen",()=>{window.addEventListener("resize",this.onResize)});i(this,"destroy",()=>{window.removeEventListener("resize",this.onResize)});i(this,"update",()=>{const e=this.clock.getDelta();this.isRotate&&this.group.rotateZ(e*.1),this.render()});this.viewer=e,e.useLoadingManager(),this.clock=new L,this.group=new v,this.textLoader=new P(e.loadmanager),this.textLoader.setCrossOrigin(""),this.fileLoader=new F(e.loadmanager),e.scene.add(this.group),this.init(),e.on("load_complete",()=>{this.group.rotation.set(-Math.PI/2.6,-Math.PI/8,0),this.group.position.set(10,30,0),this.group.scale.set(1.16,1.16,1.16)})}init(){const{width:e,height:t}=this.viewer.container.getBoundingClientRect();this.css3Render=new B,this.css3Render.setSize(e,t),this.css3Render.domElement.style.position="absolute",this.css3Render.domElement.style.pointerEvents="none",this.css3Render.domElement.style.top="0px",this.css3Render.domElement.style.left="0px";const s=this.css3Render.domElement;s.id="css3Render",this.viewer.container.appendChild(s),this.loadSky(),this.createCircle(),this.createRing(),this.createLine()}render(){var e;this.viewer.render(),(e=this.css3Render)==null||e.render(this.viewer.scene,this.viewer.camera)}loadSky(){this.textLoader.setPath("nebularOrbit/img/"),this.textLoader.load("\u80CC\u666F\u661F\u7A7A\u56FE.png",e=>{this.viewer.scene.background=e,this.render()},e=>{this.viewer.onProgress("\u80CC\u666F\u661F\u7A7A\u56FE.png",e)})}createCircle(){this.textLoader.setPath("nebularOrbit/img/"),this.textLoader.load("\u751F\u5E73-\u80CC\u666F\u5708.png",e=>{e.encoding=k;const t=new u({map:e,transparent:!0,opacity:.5}),s=new f(230,240),a=new m(s,t);a.rotation.set(0,0,0),this.group.add(a),this.render()},e=>{this.viewer.onProgress("\u751F\u5E73-\u80CC\u666F\u5708.png",e)})}createRing(){const e=new S(80,80.8,200),t=new u({color:16777215,side:b,transparent:!0,opacity:.4}),s=new m(e,t);s.position.set(0,0,-1),this.group.add(s)}createLine(){this.fileLoader.setPath("nebularOrbit/data/"),this.fileLoader.load("\u5B54\u5B50\u751F\u5E73.json",e=>{const t=(JSON.parse(e)||{}).lifetime||[],a=new z(0,0,80.5,1.6,1.6+2*Math.PI,!1).getPoints(270),n=[];for(let r=0;r<27;r++){const d=r*10;n.push(a[d])}let c;for(let r=0;r<n.length;r++){const d=n[r],l=this.createPoint(t[r],r);l.element.addEventListener("click",()=>{if(c){const w=c.getElementsByClassName("circle-img")[0];w.src="nebularOrbit/img/point.png",w.style.transform="scale(1)"}const g=l.element.getElementsByClassName("circle-img")[0];g.src="nebularOrbit/img/point_active.png",g.style.transform="scale(2)",c=l.element;const R=+(l.element.getAttribute("_pointIndex")||0),y=t[R];this.viewer.emit("point_click",y)}),l.element.addEventListener("mouseenter",()=>{this.isRotate=!1}),l.element.addEventListener("mouseleave",()=>{this.isRotate=!0}),l.position.set(d.x,d.y,0),this.group.add(l),this.render()}},e=>{this.viewer.onProgress("\u5B54\u5B50\u751F\u5E73.json",e)})}createPoint(e,t){const s=document.createElement("div");s.setAttribute("_pointIndex",t);const a=`
  <div style="position:relative;top:10px;left:0;width:60px;height:60px;cursor: pointer;">
    <img class="circle-img" width=60 height=60 style="position:relative;top:0;left:0;transition:0.5s;" src='/nebularOrbit/img/point.png' />
    <div class="circle-text" style="width:80px;position:relative;top:-18px;left:0;color:#fff; text-align: center;font-size:12px">${e.time}</div>
  </div>
`;s.innerHTML=a;const n=new D(s),c=.1;return n.userData.index=t,n.scale.set(c,c,c),n.userData.isCss23D=!0,n}creatPlan(){this.textLoader.setPath("nebularOrbit/img/"),this.textLoader.load("\u661F\u7403.png",e=>{const t=new u({transparent:!0,opacity:.8,side:b,map:e}),s=new f(200,200),a=new m(s,t);this.viewer.scene.add(a)},e=>{this.viewer.onProgress("\u661F\u7403.png",e)})}}const G=()=>{const o=h.exports.useRef(null),[e,t]=h.exports.useState();return h.exports.useEffect(()=>{if(!o.current)return;const s=new A(o.current);s.on("point_click",r=>{t(r)});const a=new M(s);let n;const c=()=>{a.update(),n=requestAnimationFrame(c)};return c(),()=>{cancelIdleCallback(n)}},[]),x("div",{className:"w-100% h-100% relative",children:[p("div",{className:"gunplay w-100% h-100%",ref:o}),(e==null?void 0:e.time)&&x("div",{className:"absolute left-40px top-20px z-999 text-#fff w-342px",children:[p("div",{className:"text-36px border-b-2px pb-10px",children:e==null?void 0:e.time}),p("div",{className:"text-16px pt-14px max-h-500px overflow-auto font-normal",children:e==null?void 0:e.description})]}),p("div",{className:"mask fixed top--325px right--404px w-1291px h-1293px",style:{backgroundImage:"url('/nebularOrbit/img/\u661F\u7403.png')",backgroundRepeat:"no-repeat",backgroundSize:"100% 100%",backgroundPosition:"-100px -100px",pointerEvents:"none"}})]})};export{G as default};
