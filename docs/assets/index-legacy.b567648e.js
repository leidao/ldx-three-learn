!function(){function e(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function t(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(c){s=!0,i=c}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}(e,t)||r(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=r(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){c=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw a}}}}function r(e,t){if(e){if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function a(){return a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=s(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},a.apply(this,arguments)}function s(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=m(e)););return e}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return t&&l(e.prototype,t),n&&l(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&v(e,t)}function v(e,t){return v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},v(e,t)}function f(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m(e);if(t){var i=m(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p(this,n)}}function p(e,t){if(t&&("object"===o(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return h(e)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function m(e){return m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},m(e)}var g=document.createElement("style");g.innerHTML='#--unocss-hash--{content:"e4dcb3cb"}\n',document.head.appendChild(g),System.register(["./index-legacy.1897a3de.js","./index-legacy.ec1c8e51.js","./button-legacy.04f44363.js"],(function(r){"use strict";var i,s,l,v,p,g,y,x,w,b,T,_,P,R,S,M,E,A,z,L,k,C,I,O,N,F,H,U,D,j,G,K,B,V,q,X,W,Y,Q,J,Z,$,ee,te,ne,re,ie,oe,ae,se,ce,le,ue,de,ve,fe,pe,he,me,ge,ye,xe,we,be,Te,_e,Pe,Re,Se,Me,Ee,Ae,ze,Le,ke,Ce;return{setters:[function(e){i=e.r,s=e.A,l=e._,v=e.D,p=e.j,g=e.a},function(e){y=e.L,x=e.a,w=e.F,b=e.C,T=e.S,_=e.P,P=e.D,R=e.M,S=e.b,M=e.V,E=e.s,A=e.c,z=e.T,L=e.I,k=e.Q,C=e.N,I=e.d,O=e.e,N=e.f,F=e.g,H=e.h,U=e.i,D=e.j,j=e.R,G=e.k,K=e.l,B=e.m,V=e.n,q=e.o,X=e.p,W=e.B,Y=e.q,Q=e.r,J=e.t,Z=e.u,$=e.v,ee=e.w,te=e.x,ne=e.y,re=e.z,ie=e.A,oe=e.E,ae=e.G,se=e.H,ce=e.J,le=e.K,ue=e.O,de=e.U,ve=e.W,fe=e.X,pe=e.Y,he=e.Z,me=e._,ge=e.$,ye=e.a0,xe=e.a1,we=e.a2,be=e.a3,Te=e.a4,_e=e.a5,Pe=e.a6,Re=e.a7,Se=e.a8,Me=e.a9,Ee=e.aa,Ae=e.ab,ze=e.ac,Le=e.ad,ke=e.ae},function(e){Ce=e.B}],execute:function(){var Ie={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M409.4 128c-42.4 0-76.7 34.4-76.7 76.8 0 20.3 8.1 39.9 22.4 54.3a76.74 76.74 0 0054.3 22.5h76.7v-76.8c0-42.3-34.3-76.7-76.7-76.8zm0 204.8H204.7c-42.4 0-76.7 34.4-76.7 76.8s34.4 76.8 76.7 76.8h204.6c42.4 0 76.7-34.4 76.7-76.8.1-42.4-34.3-76.8-76.6-76.8zM614 486.4c42.4 0 76.8-34.4 76.7-76.8V204.8c0-42.4-34.3-76.8-76.7-76.8-42.4 0-76.7 34.4-76.7 76.8v204.8c0 42.5 34.3 76.8 76.7 76.8zm281.4-76.8c0-42.4-34.4-76.8-76.7-76.8S742 367.2 742 409.6v76.8h76.7c42.3 0 76.7-34.4 76.7-76.8zm-76.8 128H614c-42.4 0-76.7 34.4-76.7 76.8 0 20.3 8.1 39.9 22.4 54.3a76.74 76.74 0 0054.3 22.5h204.6c42.4 0 76.7-34.4 76.7-76.8.1-42.4-34.3-76.7-76.7-76.8zM614 742.4h-76.7v76.8c0 42.4 34.4 76.8 76.7 76.8 42.4 0 76.8-34.4 76.7-76.8.1-42.4-34.3-76.7-76.7-76.8zM409.4 537.6c-42.4 0-76.7 34.4-76.7 76.8v204.8c0 42.4 34.4 76.8 76.7 76.8 42.4 0 76.8-34.4 76.7-76.8V614.4c0-20.3-8.1-39.9-22.4-54.3a76.92 76.92 0 00-54.3-22.5zM128 614.4c0 20.3 8.1 39.9 22.4 54.3a76.74 76.74 0 0054.3 22.5c42.4 0 76.8-34.4 76.7-76.8v-76.8h-76.7c-42.3 0-76.7 34.4-76.7 76.8z"}}]},name:"slack",theme:"outlined"},Oe=function(e,t){return i.exports.createElement(s,l(l({},e),{},{ref:t,icon:Ie}))};Oe.displayName="SlackOutlined";var Ne=i.exports.forwardRef(Oe),Fe=function(e){d(n,e);var t=f(n);function n(e){var r;return c(this,n),(r=t.call(this,e)).dracoLoader=null,r.ktx2Loader=null,r.meshoptDecoder=null,r.pluginCallbacks=[],r.register((function(e){return new Ge(e)})),r.register((function(e){return new We(e)})),r.register((function(e){return new Ye(e)})),r.register((function(e){return new Ke(e)})),r.register((function(e){return new Be(e)})),r.register((function(e){return new Ve(e)})),r.register((function(e){return new qe(e)})),r.register((function(e){return new Xe(e)})),r.register((function(e){return new De(e)})),r.register((function(e){return new Qe(e)})),r}return u(n,[{key:"load",value:function(e,t,n,r){var i,o=this;i=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:x.extractUrlBase(e),this.manager.itemStart(e);var a=function(t){r?r(t):console.error(t),o.manager.itemError(e),o.manager.itemEnd(e)},s=new w(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(n){try{o.parse(n,i,(function(n){t(n),o.manager.itemEnd(e)}),a)}catch(r){a(r)}}),n,a)}},{key:"setDRACOLoader",value:function(e){return this.dracoLoader=e,this}},{key:"setDDSLoader",value:function(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}},{key:"setKTX2Loader",value:function(e){return this.ktx2Loader=e,this}},{key:"setMeshoptDecoder",value:function(e){return this.meshoptDecoder=e,this}},{key:"register",value:function(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}},{key:"unregister",value:function(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}},{key:"parse",value:function(e,t,n,r){var i,o={},a={};if("string"==typeof e)i=e;else if(x.decodeText(new Uint8Array(e,0,4))===Je){try{o[Ue.KHR_BINARY_GLTF]=new et(e)}catch(p){return void(r&&r(p))}i=o[Ue.KHR_BINARY_GLTF].content}else i=x.decodeText(new Uint8Array(e));var s=JSON.parse(i);if(void 0===s.asset||s.asset.version[0]<2)r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var c=new Lt(s,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(var l=0;l<this.pluginCallbacks.length;l++){var u=this.pluginCallbacks[l](c);a[u.name]=u,o[u.name]=!0}if(s.extensionsUsed)for(var d=0;d<s.extensionsUsed.length;++d){var v=s.extensionsUsed[d],f=s.extensionsRequired||[];switch(v){case Ue.KHR_MATERIALS_UNLIT:o[v]=new je;break;case Ue.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:o[v]=new it;break;case Ue.KHR_DRACO_MESH_COMPRESSION:o[v]=new tt(s,this.dracoLoader);break;case Ue.KHR_TEXTURE_TRANSFORM:o[v]=new nt;break;case Ue.KHR_MESH_QUANTIZATION:o[v]=new ot;break;default:f.indexOf(v)>=0&&void 0===a[v]&&console.warn('THREE.GLTFLoader: Unknown extension "'+v+'".')}}c.setExtensions(o),c.setPlugins(a),c.parse(n,r)}}},{key:"parseAsync",value:function(e,t){var n=this;return new Promise((function(r,i){n.parse(e,t,r,i)}))}}]),n}(y);function He(){var e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}var Ue={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"},De=function(){function e(t){c(this,e),this.parser=t,this.name=Ue.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}return u(e,[{key:"_markDefs",value:function(){for(var e=this.parser,t=this.parser.json.nodes||[],n=0,r=t.length;n<r;n++){var i=t[n];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}},{key:"_loadLight",value:function(e){var t=this.parser,n="light:"+e,r=t.cache.get(n);if(r)return r;var i,o=t.json,a=((o.extensions&&o.extensions[this.name]||{}).lights||[])[e],s=new b(16777215);void 0!==a.color&&s.fromArray(a.color);var c=void 0!==a.range?a.range:0;switch(a.type){case"directional":(i=new P(s)).target.position.set(0,0,-1),i.add(i.target);break;case"point":(i=new _(s)).distance=c;break;case"spot":(i=new T(s)).distance=c,a.spot=a.spot||{},a.spot.innerConeAngle=void 0!==a.spot.innerConeAngle?a.spot.innerConeAngle:0,a.spot.outerConeAngle=void 0!==a.spot.outerConeAngle?a.spot.outerConeAngle:Math.PI/4,i.angle=a.spot.outerConeAngle,i.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,i.target.position.set(0,0,-1),i.add(i.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}return i.position.set(0,0,0),i.decay=2,void 0!==a.intensity&&(i.intensity=a.intensity),i.name=t.createUniqueName(a.name||"light_"+e),r=Promise.resolve(i),t.cache.add(n,r),r}},{key:"createNodeAttachment",value:function(e){var t=this,n=this.parser,r=n.json.nodes[e],i=(r.extensions&&r.extensions[this.name]||{}).light;return void 0===i?null:this._loadLight(i).then((function(e){return n._getNodeRef(t.cache,i,e)}))}}]),e}(),je=function(){function e(){c(this,e),this.name=Ue.KHR_MATERIALS_UNLIT}return u(e,[{key:"getMaterialType",value:function(){return R}},{key:"extendParams",value:function(e,t,n){var r=[];e.color=new b(1,1,1),e.opacity=1;var i=t.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){var o=i.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}void 0!==i.baseColorTexture&&r.push(n.assignTexture(e,"map",i.baseColorTexture))}return Promise.all(r)}}]),e}(),Ge=function(){function e(t){c(this,e),this.parser=t,this.name=Ue.KHR_MATERIALS_CLEARCOAT}return u(e,[{key:"getMaterialType",value:function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?S:null}},{key:"extendMaterialParams",value:function(e,t){var n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var i=[],o=r.extensions[this.name];if(void 0!==o.clearcoatFactor&&(t.clearcoat=o.clearcoatFactor),void 0!==o.clearcoatTexture&&i.push(n.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),void 0!==o.clearcoatRoughnessFactor&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),void 0!==o.clearcoatRoughnessTexture&&i.push(n.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),void 0!==o.clearcoatNormalTexture&&(i.push(n.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),void 0!==o.clearcoatNormalTexture.scale)){var a=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new M(a,a)}return Promise.all(i)}}]),e}(),Ke=function(){function e(t){c(this,e),this.parser=t,this.name=Ue.KHR_MATERIALS_SHEEN}return u(e,[{key:"getMaterialType",value:function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?S:null}},{key:"extendMaterialParams",value:function(e,t){var n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var i=[];t.sheenColor=new b(0,0,0),t.sheenRoughness=0,t.sheen=1;var o=r.extensions[this.name];return void 0!==o.sheenColorFactor&&t.sheenColor.fromArray(o.sheenColorFactor),void 0!==o.sheenRoughnessFactor&&(t.sheenRoughness=o.sheenRoughnessFactor),void 0!==o.sheenColorTexture&&i.push(n.assignTexture(t,"sheenColorMap",o.sheenColorTexture)),void 0!==o.sheenRoughnessTexture&&i.push(n.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(i)}}]),e}(),Be=function(){function e(t){c(this,e),this.parser=t,this.name=Ue.KHR_MATERIALS_TRANSMISSION}return u(e,[{key:"getMaterialType",value:function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?S:null}},{key:"extendMaterialParams",value:function(e,t){var n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var i=[],o=r.extensions[this.name];return void 0!==o.transmissionFactor&&(t.transmission=o.transmissionFactor),void 0!==o.transmissionTexture&&i.push(n.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(i)}}]),e}(),Ve=function(){function e(t){c(this,e),this.parser=t,this.name=Ue.KHR_MATERIALS_VOLUME}return u(e,[{key:"getMaterialType",value:function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?S:null}},{key:"extendMaterialParams",value:function(e,t){var n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var i=[],o=r.extensions[this.name];t.thickness=void 0!==o.thicknessFactor?o.thicknessFactor:0,void 0!==o.thicknessTexture&&i.push(n.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||0;var a=o.attenuationColor||[1,1,1];return t.attenuationColor=new b(a[0],a[1],a[2]),Promise.all(i)}}]),e}(),qe=function(){function e(t){c(this,e),this.parser=t,this.name=Ue.KHR_MATERIALS_IOR}return u(e,[{key:"getMaterialType",value:function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?S:null}},{key:"extendMaterialParams",value:function(e,t){var n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();var r=n.extensions[this.name];return t.ior=void 0!==r.ior?r.ior:1.5,Promise.resolve()}}]),e}(),Xe=function(){function e(t){c(this,e),this.parser=t,this.name=Ue.KHR_MATERIALS_SPECULAR}return u(e,[{key:"getMaterialType",value:function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?S:null}},{key:"extendMaterialParams",value:function(e,t){var n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var i=[],o=r.extensions[this.name];t.specularIntensity=void 0!==o.specularFactor?o.specularFactor:1,void 0!==o.specularTexture&&i.push(n.assignTexture(t,"specularIntensityMap",o.specularTexture));var a=o.specularColorFactor||[1,1,1];return t.specularColor=new b(a[0],a[1],a[2]),void 0!==o.specularColorTexture&&i.push(n.assignTexture(t,"specularColorMap",o.specularColorTexture).then((function(e){e.encoding=E}))),Promise.all(i)}}]),e}(),We=function(){function e(t){c(this,e),this.parser=t,this.name=Ue.KHR_TEXTURE_BASISU}return u(e,[{key:"loadTexture",value:function(e){var t=this.parser,n=t.json,r=n.textures[e];if(!r.extensions||!r.extensions[this.name])return null;var i=r.extensions[this.name],o=n.images[i.source],a=t.options.ktx2Loader;if(!a){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,o,a)}}]),e}(),Ye=function(){function e(t){c(this,e),this.parser=t,this.name=Ue.EXT_TEXTURE_WEBP,this.isSupported=null}return u(e,[{key:"loadTexture",value:function(e){var t=this.name,n=this.parser,r=n.json,i=r.textures[e];if(!i.extensions||!i.extensions[t])return null;var o=i.extensions[t],a=r.images[o.source],s=n.textureLoader;if(a.uri){var c=n.options.manager.getHandler(a.uri);null!==c&&(s=c)}return this.detectSupport().then((function(i){if(i)return n.loadTextureImage(e,a,s);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)}))}},{key:"detectSupport",value:function(){return this.isSupported||(this.isSupported=new Promise((function(e){var t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}]),e}(),Qe=function(){function e(t){c(this,e),this.name=Ue.EXT_MESHOPT_COMPRESSION,this.parser=t}return u(e,[{key:"loadBufferView",value:function(e){var t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){var r=n.extensions[this.name],i=this.parser.getDependency("buffer",r.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([i,o.ready]).then((function(e){var t=r.byteOffset||0,n=r.byteLength||0,i=r.count,a=r.byteStride,s=new ArrayBuffer(i*a),c=new Uint8Array(e[0],t,n);return o.decodeGltfBuffer(new Uint8Array(s),i,a,c,r.mode,r.filter),s}))}return null}}]),e}(),Je="glTF",Ze=1313821514,$e=5130562,et=u((function e(t){c(this,e),this.name=Ue.KHR_BINARY_GLTF,this.content=null,this.body=null;var n=new DataView(t,0,12);if(this.header={magic:x.decodeText(new Uint8Array(t.slice(0,4))),version:n.getUint32(4,!0),length:n.getUint32(8,!0)},this.header.magic!==Je)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var r=this.header.length-12,i=new DataView(t,12),o=0;o<r;){var a=i.getUint32(o,!0);o+=4;var s=i.getUint32(o,!0);if(o+=4,s===Ze){var l=new Uint8Array(t,12+o,a);this.content=x.decodeText(l)}else if(s===$e){var u=12+o;this.body=t.slice(u,u+a)}o+=a}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")})),tt=function(){function e(t,n){if(c(this,e),!n)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Ue.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=n,this.dracoLoader.preload()}return u(e,[{key:"decodePrimitive",value:function(e,t){var n=this.json,r=this.dracoLoader,i=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},s={},c={};for(var l in o){var u=wt[l]||l.toLowerCase();a[u]=o[l]}for(var d in e.attributes){var v=wt[d]||d.toLowerCase();if(void 0!==o[d]){var f=n.accessors[e.attributes[d]],p=mt[f.componentType];c[v]=p,s[v]=!0===f.normalized}}return t.getDependency("bufferView",i).then((function(e){return new Promise((function(t){r.decodeDracoFile(e,(function(e){for(var n in e.attributes){var r=e.attributes[n],i=s[n];void 0!==i&&(r.normalized=i)}t(e)}),a,c)}))}))}}]),e}(),nt=function(){function e(){c(this,e),this.name=Ue.KHR_TEXTURE_TRANSFORM}return u(e,[{key:"extendTexture",value:function(e,t){return void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}]),e}(),rt=function(e){d(n,e);var t=f(n);function n(e){var r;c(this,n),(r=t.call(this)).isGLTFSpecularGlossinessMaterial=!0;var i=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),o=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),a=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),s=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),l=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),u={specular:{value:(new b).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};return r._extraUniforms=u,r.onBeforeCompile=function(e){for(var t in u)e.uniforms[t]=u[t];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",i).replace("#include <metalnessmap_pars_fragment>",o).replace("#include <roughnessmap_fragment>",a).replace("#include <metalnessmap_fragment>",s).replace("#include <lights_physical_fragment>",l)},Object.defineProperties(h(r),{specular:{get:function(){return u.specular.value},set:function(e){u.specular.value=e}},specularMap:{get:function(){return u.specularMap.value},set:function(e){u.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return u.glossiness.value},set:function(e){u.glossiness.value=e}},glossinessMap:{get:function(){return u.glossinessMap.value},set:function(e){u.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete r.metalness,delete r.roughness,delete r.metalnessMap,delete r.roughnessMap,r.setValues(e),r}return u(n,[{key:"copy",value:function(e){return a(m(n.prototype),"copy",this).call(this,e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}]),n}(A),it=function(){function e(){c(this,e),this.name=Ue.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}return u(e,[{key:"getMaterialType",value:function(){return rt}},{key:"extendParams",value:function(e,t,n){var r=t.extensions[this.name];e.color=new b(1,1,1),e.opacity=1;var i=[];if(Array.isArray(r.diffuseFactor)){var o=r.diffuseFactor;e.color.fromArray(o),e.opacity=o[3]}if(void 0!==r.diffuseTexture&&i.push(n.assignTexture(e,"map",r.diffuseTexture)),e.emissive=new b(0,0,0),e.glossiness=void 0!==r.glossinessFactor?r.glossinessFactor:1,e.specular=new b(1,1,1),Array.isArray(r.specularFactor)&&e.specular.fromArray(r.specularFactor),void 0!==r.specularGlossinessTexture){var a=r.specularGlossinessTexture;i.push(n.assignTexture(e,"glossinessMap",a)),i.push(n.assignTexture(e,"specularMap",a))}return Promise.all(i)}},{key:"createMaterial",value:function(e){var t=new rt(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=z,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}]),e}(),ot=u((function e(){c(this,e),this.name=Ue.KHR_MESH_QUANTIZATION})),at=function(e){d(n,e);var t=f(n);function n(e,r,i,o){return c(this,n),t.call(this,e,r,i,o)}return u(n,[{key:"copySampleValue_",value:function(e){for(var t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r*3+r,o=0;o!==r;o++)t[o]=n[i+o];return t}}]),n}(L);at.prototype.beforeStart_=at.prototype.copySampleValue_,at.prototype.afterEnd_=at.prototype.copySampleValue_,at.prototype.interpolate_=function(e,t,n,r){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=2*a,c=3*a,l=r-t,u=(n-t)/l,d=u*u,v=d*u,f=e*c,p=f-c,h=-2*v+3*d,m=v-d,g=1-h,y=m-d+u,x=0;x!==a;x++){var w=o[p+x+a],b=o[p+x+s]*l,T=o[f+x+a],_=o[f+x]*l;i[x]=g*w+y*b+h*T+m*_}return i};var st=new k,ct=function(e){d(n,e);var t=f(n);function n(){return c(this,n),t.apply(this,arguments)}return u(n,[{key:"interpolate_",value:function(e,t,r,i){var o=a(m(n.prototype),"interpolate_",this).call(this,e,t,r,i);return st.fromArray(o).normalize().toArray(o),o}}]),n}(at),lt=0,ut=1,dt=2,vt=3,ft=4,pt=5,ht=6,mt={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},gt={9728:C,9729:I,9984:O,9985:N,9986:F,9987:H},yt={33071:U,33648:D,10497:j},xt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},wt={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},bt={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Tt={CUBICSPLINE:void 0,LINEAR:G,STEP:K},_t="OPAQUE",Pt="MASK",Rt="BLEND";function St(e,t,n){for(var r in n.extensions)void 0===e[r]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=n.extensions[r])}function Mt(e,t){void 0!==t.extras&&("object"===o(t.extras)?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function Et(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var n=0,r=t.weights.length;n<r;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){var i=t.extras.targetNames;if(e.morphTargetInfluences.length===i.length){e.morphTargetDictionary={};for(var o=0,a=i.length;o<a;o++)e.morphTargetDictionary[i[o]]=o}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function At(e){for(var t="",n=Object.keys(e).sort(),r=0,i=n.length;r<i;r++)t+=n[r]+":"+e[n[r]]+";";return t}function zt(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}var Lt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};c(this,e),this.json=t,this.extensions={},this.plugins={},this.options=n,this.cache=new He,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},"undefined"!=typeof createImageBitmap&&!1===/Firefox|Safari/.test(navigator.userAgent)?this.textureLoader=new B(this.options.manager):this.textureLoader=new V(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new w(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}return u(e,[{key:"setExtensions",value:function(e){this.extensions=e}},{key:"setPlugins",value:function(e){this.plugins=e}},{key:"parse",value:function(e,t){var n=this,r=this.json,i=this.extensions;this.cache.removeAll(),this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])})).then((function(t){var o={scene:t[0][r.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:r.asset,parser:n,userData:{}};St(i,o,r),Mt(o,r),Promise.all(n._invokeAll((function(e){return e.afterRoot&&e.afterRoot(o)}))).then((function(){e(o)}))})).catch(t)}},{key:"_markDefs",value:function(){for(var e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[],r=0,i=t.length;r<i;r++)for(var o=t[r].joints,a=0,s=o.length;a<s;a++)e[o[a]].isBone=!0;for(var c=0,l=e.length;c<l;c++){var u=e[c];void 0!==u.mesh&&(this._addNodeRef(this.meshCache,u.mesh),void 0!==u.skin&&(n[u.mesh].isSkinnedMesh=!0)),void 0!==u.camera&&this._addNodeRef(this.cameraCache,u.camera)}}},{key:"_addNodeRef",value:function(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}},{key:"_getNodeRef",value:function(e,r,i){var o=this;if(e.refs[r]<=1)return i;var a=i.clone();return function e(r,i){var a=o.associations.get(r);null!=a&&o.associations.set(i,a);var s,c=n(r.children.entries());try{for(c.s();!(s=c.n()).done;){var l=t(s.value,2),u=l[0];e(l[1],i.children[u])}}catch(d){c.e(d)}finally{c.f()}}(i,a),a.name+="_instance_"+e.uses[r]++,a}},{key:"_invokeOne",value:function(e){var t=Object.values(this.plugins);t.push(this);for(var n=0;n<t.length;n++){var r=e(t[n]);if(r)return r}return null}},{key:"_invokeAll",value:function(e){var t=Object.values(this.plugins);t.unshift(this);for(var n=[],r=0;r<t.length;r++){var i=e(t[r]);i&&n.push(i)}return n}},{key:"getDependency",value:function(e,t){var n=e+":"+t,r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this.loadNode(t);break;case"mesh":r=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":r=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":r=this.loadSkin(t);break;case"animation":r=this.loadAnimation(t);break;case"camera":r=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,r)}return r}},{key:"getDependencies",value:function(e){var t=this.cache.get(e);if(!t){var n=this,r=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(r.map((function(t,r){return n.getDependency(e,r)}))),this.cache.add(e,t)}return t}},{key:"loadBuffer",value:function(e){var t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[Ue.KHR_BINARY_GLTF].body);var r=this.options;return new Promise((function(e,i){n.load(x.resolveURL(t.uri,r.path),e,void 0,(function(){i(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}},{key:"loadBufferView",value:function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){var n=t.byteLength||0,r=t.byteOffset||0;return e.slice(r,r+n)}))}},{key:"loadAccessor",value:function(e){var t=this,n=this.json,r=this.json.accessors[e];if(void 0===r.bufferView&&void 0===r.sparse)return Promise.resolve(null);var i=[];return void 0!==r.bufferView?i.push(this.getDependency("bufferView",r.bufferView)):i.push(null),void 0!==r.sparse&&(i.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(i).then((function(e){var i,o,a=e[0],s=xt[r.type],c=mt[r.componentType],l=c.BYTES_PER_ELEMENT,u=l*s,d=r.byteOffset||0,v=void 0!==r.bufferView?n.bufferViews[r.bufferView].byteStride:void 0,f=!0===r.normalized;if(v&&v!==u){var p=Math.floor(d/v),h="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+p+":"+r.count,m=t.cache.get(h);m||(i=new c(a,p*v,r.count*v/l),m=new q(i,v/l),t.cache.add(h,m)),o=new X(m,s,d%v/l,f)}else i=null===a?new c(r.count*s):new c(a,d,r.count*s),o=new W(i,s,f);if(void 0!==r.sparse){var g=xt.SCALAR,y=mt[r.sparse.indices.componentType],x=r.sparse.indices.byteOffset||0,w=r.sparse.values.byteOffset||0,b=new y(e[1],x,r.sparse.count*g),T=new c(e[2],w,r.sparse.count*s);null!==a&&(o=new W(o.array.slice(),o.itemSize,o.normalized));for(var _=0,P=b.length;_<P;_++){var R=b[_];if(o.setX(R,T[_*s]),s>=2&&o.setY(R,T[_*s+1]),s>=3&&o.setZ(R,T[_*s+2]),s>=4&&o.setW(R,T[_*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return o}))}},{key:"loadTexture",value:function(e){var t=this.json,n=this.options,r=t.textures[e],i=t.images[r.source],o=this.textureLoader;if(i.uri){var a=n.manager.getHandler(i.uri);null!==a&&(o=a)}return this.loadTextureImage(e,i,o)}},{key:"loadTextureImage",value:function(e,t,n){var r=this,i=this.json,o=this.options,a=i.textures[e],s=(t.uri||t.bufferView)+":"+a.sampler;if(this.textureCache[s])return this.textureCache[s];var c=self.URL||self.webkitURL,l=t.uri||"",u=!1;if(void 0!==t.bufferView)l=r.getDependency("bufferView",t.bufferView).then((function(e){u=!0;var n=new Blob([e],{type:t.mimeType});return l=c.createObjectURL(n)}));else if(void 0===t.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");var d=Promise.resolve(l).then((function(e){return new Promise((function(t,r){var i=t;!0===n.isImageBitmapLoader&&(i=function(e){var n=new _e(e);n.needsUpdate=!0,t(n)}),n.load(x.resolveURL(e,o.path),i,void 0,r)}))})).then((function(t){!0===u&&c.revokeObjectURL(l),t.flipY=!1,a.name&&(t.name=a.name);var n=(i.samplers||{})[a.sampler]||{};return t.magFilter=gt[n.magFilter]||I,t.minFilter=gt[n.minFilter]||H,t.wrapS=yt[n.wrapS]||j,t.wrapT=yt[n.wrapT]||j,r.associations.set(t,{textures:e}),t})).catch((function(){return console.error("THREE.GLTFLoader: Couldn't load texture",l),null}));return this.textureCache[s]=d,d}},{key:"assignTexture",value:function(e,t,n){var r=this;return this.getDependency("texture",n.index).then((function(i){if(void 0===n.texCoord||0==n.texCoord||"aoMap"===t&&1==n.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+t+" not yet supported."),r.extensions[Ue.KHR_TEXTURE_TRANSFORM]){var o=void 0!==n.extensions?n.extensions[Ue.KHR_TEXTURE_TRANSFORM]:void 0;if(o){var a=r.associations.get(i);i=r.extensions[Ue.KHR_TEXTURE_TRANSFORM].extendTexture(i,o),r.associations.set(i,a)}}return e[t]=i,i}))}},{key:"assignFinalMaterial",value:function(e){var t=e.geometry,n=e.material,r=void 0===t.attributes.tangent,i=void 0!==t.attributes.color,o=void 0===t.attributes.normal;if(e.isPoints){var a="PointsMaterial:"+n.uuid,s=this.cache.get(a);s||(s=new Y,Q.prototype.copy.call(s,n),s.color.copy(n.color),s.map=n.map,s.sizeAttenuation=!1,this.cache.add(a,s)),n=s}else if(e.isLine){var c="LineBasicMaterial:"+n.uuid,l=this.cache.get(c);l||(l=new J,Q.prototype.copy.call(l,n),l.color.copy(n.color),this.cache.add(c,l)),n=l}if(r||i||o){var u="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(u+="specular-glossiness:"),r&&(u+="derivative-tangents:"),i&&(u+="vertex-colors:"),o&&(u+="flat-shading:");var d=this.cache.get(u);d||(d=n.clone(),i&&(d.vertexColors=!0),o&&(d.flatShading=!0),r&&(d.normalScale&&(d.normalScale.y*=-1),d.clearcoatNormalScale&&(d.clearcoatNormalScale.y*=-1)),this.cache.add(u,d),this.associations.set(d,this.associations.get(n))),n=d}n.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),e.material=n}},{key:"getMaterialType",value:function(){return A}},{key:"loadMaterial",value:function(e){var t,n=this,r=this.json,i=this.extensions,o=r.materials[e],a={},s=o.extensions||{},c=[];if(s[Ue.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var l=i[Ue.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=l.getMaterialType(),c.push(l.extendParams(a,o,n))}else if(s[Ue.KHR_MATERIALS_UNLIT]){var u=i[Ue.KHR_MATERIALS_UNLIT];t=u.getMaterialType(),c.push(u.extendParams(a,o,n))}else{var d=o.pbrMetallicRoughness||{};if(a.color=new b(1,1,1),a.opacity=1,Array.isArray(d.baseColorFactor)){var v=d.baseColorFactor;a.color.fromArray(v),a.opacity=v[3]}void 0!==d.baseColorTexture&&c.push(n.assignTexture(a,"map",d.baseColorTexture)),a.metalness=void 0!==d.metallicFactor?d.metallicFactor:1,a.roughness=void 0!==d.roughnessFactor?d.roughnessFactor:1,void 0!==d.metallicRoughnessTexture&&(c.push(n.assignTexture(a,"metalnessMap",d.metallicRoughnessTexture)),c.push(n.assignTexture(a,"roughnessMap",d.metallicRoughnessTexture))),t=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),c.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,a)}))))}!0===o.doubleSided&&(a.side=Z);var f=o.alphaMode||_t;if(f===Rt?(a.transparent=!0,a.depthWrite=!1):(a.format=$,a.transparent=!1,f===Pt&&(a.alphaTest=void 0!==o.alphaCutoff?o.alphaCutoff:.5)),void 0!==o.normalTexture&&t!==R&&(c.push(n.assignTexture(a,"normalMap",o.normalTexture)),a.normalScale=new M(1,1),void 0!==o.normalTexture.scale)){var p=o.normalTexture.scale;a.normalScale.set(p,p)}return void 0!==o.occlusionTexture&&t!==R&&(c.push(n.assignTexture(a,"aoMap",o.occlusionTexture)),void 0!==o.occlusionTexture.strength&&(a.aoMapIntensity=o.occlusionTexture.strength)),void 0!==o.emissiveFactor&&t!==R&&(a.emissive=(new b).fromArray(o.emissiveFactor)),void 0!==o.emissiveTexture&&t!==R&&c.push(n.assignTexture(a,"emissiveMap",o.emissiveTexture)),Promise.all(c).then((function(){var r;return r=t===rt?i[Ue.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(a):new t(a),o.name&&(r.name=o.name),r.map&&(r.map.encoding=E),r.emissiveMap&&(r.emissiveMap.encoding=E),Mt(r,o),n.associations.set(r,{materials:e}),o.extensions&&St(i,r,o),r}))}},{key:"createUniqueName",value:function(e){for(var t=ee.sanitizeNodeName(e||""),n=t,r=1;this.nodeNamesUsed[n];++r)n=t+"_"+r;return this.nodeNamesUsed[n]=!0,n}},{key:"loadGeometries",value:function(e){var t=this,n=this.extensions,r=this.primitiveCache;function i(e){return n[Ue.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(n){return Ct(n,e,t)}))}for(var o,a,s=[],c=0,l=e.length;c<l;c++){var u=e[c],d=(a=void 0,(a=(o=u).extensions&&o.extensions[Ue.KHR_DRACO_MESH_COMPRESSION])?"draco:"+a.bufferView+":"+a.indices+":"+At(a.attributes):o.indices+":"+At(o.attributes)+":"+o.mode),v=r[d];if(v)s.push(v.promise);else{var f=void 0;f=u.extensions&&u.extensions[Ue.KHR_DRACO_MESH_COMPRESSION]?i(u):Ct(new te,u,t),r[d]={primitive:u,promise:f},s.push(f)}}return Promise.all(s)}},{key:"loadMesh",value:function(e){for(var t,n=this,r=this.json,i=this.extensions,o=r.meshes[e],a=o.primitives,s=[],c=0,l=a.length;c<l;c++){var u=void 0===a[c].material?(void 0===(t=this.cache).DefaultMaterial&&(t.DefaultMaterial=new A({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Te})),t.DefaultMaterial):this.getDependency("material",a[c].material);s.push(u)}return s.push(n.loadGeometries(a)),Promise.all(s).then((function(t){for(var r=t.slice(0,t.length-1),s=t[t.length-1],c=[],l=0,u=s.length;l<u;l++){var d=s[l],v=a[l],f=void 0,p=r[l];if(v.mode===ft||v.mode===pt||v.mode===ht||void 0===v.mode)!0!==(f=!0===o.isSkinnedMesh?new ne(d,p):new re(d,p)).isSkinnedMesh||f.geometry.attributes.skinWeight.normalized||f.normalizeSkinWeights(),v.mode===pt?f.geometry=It(f.geometry,ie):v.mode===ht&&(f.geometry=It(f.geometry,oe));else if(v.mode===ut)f=new ae(d,p);else if(v.mode===vt)f=new se(d,p);else if(v.mode===dt)f=new ce(d,p);else{if(v.mode!==lt)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+v.mode);f=new le(d,p)}Object.keys(f.geometry.morphAttributes).length>0&&Et(f,o),f.name=n.createUniqueName(o.name||"mesh_"+e),Mt(f,o),v.extensions&&St(i,f,v),n.assignFinalMaterial(f),c.push(f)}for(var h=0,m=c.length;h<m;h++)n.associations.set(c[h],{meshes:e,primitives:h});if(1===c.length)return c[0];var g=new ue;n.associations.set(g,{meshes:e});for(var y=0,x=c.length;y<x;y++)g.add(c[y]);return g}))}},{key:"loadCamera",value:function(e){var t,n=this.json.cameras[e],r=n[n.type];if(r)return"perspective"===n.type?t=new de(ve.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===n.type&&(t=new fe(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),Mt(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}},{key:"loadSkin",value:function(e){var t=this.json.skins[e],n={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return n.inverseBindMatrices=e,n}))}},{key:"loadAnimation",value:function(e){for(var t=this.json.animations[e],n=[],r=[],i=[],o=[],a=[],s=0,c=t.channels.length;s<c;s++){var l=t.channels[s],u=t.samplers[l.sampler],d=l.target,v=void 0!==d.node?d.node:d.id,f=void 0!==t.parameters?t.parameters[u.input]:u.input,p=void 0!==t.parameters?t.parameters[u.output]:u.output;n.push(this.getDependency("node",v)),r.push(this.getDependency("accessor",f)),i.push(this.getDependency("accessor",p)),o.push(u),a.push(d)}return Promise.all([Promise.all(n),Promise.all(r),Promise.all(i),Promise.all(o),Promise.all(a)]).then((function(n){for(var r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],c=[],l=function(e,t){var n=r[e],l=i[e],u=o[e],d=a[e],v=s[e];if(void 0===n)return"continue";n.updateMatrix(),n.matrixAutoUpdate=!0;var f=void 0;switch(bt[v.path]){case bt.weights:f=me;break;case bt.rotation:f=he;break;default:f=pe}var p=n.name?n.name:n.uuid,h=void 0!==d.interpolation?Tt[d.interpolation]:G,m=[];bt[v.path]===bt.weights?n.traverse((function(e){e.morphTargetInfluences&&m.push(e.name?e.name:e.uuid)})):m.push(p);var g=u.array;if(u.normalized){for(var y=zt(g.constructor),x=new Float32Array(g.length),w=0,b=g.length;w<b;w++)x[w]=g[w]*y;g=x}for(var T=0,_=m.length;T<_;T++){var P=new f(m[T]+"."+bt[v.path],l.array,g,h);"CUBICSPLINE"===d.interpolation&&(P.createInterpolant=function(e){return new(this instanceof he?ct:at)(this.times,this.values,this.getValueSize()/3,e)},P.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),c.push(P)}},u=0,d=r.length;u<d;u++)l(u);var v=t.name?t.name:"animation_"+e;return new ge(v,void 0,c)}))}},{key:"createNodeMesh",value:function(e){var t=this.json,n=this,r=t.nodes[e];return void 0===r.mesh?null:n.getDependency("mesh",r.mesh).then((function(e){var t=n._getNodeRef(n.meshCache,r.mesh,e);return void 0!==r.weights&&t.traverse((function(e){if(e.isMesh)for(var t=0,n=r.weights.length;t<n;t++)e.morphTargetInfluences[t]=r.weights[t]})),t}))}},{key:"loadNode",value:function(e){var t,n,r=this.json,i=this.extensions,o=this,a=r.nodes[e],s=a.name?o.createUniqueName(a.name):"";return(t=[],n=o._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)})),n&&t.push(n),void 0!==a.camera&&t.push(o.getDependency("camera",a.camera).then((function(e){return o._getNodeRef(o.cameraCache,a.camera,e)}))),o._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){t.push(e)})),Promise.all(t)).then((function(t){var n;if((n=!0===a.isBone?new ye:t.length>1?new ue:1===t.length?t[0]:new xe)!==t[0])for(var r=0,c=t.length;r<c;r++)n.add(t[r]);if(a.name&&(n.userData.name=a.name,n.name=s),Mt(n,a),a.extensions&&St(i,n,a),void 0!==a.matrix){var l=new we;l.fromArray(a.matrix),n.applyMatrix4(l)}else void 0!==a.translation&&n.position.fromArray(a.translation),void 0!==a.rotation&&n.quaternion.fromArray(a.rotation),void 0!==a.scale&&n.scale.fromArray(a.scale);return o.associations.has(n)||o.associations.set(n,{}),o.associations.get(n).nodes=e,n}))}},{key:"loadScene",value:function(e){var r=this.json,i=this.extensions,o=this.json.scenes[e],a=this,s=new ue;o.name&&(s.name=a.createUniqueName(o.name)),Mt(s,o),o.extensions&&St(i,s,o);for(var c=o.nodes||[],l=[],u=0,d=c.length;u<d;u++)l.push(kt(c[u],s,r,a));return Promise.all(l).then((function(){return a.associations=function(e){var r,i=new Map,o=n(a.associations);try{for(o.s();!(r=o.n()).done;){var s=t(r.value,2),c=s[0],l=s[1];(c instanceof Q||c instanceof _e)&&i.set(c,l)}}catch(u){o.e(u)}finally{o.f()}return e.traverse((function(e){var t=a.associations.get(e);null!=t&&i.set(e,t)})),i}(s),s}))}}]),e}();function kt(e,t,n,r){var i=n.nodes[e];return r.getDependency("node",e).then((function(e){return void 0===i.skin?e:r.getDependency("skin",i.skin).then((function(e){for(var n=[],i=0,o=(t=e).joints.length;i<o;i++)n.push(r.getDependency("node",t.joints[i]));return Promise.all(n)})).then((function(n){return e.traverse((function(e){if(e.isMesh){for(var r=[],i=[],o=0,a=n.length;o<a;o++){var s=n[o];if(s){r.push(s);var c=new we;void 0!==t.inverseBindMatrices&&c.fromArray(t.inverseBindMatrices.array,16*o),i.push(c)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[o])}e.bind(new be(r,i),e.matrixWorld)}})),e}));var t})).then((function(e){t.add(e);var o=[];if(i.children)for(var a=i.children,s=0,c=a.length;s<c;s++){var l=a[s];o.push(kt(l,e,n,r))}return Promise.all(o)}))}function Ct(e,t,n){var r=t.attributes,i=[];function o(t,r){return n.getDependency("accessor",t).then((function(t){e.setAttribute(r,t)}))}for(var a in r){var s=wt[a]||a.toLowerCase();s in e.attributes||i.push(o(r[a],s))}if(void 0!==t.indices&&!e.index){var c=n.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));i.push(c)}return Mt(e,t),function(e,t,n){var r=t.attributes,i=new Pe;if(void 0!==r.POSITION){var o=n.json.accessors[r.POSITION],a=o.min,s=o.max;if(void 0!==a&&void 0!==s){if(i.set(new Re(a[0],a[1],a[2]),new Re(s[0],s[1],s[2])),o.normalized){var c=zt(mt[o.componentType]);i.min.multiplyScalar(c),i.max.multiplyScalar(c)}var l=t.targets;if(void 0!==l){for(var u=new Re,d=new Re,v=0,f=l.length;v<f;v++){var p=l[v];if(void 0!==p.POSITION){var h=n.json.accessors[p.POSITION],m=h.min,g=h.max;if(void 0!==m&&void 0!==g){if(d.setX(Math.max(Math.abs(m[0]),Math.abs(g[0]))),d.setY(Math.max(Math.abs(m[1]),Math.abs(g[1]))),d.setZ(Math.max(Math.abs(m[2]),Math.abs(g[2]))),h.normalized){var y=zt(mt[h.componentType]);d.multiplyScalar(y)}u.max(d)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(u)}e.boundingBox=i;var x=new Se;i.getCenter(x.center),x.radius=i.min.distanceTo(i.max)/2,e.boundingSphere=x}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(e,t,n),Promise.all(i).then((function(){return void 0!==t.targets?function(e,t,n){for(var r=!1,i=!1,o=0,a=t.length;o<a;o++){var s=t[o];if(void 0!==s.POSITION&&(r=!0),void 0!==s.NORMAL&&(i=!0),r&&i)break}if(!r&&!i)return Promise.resolve(e);for(var c=[],l=[],u=0,d=t.length;u<d;u++){var v=t[u];if(r){var f=void 0!==v.POSITION?n.getDependency("accessor",v.POSITION):e.attributes.position;c.push(f)}if(i){var p=void 0!==v.NORMAL?n.getDependency("accessor",v.NORMAL):e.attributes.normal;l.push(p)}}return Promise.all([Promise.all(c),Promise.all(l)]).then((function(t){var n=t[0],o=t[1];return r&&(e.morphAttributes.position=n),i&&(e.morphAttributes.normal=o),e.morphTargetsRelative=!0,e}))}(e,t.targets,n):e}))}function It(e,t){var n=e.getIndex();if(null===n){var r=[],i=e.getAttribute("position");if(void 0===i)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var o=0;o<i.count;o++)r.push(o);e.setIndex(r),n=e.getIndex()}var a=n.count-2,s=[];if(t===oe)for(var c=1;c<=a;c++)s.push(n.getX(0)),s.push(n.getX(c)),s.push(n.getX(c+1));else for(var l=0;l<a;l++)l%2==0?(s.push(n.getX(l)),s.push(n.getX(l+1)),s.push(n.getX(l+2))):(s.push(n.getX(l+2)),s.push(n.getX(l+1)),s.push(n.getX(l)));s.length/3!==a&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var u=e.clone();return u.setIndex(s),u}var Ot,Nt="\n    #include <noise>\n\n    uniform float u_time;\n\n    varying float noise;\n\n    void main() {\t\n      float time = u_time;\n      float displacement;\n      float b;\n      \n      // add time to the noise parameters so it's animated\n      noise = 10.0 *  -.10 * turbulence( .5 * normal + time );\n      b = 5.0 * pnoise( 0.05 * position + vec3( 2.0 * time ), vec3( 100.0 ) );\n      displacement = - 10. * noise + b;\n\n      // move the position along the normal and transform it\n      vec3 newPosition = position + normal * displacement;\n      gl_Position = projectionMatrix * modelViewMatrix * vec4( newPosition, 1.0 );\n    }\n  ",Ft="\n    #define PI 3.141592653589\n    #define PI2 6.28318530718\n\n    uniform vec2 u_mouse;\n    uniform vec2 u_resolution;\n    uniform float u_time;\n    uniform float u_opacity;\n    uniform sampler2D u_tex;\n\n    varying float noise;\n\n    //\t<https://www.shadertoy.com/view/4dS3Wd>\n    //\tBy Morgan McGuire @morgan3d, http://graphicscodex.com\n\n    //https://www.clicktorelease.com/blog/vertex-displacement-noise-3d-webgl-glsl-three-js/\n\n    float random( vec3 scale, float seed ){\n      return fract( sin( dot( gl_FragCoord.xyz + seed, scale ) ) * 43758.5453 + seed ) ;\n    }\n\n    void main() {\n\n      // get a random offset\n      float r = .01 * random( vec3( 12.9898, 78.233, 151.7182 ), 0.0 );\n      // lookup vertically in the texture, using noise and offset\n      // to get the right RGB colour\n      vec2 t_pos = vec2( 0, 1.3 * noise + r );\n      vec4 color = texture2D( u_tex, t_pos );\n\n      gl_FragColor = vec4( color.rgb, u_opacity );\n    }\n  ",Ht=function(){function t(n){var r=this;c(this,t),e(this,"viewer",void 0),e(this,"gltfLoader",void 0),e(this,"textLoader",void 0),e(this,"plane",void 0),e(this,"bomb",void 0),e(this,"star",void 0),e(this,"obstacles",void 0),e(this,"obstacle",void 0),e(this,"clock1",void 0),e(this,"clock2",void 0),e(this,"spaceing",!1),e(this,"playing",!1),e(this,"event",{}),e(this,"pos",void 0),e(this,"ball",void 0),e(this,"ballUniforms",void 0),e(this,"starNum",0),e(this,"lifeNum",5),e(this,"keydown",(function(e){if(32===e.keyCode)r.spaceing=!0})),e(this,"keyup",(function(e){if(32===e.keyCode)r.spaceing=!1})),e(this,"mousedown",(function(e){})),e(this,"mouseup",(function(e){})),this.event={keydown:v.throttle(this.keydown,60),keyup:v.throttle(this.keyup,60),mousedown:v.throttle(this.mousedown,60),mouseup:v.throttle(this.mouseup,60)},this.viewer=n,this.clock1=new Me,this.clock2=new Me,this.gltfLoader=new Fe(this.viewer.loadmanager),this.textLoader=new V(this.viewer.loadmanager),this.textLoader.setCrossOrigin(""),this.loadSky(),this.loadPlane(),this.loadObstacle(),this.listen(),this.initBall(),this.initMusic(),this.pos=new Re,this.viewer.on("complete",(function(){r.obstacles=new ue;for(var e=0;e<10;e++){var t=r.obstacle.clone();t.position.z+=150*e,t.position.y+=40*Math.sin(e),r.obstacles.add(t),r.render()}r.viewer.scene.add(r.obstacles)}))}return u(t,[{key:"render",value:function(){this.viewer.render()}},{key:"loadSky",value:function(){var e=this;return(new Ee).setPath("skybox/漫天彩云/").load(["lf.jpg","rt.jpg","up.jpg","dn.jpg","fr.jpg","bk.jpg"],(function(t){e.viewer.scene.background=t,e.render()}))}},{key:"initBall",value:function(){var e=new Ae(20,14);ze.noise='\n\t//\n\t// Description : Array and textureless GLSL 2D/3D/4D simplex\n\t//               noise functions.\n\t//      Author : Ian McEwan, Ashima Arts.\n\t//  Maintainer : stegu\n\t//     Lastmod : 20110822 (ijm)\n\t//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n\t//               Distributed under the MIT License. See LICENSE file.\n\t//               https://github.com/ashima/webgl-noise\n\t//               https://github.com/stegu/webgl-noise\n\t//\n\n\tvec3 mod289(vec3 x) {\n\t  return x - floor(x * (1.0 / 289.0)) * 289.0;\n\t}\n\n\tvec4 mod289(vec4 x) {\n\t  return x - floor(x * (1.0 / 289.0)) * 289.0;\n\t}\n\n\tvec4 permute(vec4 x) {\n\t\t return mod289(((x*34.0)+1.0)*x);\n\t}\n\n\t// Permutation polynomial (ring size 289 = 17*17)\n\tvec3 permute(vec3 x) {\n\t  return mod289(((x*34.0)+1.0)*x);\n\t}\n\n\tfloat permute(float x){\n\t\treturn x - floor(x * (1.0 / 289.0)) * 289.0;;\n\t}\n\n\tvec4 taylorInvSqrt(vec4 r){\n\t  return 1.79284291400159 - 0.85373472095314 * r;\n\t}\n\n\tvec2 fade(vec2 t) {\n\t  return t*t*t*(t*(t*6.0-15.0)+10.0);\n\t}\n\n\tvec3 fade(vec3 t) {\n\t  return t*t*t*(t*(t*6.0-15.0)+10.0);\n\t}\n\n\t// Hashed 2-D gradients with an extra rotation.\n\t// (The constant 0.0243902439 is 1/41)\n\tvec2 rgrad2(vec2 p, float rot) {\n\t#if 0\n\t// Map from a line to a diamond such that a shift maps to a rotation.\n\t  float u = permute(permute(p.x) + p.y) * 0.0243902439 + rot; // Rotate by shift\n\t  u = 4.0 * fract(u) - 2.0;\n\t  // (This vector could be normalized, exactly or approximately.)\n\t  return vec2(abs(u)-1.0, abs(abs(u+1.0)-2.0)-1.0);\n\t#else\n\t// For more isotropic gradients, sin/cos can be used instead.\n\t  float u = permute(permute(p.x) + p.y) * 0.0243902439 + rot; // Rotate by shift\n\t  u = fract(u) * 6.28318530718; // 2*pi\n\t  return vec2(cos(u), sin(u));\n\t#endif\n\t}\n\n\tfloat snoise(vec3 v){\n\t  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n\t  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n\n\t// First corner\n\t  vec3 i  = floor(v + dot(v, C.yyy) );\n\t  vec3 x0 =   v - i + dot(i, C.xxx) ;\n\n\t// Other corners\n\t  vec3 g = step(x0.yzx, x0.xyz);\n\t  vec3 l = 1.0 - g;\n\t  vec3 i1 = min( g.xyz, l.zxy );\n\t  vec3 i2 = max( g.xyz, l.zxy );\n\n\t  //   x0 = x0 - 0.0 + 0.0 * C.xxx;\n\t  //   x1 = x0 - i1  + 1.0 * C.xxx;\n\t  //   x2 = x0 - i2  + 2.0 * C.xxx;\n\t  //   x3 = x0 - 1.0 + 3.0 * C.xxx;\n\t  vec3 x1 = x0 - i1 + C.xxx;\n\t  vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n\t  vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\n\n\t// Permutations\n\t  i = mod289(i);\n\t  vec4 p = permute( permute( permute(\n\t\t\t\t i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n\t\t\t   + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n\t\t\t   + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\n\t// Gradients: 7x7 points over a square, mapped onto an octahedron.\n\t// The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n\t  float n_ = 0.142857142857; // 1.0/7.0\n\t  vec3  ns = n_ * D.wyz - D.xzx;\n\n\t  vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\n\n\t  vec4 x_ = floor(j * ns.z);\n\t  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\n\t  vec4 x = x_ *ns.x + ns.yyyy;\n\t  vec4 y = y_ *ns.x + ns.yyyy;\n\t  vec4 h = 1.0 - abs(x) - abs(y);\n\n\t  vec4 b0 = vec4( x.xy, y.xy );\n\t  vec4 b1 = vec4( x.zw, y.zw );\n\n\t  //vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;\n\t  //vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;\n\t  vec4 s0 = floor(b0)*2.0 + 1.0;\n\t  vec4 s1 = floor(b1)*2.0 + 1.0;\n\t  vec4 sh = -step(h, vec4(0.0));\n\n\t  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n\t  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\n\t  vec3 p0 = vec3(a0.xy,h.x);\n\t  vec3 p1 = vec3(a0.zw,h.y);\n\t  vec3 p2 = vec3(a1.xy,h.z);\n\t  vec3 p3 = vec3(a1.zw,h.w);\n\n\t//Normalise gradients\n\t  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n\t  p0 *= norm.x;\n\t  p1 *= norm.y;\n\t  p2 *= norm.z;\n\t  p3 *= norm.w;\n\n\t// Mix final noise value\n\t  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n\t  m = m * m;\n\t  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),\n\t\t\t\t\t\t\t\t\tdot(p2,x2), dot(p3,x3) ) );\n\t  }\n\n\t// Classic Perlin noise\n\tfloat cnoise(vec2 P){\n\t  vec4 Pi = floor(P.xyxy) + vec4(0.0, 0.0, 1.0, 1.0);\n\t  vec4 Pf = fract(P.xyxy) - vec4(0.0, 0.0, 1.0, 1.0);\n\t  Pi = mod289(Pi); // To avoid truncation effects in permutation\n\t  vec4 ix = Pi.xzxz;\n\t  vec4 iy = Pi.yyww;\n\t  vec4 fx = Pf.xzxz;\n\t  vec4 fy = Pf.yyww;\n\n\t  vec4 i = permute(permute(ix) + iy);\n\n\t  vec4 gx = fract(i * (1.0 / 41.0)) * 2.0 - 1.0 ;\n\t  vec4 gy = abs(gx) - 0.5 ;\n\t  vec4 tx = floor(gx + 0.5);\n\t  gx = gx - tx;\n\n\t  vec2 g00 = vec2(gx.x,gy.x);\n\t  vec2 g10 = vec2(gx.y,gy.y);\n\t  vec2 g01 = vec2(gx.z,gy.z);\n\t  vec2 g11 = vec2(gx.w,gy.w);\n\n\t  vec4 norm = taylorInvSqrt(vec4(dot(g00, g00), dot(g01, g01), dot(g10, g10), dot(g11, g11)));\n\t  g00 *= norm.x;\n\t  g01 *= norm.y;\n\t  g10 *= norm.z;\n\t  g11 *= norm.w;\n\n\t  float n00 = dot(g00, vec2(fx.x, fy.x));\n\t  float n10 = dot(g10, vec2(fx.y, fy.y));\n\t  float n01 = dot(g01, vec2(fx.z, fy.z));\n\t  float n11 = dot(g11, vec2(fx.w, fy.w));\n\n\t  vec2 fade_xy = fade(Pf.xy);\n\t  vec2 n_x = mix(vec2(n00, n01), vec2(n10, n11), fade_xy.x);\n\t  float n_xy = mix(n_x.x, n_x.y, fade_xy.y);\n\t  return 2.3 * n_xy;\n\t}\n\n\t// Classic Perlin noise, periodic variant\n\tfloat pnoise(vec2 P, vec2 rep){\n\t  vec4 Pi = floor(P.xyxy) + vec4(0.0, 0.0, 1.0, 1.0);\n\t  vec4 Pf = fract(P.xyxy) - vec4(0.0, 0.0, 1.0, 1.0);\n\t  Pi = mod(Pi, rep.xyxy); // To create noise with explicit period\n\t  Pi = mod289(Pi);        // To avoid truncation effects in permutation\n\t  vec4 ix = Pi.xzxz;\n\t  vec4 iy = Pi.yyww;\n\t  vec4 fx = Pf.xzxz;\n\t  vec4 fy = Pf.yyww;\n\n\t  vec4 i = permute(permute(ix) + iy);\n\n\t  vec4 gx = fract(i * (1.0 / 41.0)) * 2.0 - 1.0 ;\n\t  vec4 gy = abs(gx) - 0.5 ;\n\t  vec4 tx = floor(gx + 0.5);\n\t  gx = gx - tx;\n\n\t  vec2 g00 = vec2(gx.x,gy.x);\n\t  vec2 g10 = vec2(gx.y,gy.y);\n\t  vec2 g01 = vec2(gx.z,gy.z);\n\t  vec2 g11 = vec2(gx.w,gy.w);\n\n\t  vec4 norm = taylorInvSqrt(vec4(dot(g00, g00), dot(g01, g01), dot(g10, g10), dot(g11, g11)));\n\t  g00 *= norm.x;\n\t  g01 *= norm.y;\n\t  g10 *= norm.z;\n\t  g11 *= norm.w;\n\n\t  float n00 = dot(g00, vec2(fx.x, fy.x));\n\t  float n10 = dot(g10, vec2(fx.y, fy.y));\n\t  float n01 = dot(g01, vec2(fx.z, fy.z));\n\t  float n11 = dot(g11, vec2(fx.w, fy.w));\n\n\t  vec2 fade_xy = fade(Pf.xy);\n\t  vec2 n_x = mix(vec2(n00, n01), vec2(n10, n11), fade_xy.x);\n\t  float n_xy = mix(n_x.x, n_x.y, fade_xy.y);\n\t  return 2.3 * n_xy;\n\t}\n\t// Classic Perlin noise\n\tfloat cnoise(vec3 P)\n\t{\n\t  vec3 Pi0 = floor(P); // Integer part for indexing\n\t  vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1\n\t  Pi0 = mod289(Pi0);\n\t  Pi1 = mod289(Pi1);\n\t  vec3 Pf0 = fract(P); // Fractional part for interpolation\n\t  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\n\t  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n\t  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n\t  vec4 iz0 = Pi0.zzzz;\n\t  vec4 iz1 = Pi1.zzzz;\n\n\t  vec4 ixy = permute(permute(ix) + iy);\n\t  vec4 ixy0 = permute(ixy + iz0);\n\t  vec4 ixy1 = permute(ixy + iz1);\n\n\t  vec4 gx0 = ixy0 * (1.0 / 7.0);\n\t  vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;\n\t  gx0 = fract(gx0);\n\t  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n\t  vec4 sz0 = step(gz0, vec4(0.0));\n\t  gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n\t  gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\n\t  vec4 gx1 = ixy1 * (1.0 / 7.0);\n\t  vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;\n\t  gx1 = fract(gx1);\n\t  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n\t  vec4 sz1 = step(gz1, vec4(0.0));\n\t  gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n\t  gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\n\t  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n\t  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n\t  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n\t  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n\t  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n\t  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n\t  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n\t  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\n\t  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n\t  g000 *= norm0.x;\n\t  g010 *= norm0.y;\n\t  g100 *= norm0.z;\n\t  g110 *= norm0.w;\n\t  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n\t  g001 *= norm1.x;\n\t  g011 *= norm1.y;\n\t  g101 *= norm1.z;\n\t  g111 *= norm1.w;\n\n\t  float n000 = dot(g000, Pf0);\n\t  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n\t  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n\t  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n\t  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n\t  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n\t  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n\t  float n111 = dot(g111, Pf1);\n\n\t  vec3 fade_xyz = fade(Pf0);\n\t  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n\t  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n\t  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);\n\t  return 2.2 * n_xyz;\n\t}\n\n\t// Classic Perlin noise, periodic variant\n\tfloat pnoise(vec3 P, vec3 rep)\n\t{\n\t  vec3 Pi0 = mod(floor(P), rep); // Integer part, modulo period\n\t  vec3 Pi1 = mod(Pi0 + vec3(1.0), rep); // Integer part + 1, mod period\n\t  Pi0 = mod289(Pi0);\n\t  Pi1 = mod289(Pi1);\n\t  vec3 Pf0 = fract(P); // Fractional part for interpolation\n\t  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\n\t  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n\t  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n\t  vec4 iz0 = Pi0.zzzz;\n\t  vec4 iz1 = Pi1.zzzz;\n\n\t  vec4 ixy = permute(permute(ix) + iy);\n\t  vec4 ixy0 = permute(ixy + iz0);\n\t  vec4 ixy1 = permute(ixy + iz1);\n\n\t  vec4 gx0 = ixy0 * (1.0 / 7.0);\n\t  vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;\n\t  gx0 = fract(gx0);\n\t  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n\t  vec4 sz0 = step(gz0, vec4(0.0));\n\t  gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n\t  gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\n\t  vec4 gx1 = ixy1 * (1.0 / 7.0);\n\t  vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;\n\t  gx1 = fract(gx1);\n\t  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n\t  vec4 sz1 = step(gz1, vec4(0.0));\n\t  gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n\t  gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\n\t  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n\t  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n\t  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n\t  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n\t  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n\t  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n\t  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n\t  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\n\t  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n\t  g000 *= norm0.x;\n\t  g010 *= norm0.y;\n\t  g100 *= norm0.z;\n\t  g110 *= norm0.w;\n\t  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n\t  g001 *= norm1.x;\n\t  g011 *= norm1.y;\n\t  g101 *= norm1.z;\n\t  g111 *= norm1.w;\n\n\t  float n000 = dot(g000, Pf0);\n\t  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n\t  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n\t  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n\t  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n\t  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n\t  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n\t  float n111 = dot(g111, Pf1);\n\n\t  vec3 fade_xyz = fade(Pf0);\n\t  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n\t  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n\t  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);\n\t  return 2.2 * n_xyz;\n\t}\n\n\tfloat turbulence( vec3 p ) {\n\t  float w = 100.0;\n\t  float t = -.5;\n\n\t  for (float f = 1.0 ; f <= 10.0 ; f++ ){\n\t\tfloat power = pow( 2.0, f );\n\t\tt += abs( pnoise( vec3( power * p ), vec3( 10.0, 10.0, 10.0 ) ) / power );\n\t  }\n\n\t  return t;\n\t}\n\n\tfloat turbulence3( vec3 p ) {\n\t  float w = 100.0;\n\t  float t = -.5;\n\n\t  for (float f = 1.0 ; f <= 3.0 ; f++ ){\n\t\tfloat power = pow( 2.0, f );\n\t\tt += abs( pnoise( vec3( power * p ), vec3( 3.0, 3.0, 3.0 ) ) / power );\n\t  }\n\n\t  return t;\n\t}\n\n\tfloat turbulence6( vec3 p ) {\n\t  float w = 100.0;\n\t  float t = -.5;\n\n\t  for (float f = 1.0 ; f <= 6.0 ; f++ ){\n\t\tfloat power = pow( 2.0, f );\n\t\tt += abs( pnoise( vec3( power * p ), vec3( 6.0, 6.0, 6.0 ) ) / power );\n\t  }\n\n\t  return t;\n\t}\n\n\t//\n\t// 2-D tiling simplex noise with rotating gradients and analytical derivative.\n\t// The first component of the 3-element return vector is the noise value,\n\t// and the second and third components are the x and y partial derivatives.\n\t//\n\tvec3 psrdnoise(vec2 pos, vec2 per, float rot) {\n\t  // Hack: offset y slightly to hide some rare artifacts\n\t  pos.y += 0.01;\n\t  // Skew to hexagonal grid\n\t  vec2 uv = vec2(pos.x + pos.y*0.5, pos.y);\n\n\t  vec2 i0 = floor(uv);\n\t  vec2 f0 = fract(uv);\n\t  // Traversal order\n\t  vec2 i1 = (f0.x > f0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n\n\t  // Unskewed grid points in (x,y) space\n\t  vec2 p0 = vec2(i0.x - i0.y * 0.5, i0.y);\n\t  vec2 p1 = vec2(p0.x + i1.x - i1.y * 0.5, p0.y + i1.y);\n\t  vec2 p2 = vec2(p0.x + 0.5, p0.y + 1.0);\n\n\t  // Integer grid point indices in (u,v) space\n\t  i1 = i0 + i1;\n\t  vec2 i2 = i0 + vec2(1.0, 1.0);\n\n\t  // Vectors in unskewed (x,y) coordinates from\n\t  // each of the simplex corners to the evaluation point\n\t  vec2 d0 = pos - p0;\n\t  vec2 d1 = pos - p1;\n\t  vec2 d2 = pos - p2;\n\n\t  // Wrap i0, i1 and i2 to the desired period before gradient hashing:\n\t  // wrap points in (x,y), map to (u,v)\n\t  vec3 xw = mod(vec3(p0.x, p1.x, p2.x), per.x);\n\t  vec3 yw = mod(vec3(p0.y, p1.y, p2.y), per.y);\n\t  vec3 iuw = xw + 0.5 * yw;\n\t  vec3 ivw = yw;\n\n\t  // Create gradients from indices\n\t  vec2 g0 = rgrad2(vec2(iuw.x, ivw.x), rot);\n\t  vec2 g1 = rgrad2(vec2(iuw.y, ivw.y), rot);\n\t  vec2 g2 = rgrad2(vec2(iuw.z, ivw.z), rot);\n\n\t  // Gradients dot vectors to corresponding corners\n\t  // (The derivatives of this are simply the gradients)\n\t  vec3 w = vec3(dot(g0, d0), dot(g1, d1), dot(g2, d2));\n\n\t  // Radial weights from corners\n\t  // 0.8 is the square of 2/sqrt(5), the distance from\n\t  // a grid point to the nearest simplex boundary\n\t  vec3 t = 0.8 - vec3(dot(d0, d0), dot(d1, d1), dot(d2, d2));\n\n\t  // Partial derivatives for analytical gradient computation\n\t  vec3 dtdx = -2.0 * vec3(d0.x, d1.x, d2.x);\n\t  vec3 dtdy = -2.0 * vec3(d0.y, d1.y, d2.y);\n\n\t  // Set influence of each surflet to zero outside radius sqrt(0.8)\n\t  if (t.x < 0.0) {\n\t\tdtdx.x = 0.0;\n\t\tdtdy.x = 0.0;\n\t\tt.x = 0.0;\n\t  }\n\t  if (t.y < 0.0) {\n\t\tdtdx.y = 0.0;\n\t\tdtdy.y = 0.0;\n\t\tt.y = 0.0;\n\t  }\n\t  if (t.z < 0.0) {\n\t\tdtdx.z = 0.0;\n\t\tdtdy.z = 0.0;\n\t\tt.z = 0.0;\n\t  }\n\n\t  // Fourth power of t (and third power for derivative)\n\t  vec3 t2 = t * t;\n\t  vec3 t4 = t2 * t2;\n\t  vec3 t3 = t2 * t;\n\n\t  // Final noise value is:\n\t  // sum of ((radial weights) times (gradient dot vector from corner))\n\t  float n = dot(t4, w);\n\n\t  // Final analytical derivative (gradient of a sum of scalar products)\n\t  vec2 dt0 = vec2(dtdx.x, dtdy.x) * 4.0 * t3.x;\n\t  vec2 dn0 = t4.x * g0 + dt0 * w.x;\n\t  vec2 dt1 = vec2(dtdx.y, dtdy.y) * 4.0 * t3.y;\n\t  vec2 dn1 = t4.y * g1 + dt1 * w.y;\n\t  vec2 dt2 = vec2(dtdx.z, dtdy.z) * 4.0 * t3.z;\n\t  vec2 dn2 = t4.z * g2 + dt2 * w.z;\n\n\t  return 11.0*vec3(n, dn0 + dn1 + dn2);\n\t}\n\n\t//\n\t// 2-D tiling simplex noise with fixed gradients\n\t// and analytical derivative.\n\t// This function is implemented as a wrapper to "psrdnoise",\n\t// at the minimal cost of three extra additions.\n\t//\n\tvec3 psdnoise(vec2 pos, vec2 per) {\n\t  return psrdnoise(pos, per, 0.0);\n\t}\n\n\t//\n\t// 2-D tiling simplex noise with rotating gradients,\n\t// but without the analytical derivative.\n\t//\n\tfloat psrnoise(vec2 pos, vec2 per, float rot) {\n\t  // Offset y slightly to hide some rare artifacts\n\t  pos.y += 0.001;\n\t  // Skew to hexagonal grid\n\t  vec2 uv = vec2(pos.x + pos.y*0.5, pos.y);\n\n\t  vec2 i0 = floor(uv);\n\t  vec2 f0 = fract(uv);\n\t  // Traversal order\n\t  vec2 i1 = (f0.x > f0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n\n\t  // Unskewed grid points in (x,y) space\n\t  vec2 p0 = vec2(i0.x - i0.y * 0.5, i0.y);\n\t  vec2 p1 = vec2(p0.x + i1.x - i1.y * 0.5, p0.y + i1.y);\n\t  vec2 p2 = vec2(p0.x + 0.5, p0.y + 1.0);\n\n\t  // Integer grid point indices in (u,v) space\n\t  i1 = i0 + i1;\n\t  vec2 i2 = i0 + vec2(1.0, 1.0);\n\n\t  // Vectors in unskewed (x,y) coordinates from\n\t  // each of the simplex corners to the evaluation point\n\t  vec2 d0 = pos - p0;\n\t  vec2 d1 = pos - p1;\n\t  vec2 d2 = pos - p2;\n\n\t  // Wrap i0, i1 and i2 to the desired period before gradient hashing:\n\t  // wrap points in (x,y), map to (u,v)\n\t  vec3 xw = mod(vec3(p0.x, p1.x, p2.x), per.x);\n\t  vec3 yw = mod(vec3(p0.y, p1.y, p2.y), per.y);\n\t  vec3 iuw = xw + 0.5 * yw;\n\t  vec3 ivw = yw;\n\n\t  // Create gradients from indices\n\t  vec2 g0 = rgrad2(vec2(iuw.x, ivw.x), rot);\n\t  vec2 g1 = rgrad2(vec2(iuw.y, ivw.y), rot);\n\t  vec2 g2 = rgrad2(vec2(iuw.z, ivw.z), rot);\n\n\t  // Gradients dot vectors to corresponding corners\n\t  // (The derivatives of this are simply the gradients)\n\t  vec3 w = vec3(dot(g0, d0), dot(g1, d1), dot(g2, d2));\n\n\t  // Radial weights from corners\n\t  // 0.8 is the square of 2/sqrt(5), the distance from\n\t  // a grid point to the nearest simplex boundary\n\t  vec3 t = 0.8 - vec3(dot(d0, d0), dot(d1, d1), dot(d2, d2));\n\n\t  // Set influence of each surflet to zero outside radius sqrt(0.8)\n\t  t = max(t, 0.0);\n\n\t  // Fourth power of t\n\t  vec3 t2 = t * t;\n\t  vec3 t4 = t2 * t2;\n\n\t  // Final noise value is:\n\t  // sum of ((radial weights) times (gradient dot vector from corner))\n\t  float n = dot(t4, w);\n\n\t  // Rescale to cover the range [-1,1] reasonably well\n\t  return 11.0*n;\n\t}\n\n\t//\n\t// 2-D tiling simplex noise with fixed gradients,\n\t// without the analytical derivative.\n\t// This function is implemented as a wrapper to "psrnoise",\n\t// at the minimal cost of three extra additions.\n\t//\n\tfloat psnoise(vec2 pos, vec2 per) {\n\t  return psrnoise(pos, per, 0.0);\n\t}\n\n\t//\n\t// 2-D non-tiling simplex noise with rotating gradients and analytical derivative.\n\t// The first component of the 3-element return vector is the noise value,\n\t// and the second and third components are the x and y partial derivatives.\n\t//\n\tvec3 srdnoise(vec2 pos, float rot) {\n\t  // Offset y slightly to hide some rare artifacts\n\t  pos.y += 0.001;\n\t  // Skew to hexagonal grid\n\t  vec2 uv = vec2(pos.x + pos.y*0.5, pos.y);\n\n\t  vec2 i0 = floor(uv);\n\t  vec2 f0 = fract(uv);\n\t  // Traversal order\n\t  vec2 i1 = (f0.x > f0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n\n\t  // Unskewed grid points in (x,y) space\n\t  vec2 p0 = vec2(i0.x - i0.y * 0.5, i0.y);\n\t  vec2 p1 = vec2(p0.x + i1.x - i1.y * 0.5, p0.y + i1.y);\n\t  vec2 p2 = vec2(p0.x + 0.5, p0.y + 1.0);\n\n\t  // Integer grid point indices in (u,v) space\n\t  i1 = i0 + i1;\n\t  vec2 i2 = i0 + vec2(1.0, 1.0);\n\n\t  // Vectors in unskewed (x,y) coordinates from\n\t  // each of the simplex corners to the evaluation point\n\t  vec2 d0 = pos - p0;\n\t  vec2 d1 = pos - p1;\n\t  vec2 d2 = pos - p2;\n\n\t  vec3 x = vec3(p0.x, p1.x, p2.x);\n\t  vec3 y = vec3(p0.y, p1.y, p2.y);\n\t  vec3 iuw = x + 0.5 * y;\n\t  vec3 ivw = y;\n\n\t  // Avoid precision issues in permutation\n\t  iuw = mod289(iuw);\n\t  ivw = mod289(ivw);\n\n\t  // Create gradients from indices\n\t  vec2 g0 = rgrad2(vec2(iuw.x, ivw.x), rot);\n\t  vec2 g1 = rgrad2(vec2(iuw.y, ivw.y), rot);\n\t  vec2 g2 = rgrad2(vec2(iuw.z, ivw.z), rot);\n\n\t  // Gradients dot vectors to corresponding corners\n\t  // (The derivatives of this are simply the gradients)\n\t  vec3 w = vec3(dot(g0, d0), dot(g1, d1), dot(g2, d2));\n\n\t  // Radial weights from corners\n\t  // 0.8 is the square of 2/sqrt(5), the distance from\n\t  // a grid point to the nearest simplex boundary\n\t  vec3 t = 0.8 - vec3(dot(d0, d0), dot(d1, d1), dot(d2, d2));\n\n\t  // Partial derivatives for analytical gradient computation\n\t  vec3 dtdx = -2.0 * vec3(d0.x, d1.x, d2.x);\n\t  vec3 dtdy = -2.0 * vec3(d0.y, d1.y, d2.y);\n\n\t  // Set influence of each surflet to zero outside radius sqrt(0.8)\n\t  if (t.x < 0.0) {\n\t\tdtdx.x = 0.0;\n\t\tdtdy.x = 0.0;\n\t\tt.x = 0.0;\n\t  }\n\t  if (t.y < 0.0) {\n\t\tdtdx.y = 0.0;\n\t\tdtdy.y = 0.0;\n\t\tt.y = 0.0;\n\t  }\n\t  if (t.z < 0.0) {\n\t\tdtdx.z = 0.0;\n\t\tdtdy.z = 0.0;\n\t\tt.z = 0.0;\n\t  }\n\n\t  // Fourth power of t (and third power for derivative)\n\t  vec3 t2 = t * t;\n\t  vec3 t4 = t2 * t2;\n\t  vec3 t3 = t2 * t;\n\n\t  // Final noise value is:\n\t  // sum of ((radial weights) times (gradient dot vector from corner))\n\t  float n = dot(t4, w);\n\n\t  // Final analytical derivative (gradient of a sum of scalar products)\n\t  vec2 dt0 = vec2(dtdx.x, dtdy.x) * 4.0 * t3.x;\n\t  vec2 dn0 = t4.x * g0 + dt0 * w.x;\n\t  vec2 dt1 = vec2(dtdx.y, dtdy.y) * 4.0 * t3.y;\n\t  vec2 dn1 = t4.y * g1 + dt1 * w.y;\n\t  vec2 dt2 = vec2(dtdx.z, dtdy.z) * 4.0 * t3.z;\n\t  vec2 dn2 = t4.z * g2 + dt2 * w.z;\n\n\t  return 11.0*vec3(n, dn0 + dn1 + dn2);\n\t}\n\n\t//\n\t// 2-D non-tiling simplex noise with fixed gradients and analytical derivative.\n\t// This function is implemented as a wrapper to "srdnoise",\n\t// at the minimal cost of three extra additions.\n\t//\n\tvec3 sdnoise(vec2 pos) {\n\t  return srdnoise(pos, 0.0);\n\t}\n\n\t//\n\t// 2-D non-tiling simplex noise with rotating gradients,\n\t// without the analytical derivative.\n\t//\n\tfloat srnoise(vec2 pos, float rot) {\n\t  // Offset y slightly to hide some rare artifacts\n\t  pos.y += 0.001;\n\t  // Skew to hexagonal grid\n\t  vec2 uv = vec2(pos.x + pos.y*0.5, pos.y);\n\n\t  vec2 i0 = floor(uv);\n\t  vec2 f0 = fract(uv);\n\t  // Traversal order\n\t  vec2 i1 = (f0.x > f0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n\n\t  // Unskewed grid points in (x,y) space\n\t  vec2 p0 = vec2(i0.x - i0.y * 0.5, i0.y);\n\t  vec2 p1 = vec2(p0.x + i1.x - i1.y * 0.5, p0.y + i1.y);\n\t  vec2 p2 = vec2(p0.x + 0.5, p0.y + 1.0);\n\n\t  // Integer grid point indices in (u,v) space\n\t  i1 = i0 + i1;\n\t  vec2 i2 = i0 + vec2(1.0, 1.0);\n\n\t  // Vectors in unskewed (x,y) coordinates from\n\t  // each of the simplex corners to the evaluation point\n\t  vec2 d0 = pos - p0;\n\t  vec2 d1 = pos - p1;\n\t  vec2 d2 = pos - p2;\n\n\t  // Wrap i0, i1 and i2 to the desired period before gradient hashing:\n\t  // wrap points in (x,y), map to (u,v)\n\t  vec3 x = vec3(p0.x, p1.x, p2.x);\n\t  vec3 y = vec3(p0.y, p1.y, p2.y);\n\t  vec3 iuw = x + 0.5 * y;\n\t  vec3 ivw = y;\n\n\t  // Avoid precision issues in permutation\n\t  iuw = mod289(iuw);\n\t  ivw = mod289(ivw);\n\n\t  // Create gradients from indices\n\t  vec2 g0 = rgrad2(vec2(iuw.x, ivw.x), rot);\n\t  vec2 g1 = rgrad2(vec2(iuw.y, ivw.y), rot);\n\t  vec2 g2 = rgrad2(vec2(iuw.z, ivw.z), rot);\n\n\t  // Gradients dot vectors to corresponding corners\n\t  // (The derivatives of this are simply the gradients)\n\t  vec3 w = vec3(dot(g0, d0), dot(g1, d1), dot(g2, d2));\n\n\t  // Radial weights from corners\n\t  // 0.8 is the square of 2/sqrt(5), the distance from\n\t  // a grid point to the nearest simplex boundary\n\t  vec3 t = 0.8 - vec3(dot(d0, d0), dot(d1, d1), dot(d2, d2));\n\n\t  // Set influence of each surflet to zero outside radius sqrt(0.8)\n\t  t = max(t, 0.0);\n\n\t  // Fourth power of t\n\t  vec3 t2 = t * t;\n\t  vec3 t4 = t2 * t2;\n\n\t  // Final noise value is:\n\t  // sum of ((radial weights) times (gradient dot vector from corner))\n\t  float n = dot(t4, w);\n\n\t  // Rescale to cover the range [-1,1] reasonably well\n\t  return 11.0*n;\n\t}\n\n\t//\n\t// 2-D non-tiling simplex noise with fixed gradients,\n\t// without the analytical derivative.\n\t// This function is implemented as a wrapper to "srnoise",\n\t// at the minimal cost of three extra additions.\n\t// Note: if this kind of noise is all you want, there are faster\n\t// GLSL implementations of non-tiling simplex noise out there.\n\t// This one is included mainly for completeness and compatibility\n\t// with the other functions in the file.\n\t//\n\tfloat snoise(vec2 pos) {\n\t  return srnoise(pos, 0.0);\n\t}\n\n\tfloat hash(float x, float y) {\n\t\treturn fract(abs(sin(sin(123.321 + x) * (y + 321.123)) * 456.654));\n\t}\n\n\tfloat lerp(float a, float b, float t) {\n\t\treturn a * (1.0 - t) + b * t;\n\t}\n\n\tfloat perlin(float x, float y){\n\t\tfloat col = 0.0;\n\t\tfor (int i = 0; i < 8; i++)\n\t\t{\n\t\t\tfloat fx = floor(x);\n\t\t\tfloat fy = floor(y);\n\t\t\tfloat cx = ceil(x);\n\t\t\tfloat cy = ceil(y);\n\t\t\tfloat a = hash(fx, fy);\n\t\t\tfloat b = hash(fx, cy);\n\t\t\tfloat c = hash(cx, fy);\n\t\t\tfloat d = hash(cx, cy);\n\t\t\tcol += lerp(lerp(a, b, fract(y)), lerp(c, d, fract(y)), fract(x));\n\t\t\tcol /= 2.0;\n\t\t\tx /= 2.0;\n\t\t\ty /= 2.0;\n\t\t}\n\t\treturn col;\n\t}\n\n\tfloat dperlin(float x, float y){\n\t\tfloat d = perlin(x, y) * 800.0;\n\t\treturn perlin(x + d, y + d);\n\t}\n\n\tfloat ddperlin(float x, float y){\n\t\tfloat d = perlin(x, y) * 800.0;\n\t\treturn dperlin(x + d, y + d);\n\t}\n',this.ballUniforms={u_time:{value:0},u_mouse:{value:{x:0,y:0}},u_opacity:{value:.6},u_resolution:{value:{x:0,y:0}},u_tex:{value:this.textLoader.load("plane/img/explosion.png")}};var t=new Le({vertexShader:Nt,fragmentShader:Ft,uniforms:this.ballUniforms,transparent:!0,opacity:.6});this.ball=new re(e,t),this.ball.name="ball"}},{key:"initMusic",value:function(){this.viewer.music.loadMusic("gliss.mp3","plane/music/"),this.viewer.music.loadMusic("engine.mp3","plane/music/",!0,1),this.viewer.music.loadMusic("explosion.mp3","plane/music/")}},{key:"loadPlane",value:function(){var e=this;this.gltfLoader.setPath("plane/glb/"),this.gltfLoader.load("microplane.glb",(function(t){e.plane=t.scene,e.plane.scale.set(10,10,10),e.plane.position.set(0,0,-100),e.viewer.scene.add(e.plane),e.viewer.camera.position.set(-180,0,-40),e.viewer.camera.lookAt(e.plane.position),e.render()}))}},{key:"loadObstacle",value:function(){var e=this;this.obstacle=new ue,this.gltfLoader.setPath("plane/glb/"),this.gltfLoader.load("bomb.glb",(function(t){e.bomb=t.scene,e.bomb.scale.set(10,10,10);for(var n=[90,45,-45,-90],r=0;r<4;r++){var i=e.bomb.clone();i.position.y+=n[r],i.rotation.set(r%2?-Math.PI/2:-Math.PI,0,0),i.name="bomb",i.userData.isCollide=!1,e.obstacle.add(i)}})),this.gltfLoader.load("star.glb",(function(t){e.star=t.scene,e.star.scale.set(10,10,10);var n=e.star.clone();n.name="star",n.userData.isCollide=!1,e.obstacle.add(n)}))}},{key:"update",value:function(){var e=this.clock1.getElapsedTime(),t=this.clock2.getElapsedTime();this.plane&&(this.playing?(this.spaceing?this.plane.position.y+=.8:this.plane.position.y-=1.4,this.plane.position.z+=.8,this.viewer.camera.position.z+=.8,this.viewer.camera.position.y=this.plane.position.y+10*Math.cos(1.5*e),this.computedCollision(this.pos),this.ballUniforms.u_time.value=t,this.ballUniforms.u_opacity.value=Math.cos(t),this.plane.children.forEach((function(t){t.children.forEach((function(t){"propeller"===t.name&&t.rotation.set(0,0,Math.cos(80*e))}))}))):this.plane.position.y=10*Math.cos(1.5*e),this.viewer.camera.lookAt(this.plane.position),this.plane.rotation.z=.2*Math.sin(3*e),this.render())}},{key:"computedCollision",value:function(e){var t=this;this.plane.getWorldPosition(e);var n=e.y,r=e.z;this.obstacles.children.forEach((function(e){var i=new Re;e.getWorldPosition(i);var o=i.z-r;o<14&&o>-24?e.children.forEach((function(e){var r=new Re;e.getWorldPosition(r);var i=r.y-n;i<10&&i>-10&&!e.userData.isCollide&&(e.userData.isCollide=!0,"star"===e.name?(t.viewer.music.setPlay("gliss.mp3"),t.starNum++,t.viewer.emit("addStar",t.starNum)):(t.viewer.music.setPlay("explosion.mp3"),t.lifeNum--,t.viewer.emit("decLife",t.lifeNum),t.ball.position.set(r.x,r.y,r.z),t.viewer.scene.add(t.ball),t.clock2.start()))})):e.children.forEach((function(e){e.userData.isCollide&&(e.userData.isCollide=!1,"star"===e.name?t.viewer.music.setStop("gliss.mp3"):(t.viewer.music.setStop("explosion.mp3"),t.viewer.scene.remove(t.ball)))}))}))}},{key:"listen",value:function(){document.addEventListener("keydown",this.event.keydown),document.addEventListener("keyup",this.event.keyup),document.addEventListener("mousedown",this.event.mousedown),document.addEventListener("mouseup",this.event.mouseup),document.addEventListener("touchstart",this.event.mousedown),document.addEventListener("touchend",this.event.mouseup)}},{key:"destroy",value:function(){document.removeEventListener("keydown",this.event.keydown),document.removeEventListener("keyup",this.event.keyup),document.removeEventListener("mousedown",this.event.mousedown),document.removeEventListener("mouseup",this.event.mouseup),document.removeEventListener("touchstart",this.event.mousedown),document.removeEventListener("touchend",this.event.mouseup),this.viewer.destroy()}},{key:"startGame",value:function(){this.playing=!0,this.viewer.music.setPlay("engine.mp3")}},{key:"gameOver",value:function(){this.reset()}},{key:"reset",value:function(){this.playing=!1,this.lifeNum=5,this.starNum=0,this.viewer.music.setStopAll(),this.plane.position.set(0,0,-100),this.viewer.camera.position.set(-180,0,-40)}}]),t}();r("default",(function(){var e=t(i.exports.useState(5),2),n=e[0],r=e[1],o=t(i.exports.useState(0),2),a=o[0],s=o[1],c=t(i.exports.useState(!1),2),l=c[0],u=c[1],d=i.exports.useRef(null);i.exports.useEffect((function(){if(d.current){var e,t=new ke(d.current);t.useOrbitControls(),t.controls.enableZoom=!1,t.listen(),t.on("addStar",(function(e){s(e)})),t.on("decLife",(function(e){r(e),0===e&&setTimeout((function(){r(5),s(0),Ot.gameOver(),u(!1)}),600)})),Ot=new Ht(t);return function t(){Ot.update(),e=requestAnimationFrame(t)}(),function(){cancelIdleCallback(e),Ot.destroy()}}}),[]);return p("div",{className:"w-100% h-100% relative",children:g("div",{className:"gunplay w-100% h-100%",ref:d,children:[p("div",{className:"play absolute left-50% top-50% z-999 translate-x--50%",children:!l&&p(Ce,{size:"large",icon:p(Ne,{}),onClick:function(){u(!0),Ot.startGame()},children:"Play"})}),g("div",{className:"life absolute left-20px top-10px",children:[p("img",{width:100,height:60,alt:"飞机",src:"/ldx-three-learn/plane/img/plane-icon.png"}),g("span",{className:"text-26px text-#fff",children:[n," "]})]}),g("div",{className:"star absolute right-20px top-10px",children:[g("span",{className:"text-26px text-#fff",children:[a," "]}),p("img",{width:100,height:70,src:"/ldx-three-learn/plane/img/star-icon.png",alt:"星星"})]})]})})}))}}}))}();
