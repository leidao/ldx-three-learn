!function(){function e(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&r(e,t)}function r(e,t){return r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},r(e,t)}function i(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=a(e);if(t){var i=a(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return o(this,n)}}function o(e,n){if(n&&("object"===t(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function a(e){return a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},a(e)}function s(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t,n){return t&&h(e.prototype,t),n&&h(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var d=document.createElement("style");d.innerHTML='#--unocss-hash--{content:"40d0367c"}\n',document.head.appendChild(d),System.register(["./index-legacy.ca9e882d.js","./index-legacy.969d3e24.js","./GLTFLoader-legacy.14fd70b7.js"],(function(r){"use strict";var o,a,u,h,d,f,v,p,y,g,w,m,b,k,P,x,L,T,_,I,E,A,S,M;return{setters:[function(e){o=e.r,a=e.j},function(e){u=e.aq,h=e.V,d=e.ar,f=e.e,e.a8,e.M,e.ai,e.g,e.as,v=e.E,p=e.O,y=e.B,g=e.Z,w=e.L,m=e.F,b=e.Q,k=e.G,P=e.at,x=e.au,L=e.av,T=e.aa,_=e.C,I=e.aw,E=e.s,A=e.ax,S=e.c},function(e){M=e.G}],execute:function(){var C,D=function(){function e(){c(this,e)}return l(e,null,[{key:"roundNumber",value:function(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n}},{key:"sample",value:function(e){return e[Math.floor(Math.random()*e.length)]}},{key:"distanceToSquared",value:function(e,t){var n=e.x-t.x,r=e.y-t.y,i=e.z-t.z;return n*n+r*r+i*i}},{key:"isPointInPoly",value:function(e,t){for(var n=!1,r=-1,i=e.length,o=i-1;++r<i;o=r)(e[r].z<=t.z&&t.z<e[o].z||e[o].z<=t.z&&t.z<e[r].z)&&t.x<(e[o].x-e[r].x)*(t.z-e[r].z)/(e[o].z-e[r].z)+e[r].x&&(n=!n);return n}},{key:"isVectorInPolygon",value:function(e,t,n){var r=1e5,i=-1e5,o=[];return t.vertexIds.forEach((function(e){r=Math.min(n[e].y,r),i=Math.max(n[e].y,i),o.push(n[e])})),!!(e.y<i+.5&&e.y>r-.5&&this.isPointInPoly(o,e))}},{key:"triarea2",value:function(e,t,n){return(n.x-e.x)*(t.z-e.z)-(t.x-e.x)*(n.z-e.z)}},{key:"vequal",value:function(e,t){return this.distanceToSquared(e,t)<1e-5}},{key:"mergeVertices",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e-4;t=Math.max(t,Number.EPSILON);for(var n={},r=e.getIndex(),i=e.getAttribute("position"),o=r?r.count:i.count,a=0,s=[],u=[],c=Math.log10(1/t),h=Math.pow(10,c),l=0;l<o;l++){var d=r?r.getX(l):l,f="";f+=~~(i.getX(d)*h)+",",f+=~~(i.getY(d)*h)+",",(f+=~~(i.getZ(d)*h)+",")in n?s.push(n[f]):(u.push(i.getX(d)),u.push(i.getY(d)),u.push(i.getZ(d)),n[f]=a,s.push(a),a++)}var v=new y(new Float32Array(u),i.itemSize,i.normalized),g=new p;return g.setAttribute("position",v),g.setIndex(s),g}}]),e}(),N=function(){function e(t){c(this,e),this.content=[],this.scoreFunction=t}return l(e,[{key:"push",value:function(e){this.content.push(e),this.sinkDown(this.content.length-1)}},{key:"pop",value:function(){var e=this.content[0],t=this.content.pop();return this.content.length>0&&(this.content[0]=t,this.bubbleUp(0)),e}},{key:"remove",value:function(e){var t=this.content.indexOf(e),n=this.content.pop();t!==this.content.length-1&&(this.content[t]=n,this.scoreFunction(n)<this.scoreFunction(e)?this.sinkDown(t):this.bubbleUp(t))}},{key:"size",value:function(){return this.content.length}},{key:"rescoreElement",value:function(e){this.sinkDown(this.content.indexOf(e))}},{key:"sinkDown",value:function(e){for(var t=this.content[e];e>0;){var n=(e+1>>1)-1,r=this.content[n];if(!(this.scoreFunction(t)<this.scoreFunction(r)))break;this.content[n]=t,this.content[e]=r,e=n}}},{key:"bubbleUp",value:function(e){for(var t=this.content.length,n=this.content[e],r=this.scoreFunction(n);;){var i=e+1<<1,o=i-1,a=void 0,s=null;if(o<t&&((a=this.scoreFunction(this.content[o]))<r&&(s=o)),i<t&&this.scoreFunction(this.content[i])<(null===s?r:a)&&(s=i),null===s)break;this.content[e]=this.content[s],this.content[s]=n,e=s}}}]),e}(),O=function(){function e(){c(this,e),this.portals=[]}return l(e,[{key:"push",value:function(e,t){void 0===t&&(t=e),this.portals.push({left:e,right:t})}},{key:"stringPull",value:function(){var e,t,n,r=this.portals,i=[],o=0,a=0,s=0;e=r[0].left,t=r[0].left,n=r[0].right,i.push(e);for(var u=1;u<r.length;u++){var c=r[u].left,h=r[u].right;if(D.triarea2(e,n,h)<=0){if(!(D.vequal(e,n)||D.triarea2(e,t,h)>0)){i.push(t),t=e=t,n=e,a=o=a,s=o,u=o;continue}n=h,s=u}if(D.triarea2(e,t,c)>=0){if(!(D.vequal(e,t)||D.triarea2(e,n,c)<0)){i.push(n),t=e=n,n=e,a=o=s,s=o,u=o;continue}t=c,a=u}}return 0!==i.length&&D.vequal(i[i.length-1],r[r.length-1].left)||i.push(r[r.length-1].left),this.path=i,i}}]),e}(),z=function(){function e(){c(this,e),this.zones={}}return l(e,[{key:"setZoneData",value:function(e,t){this.zones[e]=t}},{key:"getRandomNode",value:function(e,t,n,r){if(!this.zones[e])return new h;n=n||null,r=r||0;var i=[];return this.zones[e].groups[t].forEach((function(e){n&&r?D.distanceToSquared(n,e.centroid)<r*r&&i.push(e.centroid):i.push(e.centroid)})),D.sample(i)||new h}},{key:"getClosestNode",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=this.zones[t].vertices,o=null,a=1/0;return this.zones[t].groups[n].forEach((function(t){var n=D.distanceToSquared(t.centroid,e);n<a&&(!r||D.isVectorInPolygon(e,t,i))&&(o=t,a=n)})),o}},{key:"findPath",value:function(e,t,n,r){var i=this.zones[n].groups[r],o=this.zones[n].vertices,a=this.getClosestNode(e,n,r,!0),s=this.getClosestNode(t,n,r,!0);if(!a||!s)return null;var u=function(){function e(){c(this,e)}return l(e,null,[{key:"init",value:function(e){for(var t=0;t<e.length;t++){var n=e[t];n.f=0,n.g=0,n.h=0,n.cost=1,n.visited=!1,n.closed=!1,n.parent=null}}},{key:"cleanUp",value:function(e){for(var t=0;t<e.length;t++){var n=e[t];delete n.f,delete n.g,delete n.h,delete n.cost,delete n.visited,delete n.closed,delete n.parent}}},{key:"heap",value:function(){return new N((function(e){return e.f}))}},{key:"search",value:function(e,t,n){this.init(e);var r=this.heap();for(r.push(t);r.size()>0;){var i=r.pop();if(i===n){for(var o=i,a=[];o.parent;)a.push(o),o=o.parent;return this.cleanUp(a),a.reverse()}i.closed=!0;for(var s=this.neighbours(e,i),u=0,c=s.length;u<c;u++){var h=s[u];if(!h.closed){var l=i.g+h.cost,d=h.visited;if(!d||l<h.g){if(h.visited=!0,h.parent=i,!h.centroid||!n.centroid)throw new Error("Unexpected state");h.h=h.h||this.heuristic(h.centroid,n.centroid),h.g=l,h.f=h.g+h.h,d?r.rescoreElement(h):r.push(h)}}}}return[]}},{key:"heuristic",value:function(e,t){return D.distanceToSquared(e,t)}},{key:"neighbours",value:function(e,t){for(var n=[],r=0;r<t.neighbours.length;r++)n.push(e[t.neighbours[r]]);return n}}]),e}().search(i,a,s),d=function(e,t){for(var n=0;n<e.neighbours.length;n++)if(e.neighbours[n]===t.id)return e.portals[n]},f=new O;f.push(e);for(var v=0;v<u.length;v++){var p=u[v],y=u[v+1];if(y){var g=d(p,y);f.push(o[g[0]],o[g[1]])}}f.push(t),f.stringPull();var w=f.path.map((function(e){return new h(e.x,e.y,e.z)}));return w.shift(),w}}],[{key:"createZone",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e-4;return function(){function e(){c(this,e)}return l(e,null,[{key:"buildZone",value:function(e,t){var n=this,r=this._buildNavigationMesh(e,t),i={};r.vertices.forEach((function(e){e.x=D.roundNumber(e.x,2),e.y=D.roundNumber(e.y,2),e.z=D.roundNumber(e.z,2)})),i.vertices=r.vertices;var o=this._buildPolygonGroups(r);return i.groups=new Array(o.length),o.forEach((function(e,t){var r=new Map;e.forEach((function(e,t){r.set(e,t)}));var o=new Array(e.length);e.forEach((function(e,t){var a=[];e.neighbours.forEach((function(e){return a.push(r.get(e))}));var s=[];e.neighbours.forEach((function(t){return s.push(n._getSharedVerticesInOrder(e,t))}));var u=new h(0,0,0);u.add(i.vertices[e.vertexIds[0]]),u.add(i.vertices[e.vertexIds[1]]),u.add(i.vertices[e.vertexIds[2]]),u.divideScalar(3),u.x=D.roundNumber(u.x,2),u.y=D.roundNumber(u.y,2),u.z=D.roundNumber(u.z,2),o[t]={id:t,neighbours:a,vertexIds:e.vertexIds,centroid:u,portals:s}})),i.groups[t]=o})),i}},{key:"_buildNavigationMesh",value:function(e,t){return e=D.mergeVertices(e,t),this._buildPolygonsFromGeometry(e)}},{key:"_spreadGroupId",value:function(e){for(var t=new Set([e]);t.size>0;){var n=t;t=new Set,n.forEach((function(n){n.group=e.group,n.neighbours.forEach((function(e){void 0===e.group&&t.add(e)}))}))}}},{key:"_buildPolygonGroups",value:function(e){var t=this,n=[];return e.polygons.forEach((function(e){void 0!==e.group?n[e.group].push(e):(e.group=n.length,t._spreadGroupId(e),n.push([e]))})),n}},{key:"_buildPolygonNeighbours",value:function(e,t){var n=new Set,r=t[e.vertexIds[1]],i=t[e.vertexIds[2]];return t[e.vertexIds[0]].forEach((function(t){t!==e&&(r.includes(t)||i.includes(t))&&n.add(t)})),r.forEach((function(t){t!==e&&i.includes(t)&&n.add(t)})),n}},{key:"_buildPolygonsFromGeometry",value:function(e){for(var t=this,n=[],r=[],i=e.attributes.position,o=e.index,a=[],s=0;s<i.count;s++)r.push((new h).fromBufferAttribute(i,s)),a[s]=[];for(var u=0;u<e.index.count;u+=3){var c=o.getX(u),l=o.getX(u+1),d=o.getX(u+2),f={vertexIds:[c,l,d],neighbours:null};n.push(f),a[c].push(f),a[l].push(f),a[d].push(f)}return n.forEach((function(e){e.neighbours=t._buildPolygonNeighbours(e,a)})),{polygons:n,vertices:r}}},{key:"_getSharedVerticesInOrder",value:function(e,t){var n=e.vertexIds,r=n[0],i=n[1],o=n[2],a=t.vertexIds,s=a.includes(r),u=a.includes(i),c=a.includes(o);return s&&u&&c?Array.from(n):s&&u?[r,i]:u&&c?[i,o]:s&&c?[o,r]:(console.warn("Error processing navigation mesh neighbors; neighbors with <2 shared vertices found."),[])}}]),e}().buildZone(e,t)}}]),e}();z.prototype.getGroup=(C=new u,function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.zones[e])return null;for(var r=null,i=Math.pow(50,2),o=this.zones[e],a=0;a<o.groups.length;a++){var u,c=o.groups[a],h=s(c);try{for(h.s();!(u=h.n()).done;){var l=u.value;if(n&&(C.setFromCoplanarPoints(o.vertices[l.vertexIds[0]],o.vertices[l.vertexIds[1]],o.vertices[l.vertexIds[2]]),Math.abs(C.distanceToPoint(t))<.01)&&D.isPointInPoly([o.vertices[l.vertexIds[0]],o.vertices[l.vertexIds[1]],o.vertices[l.vertexIds[2]]],t))return a;var d=D.distanceToSquared(l.centroid,t);d<i&&(r=a,i=d)}}catch(f){h.e(f)}finally{h.f()}}return r}),z.prototype.clampStep=function(){var e,t,n=new h,r=new u,i=new d,o=new h,a=new h;return function(s,u,c,h,l,d){var f=this.zones[h].vertices,v=this.zones[h].groups[l],p=[c],y={};y[c.id]=0,e=void 0,a.set(0,0,0),t=1/0,r.setFromCoplanarPoints(f[c.vertexIds[0]],f[c.vertexIds[1]],f[c.vertexIds[2]]),r.projectPoint(u,n),o.copy(n);for(var g=p.pop();g;g=p.pop()){i.set(f[g.vertexIds[0]],f[g.vertexIds[1]],f[g.vertexIds[2]]),i.closestPointToPoint(o,n),n.distanceToSquared(o)<t&&(e=g,a.copy(n),t=n.distanceToSquared(o));var w=y[g.id];if(!(w>2))for(var m=0;m<g.neighbours.length;m++){var b=v[g.neighbours[m]];b.id in y||(p.push(b),y[b.id]=w+1)}}return d.copy(a),e}}();new f(15631215).convertSRGBToLinear().getHex(),new f(14469912).convertSRGBToLinear().getHex(),new f(41903).convertSRGBToLinear().getHex(),new f(41903).convertSRGBToLinear().getHex(),new f(14472114).convertSRGBToLinear().getHex(),new f(4417387).convertSRGBToLinear().getHex();var j=new WeakMap,R=function(e){n(o,e);var r=i(o);function o(e){var t;return c(this,o),(t=r.call(this,e)).decoderPath="",t.decoderConfig={},t.decoderBinary=null,t.decoderPending=null,t.workerLimit=4,t.workerPool=[],t.workerNextTaskID=1,t.workerSourceURL="",t.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},t.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"},t}return l(o,[{key:"setDecoderPath",value:function(e){return this.decoderPath=e,this}},{key:"setDecoderConfig",value:function(e){return this.decoderConfig=e,this}},{key:"setWorkerLimit",value:function(e){return this.workerLimit=e,this}},{key:"load",value:function(e,t,n,r){var i=this,o=new m(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(e){var n={attributeIDs:i.defaultAttributeIDs,attributeTypes:i.defaultAttributeTypes,useUniqueIDs:!1};i.decodeGeometry(e,n).then(t).catch(r)}),n,r)}},{key:"decodeDracoFile",value:function(e,t,n,r){var i={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!n};this.decodeGeometry(e,i).then(t)}},{key:"decodeGeometry",value:function(e,t){var n=this;for(var r in t.attributeTypes){var i=t.attributeTypes[r];void 0!==i.BYTES_PER_ELEMENT&&(t.attributeTypes[r]=i.name)}var o,a=JSON.stringify(t);if(j.has(e)){var s=j.get(e);if(s.key===a)return s.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var u=this.workerNextTaskID++,c=e.byteLength,h=this._getWorker(u,c).then((function(n){return o=n,new Promise((function(n,r){o._callbacks[u]={resolve:n,reject:r},o.postMessage({type:"decode",id:u,taskConfig:t,buffer:e},[e])}))})).then((function(e){return n._createGeometry(e.geometry)}));return h.catch((function(){return!0})).then((function(){o&&u&&n._releaseTask(o,u)})),j.set(e,{key:a,promise:h}),h}},{key:"_createGeometry",value:function(e){var t=new p;e.index&&t.setIndex(new y(e.index.array,1));for(var n=0;n<e.attributes.length;n++){var r=e.attributes[n],i=r.name,o=r.array,a=r.itemSize;t.setAttribute(i,new y(o,a))}return t}},{key:"_loadLibrary",value:function(e,t){var n=new m(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise((function(t,r){n.load(e,t,void 0,r)}))}},{key:"preload",value:function(){return this._initDecoder(),this}},{key:"_initDecoder",value:function(){var e=this;if(this.decoderPending)return this.decoderPending;var n="object"!==("undefined"==typeof WebAssembly?"undefined":t(WebAssembly))||"js"===this.decoderConfig.type,r=[];return n?r.push(this._loadLibrary("draco_decoder.js","text")):(r.push(this._loadLibrary("draco_wasm_wrapper.js","text")),r.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(r).then((function(t){var r=t[0];n||(e.decoderConfig.wasmBinary=t[1]);var i=G.toString(),o=["/* draco decoder */",r,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");e.workerSourceURL=URL.createObjectURL(new Blob([o]))})),this.decoderPending}},{key:"_getWorker",value:function(e,t){var n=this;return this._initDecoder().then((function(){if(n.workerPool.length<n.workerLimit){var r=new Worker(n.workerSourceURL);r._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:n.decoderConfig}),r.onmessage=function(e){var t=e.data;switch(t.type){case"decode":r._callbacks[t.id].resolve(t);break;case"error":r._callbacks[t.id].reject(t);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+t.type+'"')}},n.workerPool.push(r)}else n.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));var i=n.workerPool[n.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i}))}},{key:"_releaseTask",value:function(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}},{key:"debug",value:function(){console.log("Task load: ",this.workerPool.map((function(e){return e._taskLoad})))}},{key:"dispose",value:function(){for(var e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}]),o}(w);function G(){var e,t;function n(e,t,n,r,i,o){var a=o.num_components(),s=n.num_points()*a,u=s*i.BYTES_PER_ELEMENT,c=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,i),h=e._malloc(u);t.GetAttributeDataArrayForAllPoints(n,o,c,u,h);var l=new i(e.HEAPF32.buffer,h,s).slice();return e._free(h),{name:r,array:l,itemSize:a}}onmessage=function(r){var i=r.data;switch(i.type){case"init":e=i.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":var o=i.buffer,a=i.taskConfig;t.then((function(e){var t=e.draco,r=new t.Decoder,s=new t.DecoderBuffer;s.Init(new Int8Array(o),o.byteLength);try{var u=function(e,t,r,i){var o,a,s=i.attributeIDs,u=i.attributeTypes,c=t.GetEncodedGeometryType(r);if(c===e.TRIANGULAR_MESH)o=new e.Mesh,a=t.DecodeBufferToMesh(r,o);else{if(c!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");o=new e.PointCloud,a=t.DecodeBufferToPointCloud(r,o)}if(!a.ok()||0===o.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+a.error_msg());var h={index:null,attributes:[]};for(var l in s){var d=self[u[l]],f=void 0,v=void 0;if(i.useUniqueIDs)v=s[l],f=t.GetAttributeByUniqueId(o,v);else{if(-1===(v=t.GetAttributeId(o,e[s[l]])))continue;f=t.GetAttribute(o,v)}h.attributes.push(n(e,t,o,l,d,f))}c===e.TRIANGULAR_MESH&&(h.index=function(e,t,n){var r=3*n.num_faces(),i=4*r,o=e._malloc(i);t.GetTrianglesUInt32Array(n,i,o);var a=new Uint32Array(e.HEAPF32.buffer,o,r).slice();return e._free(o),{array:a,itemSize:1}}(e,t,o));return e.destroy(o),h}(t,r,s,a),c=u.attributes.map((function(e){return e.array.buffer}));u.index&&c.push(u.index.array.buffer),self.postMessage({type:"decode",id:i.id,geometry:u},c)}catch(h){console.error(h),self.postMessage({type:"error",id:i.id,error:h.message})}finally{t.destroy(s),t.destroy(r)}}))}}}var F=function(){function t(n){var r=this;c(this,t),e(this,"object",void 0),e(this,"pathfinder",void 0),e(this,"name",""),e(this,"actionName",""),e(this,"animations",{}),e(this,"app",void 0),e(this,"speed",void 0),e(this,"calculatedPath",void 0),e(this,"waypoints",void 0),e(this,"quaternion",new b),e(this,"pathLines",void 0),e(this,"navMeshGroup",new k),e(this,"pathColor",new f(16777215)),e(this,"showPath",!1),e(this,"dead",!1),e(this,"ZONE",""),e(this,"mixer",void 0),e(this,"curAction",void 0),this.name=n.name||"NPC",this.animations={},this.object=n.object,n.app.viewer.scene.add(n.object),this.showPath=n.showPath||!1,this.waypoints=n.waypoints||[],this.speed=n.speed,this.app=n.app,n.app.pathfinder&&(this.pathfinder=n.app.pathfinder,this.ZONE=n.zone,this.navMeshGroup=this.pathfinder.getGroup(this.ZONE,this.object.position));var i=this.object.position.clone();i.z+=10,this.object.lookAt(i),n.animations&&(this.mixer=new P(n.object),n.animations.forEach((function(e){r.animations[e.name.toLowerCase()]=e})))}return l(t,[{key:"randomWaypoint",get:function(){var e=Math.floor(Math.random()*this.waypoints.length);return this.waypoints[e]}},{key:"action",set:function(e){if(this.actionName!=e.toLowerCase()){var t=this.animations[e.toLowerCase()];if(void 0!==t){var n=this.mixer.clipAction(t);"shot"==e&&(n.clampWhenFinished=!0,n.setLoop(x,L)),n.reset();var r="shot"==this.actionName;this.actionName=e.toLowerCase(),n.play(),this.curAction&&(r?this.curAction.enabled=!1:this.curAction.crossFadeTo(n,.5,!0)),this.curAction=n}}}},{key:"setTargetDirection",value:function(e){var t=this.object;e.y=t.position.y;var n=t.quaternion.clone();t.lookAt(e),this.quaternion=t.quaternion.clone(),t.quaternion.copy(n)}},{key:"newPath",value:function(e){var t=this.object;if(!this.pathfinder)return this.calculatedPath=[e.clone()],this.setTargetDirection(e.clone()),void(this.action="walking");if(this.calculatedPath=this.pathfinder.findPath(t.position,e,this.ZONE,this.navMeshGroup),this.calculatedPath&&this.calculatedPath.length>0){if(this.action="walking",this.setTargetDirection(this.calculatedPath[0].clone()),this.showPath){var n=new v({color:this.pathColor,linewidth:2}),r=[t.position];this.calculatedPath.forEach((function(e){r.push(e.clone())}));var i=(new p).setFromPoints(r);this.pathLines=new g(i,n),this.app.viewer.scene.add(this.pathLines)}}else if(this.action="idle",this.pathfinder){var o=this.pathfinder.getClosestNode(t.position,this.ZONE,this.navMeshGroup),a=new h;this.pathfinder.clampStep(t.position,e.clone(),o,this.ZONE,this.navMeshGroup,a),this.pathLines&&this.app.viewer.scene.remove(this.pathLines)}}},{key:"update",value:function(e){var t=this.speed,n=this.object;if(this.mixer&&this.mixer.update(e),this.calculatedPath&&this.calculatedPath.length>0){var r=this.calculatedPath[0],i=r.clone().sub(n.position),o=i.lengthSq()<.01;if(o)this.calculatedPath.shift(),0===this.calculatedPath.length?(void 0!==this.waypoints&&this.newPath(this.randomWaypoint),n.position.copy(r),this.action="idle"):this.setTargetDirection(r.clone());else{var a=n.position.distanceToSquared(r);i.normalize(),this.quaternion&&n.quaternion.slerp(this.quaternion,.1),n.position.add(i.multiplyScalar(e*t)),o=n.position.distanceToSquared(r)>a}}else this.dead||void 0===this.waypoints||this.newPath(this.randomWaypoint)}}]),t}(),q=function(){function t(n){c(this,t),e(this,"game",void 0),e(this,"viewer",void 0),e(this,"gltf",void 0),e(this,"npcs",[]),e(this,"waypoints",[]),this.game=n,this.viewer=n.viewer,this.load(),this.initMouseHandler()}return l(t,[{key:"randonWaypoint",get:function(){var e=Math.floor(Math.random()*this.waypoints.length);return this.waypoints[e]}},{key:"load",value:function(){var e=this;this.game.gltfLoader.setPath("factory/glb/");var t=new R(this.viewer.loadmanager);t.setDecoderPath("factory/draco/"),this.game.gltfLoader.setDRACOLoader(t),this.game.gltfLoader.load("swat-guy2.glb",(function(t){e.game.pathfinder?e.initNPCs(t):e.gltf=t}),(function(t){e.viewer.onProgress("swat-guy2.glb",t)}))}},{key:"initNPCs",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.gltf,n=[t];this.waypoints=this.game.waypoints,this.npcs=[];for(var r=0;r<3;r++)n.push(this.cloneGLTF(t));n.forEach((function(t){var n=t.scene;n.traverse((function(e){e.isMesh&&(e.castShadow=!0)}));var r={object:n,speed:.8,animations:t.animations,waypoints:e.waypoints,app:e.game,showPath:!1,zone:"factory",name:"swat-guy"},i=new F(r);i.object.position.copy(e.randonWaypoint),i.newPath(e.randonWaypoint),e.npcs.push(i)}))}},{key:"cloneGLTF",value:function(e){var t={animations:e.animations,scene:e.scene.clone(!0)},n={};e.scene.traverse((function(e){e.isSkinnedMesh&&(n[e.name]=e)}));var r={},i={};for(var o in t.scene.traverse((function(e){e.isBone&&(r[e.name]=e),e.isSkinnedMesh&&(i[e.name]=e)})),n){for(var a=n[o].skeleton,s=i[o],u=[],c=0;c<a.bones.length;++c){var h=r[a.bones[c].name];u.push(h)}s.bind(new T(u,a.boneInverses),s.matrixWorld)}return t}},{key:"initMouseHandler",value:function(){var e=this,t=this.viewer.renderer.domElement,n={x:0,y:0},r=t.getBoundingClientRect(),i=r.width,o=r.height,a=r.left,s=r.top;t.addEventListener("click",(function(t){n.x=(t.clientX-a)/i*2-1,n.y=-(t.clientY-s)/o*2+1,e.viewer.raycaster.setFromCamera(n,e.viewer.camera);var r=e.viewer.raycaster.intersectObject(e.game.navMesh);if(r.length>0){var u=r[0].point;e.npcs[0].newPath(u)}}),!1)}},{key:"update",value:function(e){this.npcs&&this.npcs.forEach((function(t){return t.update(e)}))}}]),t}(),U=function(){function t(n){var r=this;c(this,t),e(this,"clock",void 0),e(this,"viewer",void 0),e(this,"gltfLoader",void 0),e(this,"factory",void 0),e(this,"fans",[]),e(this,"navMesh",void 0),e(this,"npcHandler",void 0),e(this,"pathfinder",void 0),e(this,"waypoints",[]),e(this,"update",(function(){var e=r.clock.getDelta();r.fans.forEach((function(t){return t.rotateY(e)})),r.npcHandler&&r.npcHandler.update(e),r.render()})),this.viewer=n,n.useLoadingManager(),this.clock=new _,this.gltfLoader=new M(n.loadmanager),this.init(),this.loadFactory(),this.npcHandler=new q(this)}return l(t,[{key:"render",value:function(){this.viewer.render()}},{key:"init",value:function(){var e=2102544;this.viewer.scene.background=new f(e),this.viewer.scene.fog=new I(e,100,200),this.viewer.renderer.outputEncoding=E,this.viewer.camera.position.set(0,60,20),this.viewer.camera.lookAt(0,0,-10),this.viewer.renderer.shadowMap.enabled=!0;var t=new A(16777215,12303359,1);this.viewer.scene.add(t),this.viewer.directionalLight.position.set(0,20,20),this.viewer.directionalLight.target.position.set(-2,0,0),this.viewer.directionalLight.castShadow=!0,this.viewer.directionalLight.shadow.mapSize.set(1024,512),this.viewer.directionalLight.shadow.camera.near=.5,this.viewer.directionalLight.shadow.camera.far=50;this.viewer.directionalLight.shadow.camera.left=-30,this.viewer.directionalLight.shadow.camera.right=30,this.viewer.directionalLight.shadow.camera.top=30,this.viewer.directionalLight.shadow.camera.bottom=-7.5}},{key:"loadFactory",value:function(){var e=this;this.gltfLoader.setPath("factory/glb/"),this.gltfLoader.load("factory2.glb",(function(t){e.factory=t.scene,e.viewer.scene.add(e.factory),e.fans=[],e.factory.traverse((function(t){t.isMesh&&("NavMesh"===t.name?(e.navMesh=t,e.navMesh.geometry.rotateX(Math.PI/2),e.navMesh.quaternion.identity(),e.navMesh.position.set(0,0,0),t.material.visible=!1):t.name.includes("fan")?e.fans.push(t):t.material.name.includes("elements2")||t.material.name.includes("elements5")||t.material.name.includes("terrain")?t.castShadow=!0:t.material.name.includes("sand")?t.receiveShadow=!0:t.material.name.includes("elements1")?(t.castShadow=!0,t.receiveShadow=!0):t.parent.name.includes("main")&&(t.castShadow=!0))})),e.viewer.scene.add(e.navMesh),e.initPathfinding(e.navMesh),e.render()}),(function(t){e.viewer.onProgress("factory.glb",t)}))}},{key:"initPathfinding",value:function(e){this.waypoints=[new h(17.73372016326552,.39953298254866443,-.7466724607286782),new h(20.649478054772402,.04232912113775987,-18.282935518174437),new h(11.7688416798274,.11264635905666916,-23.23102176233945),new h(-3.111551689570482,.18245423057147991,-22.687392486867505),new h(-13.772447796604245,.1260277454451636,-23.12237117145656),new h(-20.53385139415452,.0904175187063471,-12.467546107992108),new h(-18.195950790753532,.17323640676321908,-.9593366354062719),new h(-6.603208729295872,.015786387893574227,-12.265553884212125)],this.pathfinder=new z,this.pathfinder.setZoneData("factory",z.createZone(e.geometry,.02)),void 0!==this.npcHandler.gltf&&this.npcHandler.initNPCs()}}]),t}();r("default",(function(){var e=o.exports.useRef(null);return o.exports.useEffect((function(){if(e.current){var t=new S(e.current);t.useOrbitControls(),t.listen();var n,r=new U(t);return function e(){r.update(),n=requestAnimationFrame(e)}(),function(){cancelIdleCallback(n)}}}),[]),a("div",{className:"w-100% h-100% relative",children:a("div",{className:"gunplay w-100% h-100%",ref:e})})}))}}}))}();
